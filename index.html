<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 6.2.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">John Doe</a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
						<!-- music -->
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">I&#39;m a developer.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-element-ui" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/21/element-ui/" class="article-date">
  	<time datetime="2022-08-21T09:26:38.213Z" itemprop="datePublished">2022-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>时间选择器限制日期</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">       &lt;el-date-picker</span><br><span class="line">            style=<span class="string">&quot;width: 100%&quot;</span></span><br><span class="line">            v-model=<span class="string">&quot;proDialogForm.data&quot;</span></span><br><span class="line">            type=<span class="string">&quot;date&quot;</span></span><br><span class="line">            placeholder=<span class="string">&quot;选择日期&quot;</span></span><br><span class="line">            :picker-options=<span class="string">&quot;pickerOptions0&quot;</span></span><br><span class="line">          &gt;</span><br><span class="line">          &lt;/el-date-picker&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">pickerOptions0</span>: &#123;</span><br><span class="line">        <span class="title function_">disabledDate</span>(<span class="params">time</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> time.<span class="title function_">getTime</span>() &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="number">8.64e7</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure>

<p>el-table超出显示方框</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template slot-scope=&quot;scope&quot;&gt; </span><br><span class="line">             &lt;el-popover title=&quot;详细&quot; trigger=&quot;hover&quot; placement=&quot;top&quot; width=&quot;200&quot;&gt;</span><br><span class="line">                 &lt;p&gt;&#123;&#123; scope.row.QuestionDescription &#125;&#125;&lt;/p&gt;</span><br><span class="line">                 &lt;div slot=&quot;reference&quot;&gt;</span><br><span class="line">                 &lt;p size=&quot;medium&quot; style=&quot;white-space: nowrap;overflow: hidden;text-overflow:ellipsis;&quot;&gt;&#123;&#123; scope.row.QuestionDescription&#125;&#125;&lt;/p&gt;</span><br><span class="line">             &lt;/div&gt;</span><br><span class="line">         &lt;/el-popover&gt;        </span><br><span class="line">   &lt;/template&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="elementui中的el-radio值无法回显"><a href="#elementui中的el-radio值无法回显" class="headerlink" title="elementui中的el-radio值无法回显"></a>elementui中的el-radio值无法回显</h1><blockquote>
<p>一般我们在做数据回显，比如性别回显时从后天传入一个字符串到前端，但是页面的el-radio无法回显</p>
</blockquote>
<h4 id="先看lebel前有没有加冒号-“：”的意思就是绑定一个动态变量"><a href="#先看lebel前有没有加冒号-“：”的意思就是绑定一个动态变量" class="headerlink" title="先看lebel前有没有加冒号 : “：”的意思就是绑定一个动态变量"></a>先看lebel前有没有加冒号 : “：”的意思就是绑定一个动态变量</h4><h4 id="其次"><a href="#其次" class="headerlink" title="其次"></a>其次</h4><h5 id="radio-label为number类型可以直接回显"><a href="#radio-label为number类型可以直接回显" class="headerlink" title="radio label为number类型可以直接回显"></a>radio label为number类型可以直接回显</h5><h5 id="radio-label为String类型无法回显，需要在最外层再加一层引号"><a href="#radio-label为String类型无法回显，需要在最外层再加一层引号" class="headerlink" title="radio label为String类型无法回显，需要在最外层再加一层引号"></a>radio label为String类型无法回显，需要在最外层再加一层引号</h5><p><img src="D:\echartsPic\3.png"></p>
<h1 id="input输入框只能输入大于0的数字，包含小数-但去除e"><a href="#input输入框只能输入大于0的数字，包含小数-但去除e" class="headerlink" title="input输入框只能输入大于0的数字，包含小数 但去除e"></a>input输入框只能输入大于0的数字，包含小数 但去除e</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-input</span><br><span class="line">              v-model=<span class="string">&quot;addDialogData.orgMoney&quot;</span></span><br><span class="line">               type=<span class="string">&quot;number&quot;</span></span><br><span class="line">              min=<span class="string">&quot;0&quot;</span></span><br><span class="line">              @keydown.<span class="property">native</span>=<span class="string">&quot;channelInputLimit&quot;</span></span><br><span class="line">            &gt;&lt;/el-input&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">channelInputLimit</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> key = e.<span class="property">key</span>;</span><br><span class="line">  <span class="comment">// 不允许输入&#x27;e&#x27;和&#x27;.&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (key === <span class="string">&quot;e&quot;</span>) &#123;</span><br><span class="line">    e.<span class="property">returnValue</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="日期选择器不能自适应"><a href="#日期选择器不能自适应" class="headerlink" title="日期选择器不能自适应"></a>日期选择器不能自适应</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="language-xml"><span class="tag">&lt;<span class="name">el-date-picker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">v-model</span>=<span class="string">&quot;selectParams.endTime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">type</span>=<span class="string">&quot;date&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">placeholder</span>=<span class="string">&quot;选择日期&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">format</span>=<span class="string">&quot;yyyy 年 MM 月 dd 日&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">value-format</span>=<span class="string">&quot;yyyy-MM-dd&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">     &gt;</span><span class="tag">&lt;/<span class="name">el-date-picker</span>&gt;</span></span> --&gt;</span><br></pre></td></tr></table></figure>

<h1 id="动态表格分页"><a href="#动态表格分页" class="headerlink" title="动态表格分页"></a>动态表格分页</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">el-table</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:data</span>=<span class="string">&quot;sgData&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;index&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">width</span>=<span class="string">&quot;50&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;名称&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">width</span>=<span class="string">&quot;180&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">prop</span>=<span class="string">&quot;code&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;基金代号&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">width</span>=<span class="string">&quot;180&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">prop</span>=<span class="string">&quot;suspenddate&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;暂停赎回日期&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-pagination</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">background</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:page-size</span>=<span class="string">&quot;everypageNum&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">layout</span>=<span class="string">&quot;total,prev, pager, next&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:total</span>=<span class="string">&quot;zsTOTAL&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">sgData</span>:[], <span class="comment">//表格中的数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">resData</span>: [], <span class="comment">//请求返回的数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">shData</span>:[],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      zsTOTAL : <span class="number">0</span>, <span class="comment">//总共有多少条数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      pageVal :<span class="number">1</span>, <span class="comment">//默认显示第一页</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      everypageNum :<span class="number">20</span>,  <span class="comment">//每一页显示多少条</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="title function_">getztjjdata</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">getshjjdata</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">$axios</span>.<span class="title function_">post</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">         <span class="string">&#x27;/apis&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">         <span class="string">&#x27;/fund/suspend/purch&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">         &#123;<span class="attr">key</span>:<span class="string">&#x27;2e29ce045a839c918692223c92fe0fb9&#x27;</span>&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        ).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;22&quot;</span>,res.<span class="property">result</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">let</span> data = res.<span class="property">result</span>[<span class="number">0</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">let</span> arr =[]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> data)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            arr.<span class="title function_">push</span>(data[i])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>.<span class="property">resData</span> = arr  <span class="comment">//这是得到的结果，数组中有1941条数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(arr)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">let</span> num = arr.<span class="property">length</span>  <span class="comment">//arr.length 为有多少条数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>.<span class="property">zsTOTAL</span> = num</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>.<span class="property">sgData</span> = arr.<span class="title function_">slice</span>(<span class="variable language_">this</span>.<span class="property">pageVal</span>-<span class="number">1</span>,<span class="variable language_">this</span>.<span class="property">everypageNum</span>) <span class="comment">//当页面第一次加载进来，默认第一页数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">handleCurrentChange</span>(<span class="params">val</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">pageVal</span> = val; <span class="comment">//此处为用户点击第几页</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 1: 0,19  当用户点击第一页，那么就是前20条，对耶下标位置应为0至19</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">//后面截取的位置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> that =<span class="variable language_">this</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">let</span> start = that.<span class="property">everypageNum</span>*val-<span class="number">20</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">let</span> end = that.<span class="property">everypageNum</span>*val </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span>(that.<span class="property">resData</span>.<span class="property">length</span>&lt;= that.<span class="property">everypageNum</span>)&#123;  <span class="comment">//这种情况为只有20条或者20条以下数据的情况</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          that.<span class="property">sgData</span> = that.<span class="property">resData</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;<span class="keyword">else</span>&#123;  <span class="comment">//这种情况为大于20条数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span>(that.<span class="property">everypageNum</span>*val&gt;=that.<span class="property">resData</span>.<span class="property">length</span>)&#123;<span class="comment">//用户点击的那一页是最后一页的数据，比如有49条数据，用户点击第3页，第二3就应该显示最后9条的数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            that.<span class="property">sgData</span> = that.<span class="property">resData</span>.<span class="title function_">slice</span>(start)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;<span class="keyword">else</span>&#123; <span class="comment">//用户点击的那一页不是最后一页的数据，比如有49条数据，用户点击第二页，第二页就应该显示20至40条的数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          that.<span class="property">sgData</span> = that.<span class="property">resData</span>.<span class="title function_">slice</span>(start,end)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">//当有7个 that.resData</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">//当有21个  that.resData.slice(0,20)  that.resData.slice(20)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">//当有40， ...</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">//当有47个  that.resData.slice(20,40)  that.resData.slice(40)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">//以此类推找规律</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="el-select长短不一"><a href="#el-select长短不一" class="headerlink" title="el-select长短不一"></a>el-select长短不一</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/deep/ .<span class="property">el</span>-select &#123;</span><br><span class="line"><span class="comment">//充满父元素（el-col）</span></span><br><span class="line">  <span class="attr">width</span>: <span class="number">100</span>%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/deep/ .<span class="property">el</span>-date-editor&#123;</span><br><span class="line">  <span class="attr">width</span>: <span class="number">100</span>%;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="el-table-滚动条小屏消失问题"><a href="#el-table-滚动条小屏消失问题" class="headerlink" title="el-table 滚动条小屏消失问题"></a>el-table 滚动条小屏消失问题</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.<span class="property">el</span>-table ::-webkit-scrollbar &#123;</span><br><span class="line">  <span class="attr">display</span>: block !important;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="el-table-内容超出显示悬浮框"><a href="#el-table-内容超出显示悬浮框" class="headerlink" title="el-table 内容超出显示悬浮框"></a>el-table 内容超出显示悬浮框</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column label=<span class="string">&quot;描述&quot;</span> :show-overflow-tooltip=<span class="string">&#x27;true&#x27;</span>&gt;</span><br><span class="line">              <span class="language-xml"><span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;scope.row.ms&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line">            &lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>

<p>接着</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line"> .<span class="property">el</span>-tooltip__popper&#123;</span><br><span class="line">    max-<span class="attr">width</span>:<span class="number">20</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="property">el</span>-tooltip__popper,.<span class="property">el</span>-tooltip__popper.<span class="property">is</span>-dark&#123;</span><br><span class="line">    <span class="attr">background</span>:<span class="title function_">rgb</span>(<span class="number">48</span>, <span class="number">65</span>, <span class="number">86</span>) !important;</span><br><span class="line">    <span class="attr">color</span>: #fff !important;</span><br><span class="line">    line-<span class="attr">height</span>: 24px;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h1 id="Element-UI-10个奇淫技巧，你知道几个？"><a href="#Element-UI-10个奇淫技巧，你知道几个？" class="headerlink" title="Element-UI 10个奇淫技巧，你知道几个？"></a>Element-UI 10个奇淫技巧，你知道几个？</h1><h3 id="el-scrollbar-滚动条"><a href="#el-scrollbar-滚动条" class="headerlink" title="el-scrollbar 滚动条"></a>el-scrollbar 滚动条</h3><p>看到这个组件是不是有点陌生，陌生就对了，因为它从来没有出现在 element 官网上（估计是性能问题），但好东西怎么能藏着掖着，来上效果图。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/47ecaf4a75224000b02043d9d17fc6ce~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"> 是不是比原生的滚动条美观多了，使用方法也非常简单：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-scrollbar&gt;</span><br><span class="line">  &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;p v-for=&quot;item in 15&quot; :key=&quot;item&quot;&gt;欢迎使用 el-scrollbar &#123;&#123;item&#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/el-scrollbar&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.el-scrollbar &#123;</span><br><span class="line">  border: 1px solid #ddd;</span><br><span class="line">  height: 200px;</span><br><span class="line">&#125;</span><br><span class="line">.el-scrollbar ::v-deep  .el-scrollbar__wrap &#123;</span><br><span class="line">    overflow-y: scroll;</span><br><span class="line">    overflow-x: hidden;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>只要 scrollbar 内部盒子的高度超过 scrollbar 的高度就会出现滚动条，横向滚动条同理。</p>
<h3 id="el-upload-模拟点击"><a href="#el-upload-模拟点击" class="headerlink" title="el-upload 模拟点击"></a>el-upload 模拟点击</h3><p>有时候我们想用 el-upload 的上传功能，但又不想用 el-upload 的样式，如何实现呢？方法也很简单，隐藏 el-upload，然后再模拟点击就可以了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;button @click=&quot;handleUpload&quot;&gt;上传文件&lt;/button&gt;</span><br><span class="line">&lt;el-upload</span><br><span class="line">  v-show=&quot;false&quot;</span><br><span class="line">  class=&quot;upload-resource&quot;</span><br><span class="line">  multiple</span><br><span class="line">  action=&quot;&quot;</span><br><span class="line">  :http-request=&quot;clickUploadFile&quot;</span><br><span class="line">  ref=&quot;upload&quot;</span><br><span class="line">  :on-success=&quot;uploadSuccess&quot;</span><br><span class="line">&gt;</span><br><span class="line">    上传本地文件</span><br><span class="line">&lt;/el-upload&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        // 模拟点击</span><br><span class="line">        handleUpload() &#123;</span><br><span class="line">            document.querySelector(&quot;.upload-resource .el-upload&quot;).click()</span><br><span class="line">        &#125;,</span><br><span class="line">        // 上传文件</span><br><span class="line">        async clickUploadFile(file) &#123;</span><br><span class="line">            const formData = new FormData()</span><br><span class="line">            formData.append(&#x27;file&#x27;, file.file)</span><br><span class="line">            const res = await api.post(`xxx`, formData)</span><br><span class="line">        &#125;</span><br><span class="line">        // 上传成功后，清空组件自带的文件列表</span><br><span class="line">        uploadSuccess() &#123;</span><br><span class="line">            this.$refs.upload.clearFiles()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="el-select-下拉框选项过长"><a href="#el-select-下拉框选项过长" class="headerlink" title="el-select 下拉框选项过长"></a>el-select 下拉框选项过长</h3><p>很多时候下拉框的内容是不可控的，如果下拉框选项内容过长，势必会导致页面非常不协调，解决办法就是，单行省略加文字提示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-select popper-class=&quot;popper-class&quot; :popper-append-to-body=&quot;false&quot; v-model=&quot;value&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">    &lt;el-option</span><br><span class="line">      v-for=&quot;item in options&quot;</span><br><span class="line">      :key=&quot;item.value&quot;</span><br><span class="line">      :label=&quot;item.label&quot;</span><br><span class="line">      :value=&quot;item.value&quot;</span><br><span class="line">    &gt;</span><br><span class="line">        &lt;el-tooltip</span><br><span class="line">          placement=&quot;top&quot;</span><br><span class="line">          :disabled=&quot;item.label.length&lt;17&quot;</span><br><span class="line">        &gt;</span><br><span class="line">            &lt;div slot=&quot;content&quot;&gt;</span><br><span class="line">                &lt;span&gt;&#123;&#123;item.label&#125;&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;iclass-text-ellipsis&quot;&gt;&#123;&#123; item.label &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/el-tooltip&gt;</span><br><span class="line">    &lt;/el-option&gt;</span><br><span class="line">&lt;/el-select&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        options: [&#123;</span><br><span class="line">          value: &#x27;选项1&#x27;,</span><br><span class="line">          label: &#x27;黄金糕黄金糕黄金糕黄金糕黄金糕黄金糕黄金糕黄金糕黄金糕&#x27;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          value: &#x27;选项2&#x27;,</span><br><span class="line">          label: &#x27;双皮奶双皮奶双皮奶双皮奶双皮奶双皮奶双皮奶双皮奶双皮奶&#x27;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          value: &#x27;选项3&#x27;,</span><br><span class="line">          label: &#x27;蚵仔煎蚵仔煎蚵仔煎蚵仔煎蚵仔煎蚵仔煎蚵仔煎蚵仔煎蚵仔煎&#x27;</span><br><span class="line">        &#125;],</span><br><span class="line">        value: &#x27;&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.el-select &#123;</span><br><span class="line">  width: 300px;</span><br><span class="line">&#125;</span><br><span class="line">.el-select ::v-deep .popper-class &#123;</span><br><span class="line">  width: 300px;</span><br><span class="line">&#125;</span><br><span class="line">.iclass-text-ellipsis &#123;</span><br><span class="line">  white-space: nowrap;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  text-overflow: ellipsis;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c87b9654ff484f46a6a3a176f0c2c347~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<h3 id="el-input-首尾不能为空格"><a href="#el-input-首尾不能为空格" class="headerlink" title="el-input 首尾不能为空格"></a>el-input 首尾不能为空格</h3><p>我们在使用 input 输入框时，大多不希望用户在前后输入空格，有没有简单的校验方法呢，当然是有的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form :rules=&quot;rules&quot; :model=&quot;form&quot; label-width=&quot;80px&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;活动名称&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;form.name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">&lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            form: &#123;</span><br><span class="line">                name: &#x27;&#x27;</span><br><span class="line">            &#125;,</span><br><span class="line">            rules: &#123;</span><br><span class="line">                name: [</span><br><span class="line">                        &#123; required: true, message: &#x27;请输入活动名称&#x27;, trigger: &#x27;blur&#x27;&#125;,</span><br><span class="line">                        &#123; pattern: /^(?!\s+).*(?&lt;!\s)$/,  message: &#x27;首尾不能为空格&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>效果如下： <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9f5694eca6b456e988f6c5880654f1a~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<h3 id="el-input-type-x3D-number-输入中文，焦点上移"><a href="#el-input-type-x3D-number-输入中文，焦点上移" class="headerlink" title="el-input type&#x3D;number 输入中文，焦点上移"></a>el-input type&#x3D;number 输入中文，焦点上移</h3><p>当 el-input 设置 type&#x3D;”number” 时，输入中文，虽然中文不会显示出来，但焦点会上移。 <img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b114ec274264869a12d97e35b9ae47e~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"> 解决办法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;style scoped&gt;</span><br><span class="line">::v-deep .el-input__inner &#123;</span><br><span class="line">    line-height: 1px !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="el-input-type-x3D-number-去除聚焦时的上下箭头"><a href="#el-input-type-x3D-number-去除聚焦时的上下箭头" class="headerlink" title="el-input type&#x3D;number 去除聚焦时的上下箭头"></a>el-input type&#x3D;number 去除聚焦时的上下箭头</h3><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d715302792b43258c253cfa449e14b7~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"> 解决办法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-input class=&quot;clear-number-input&quot; type=&quot;number&quot;&gt;&lt;/el-input&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.clear-number-input ::v-deep input[type=&quot;number&quot;]::-webkit-outer-spin-button,</span><br><span class="line">.clear-number-input ::v-deep input[type=&quot;number&quot;]::-webkit-inner-spin-button &#123;</span><br><span class="line">    -webkit-appearance: none !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="el-form-只校验表单其中一个字段"><a href="#el-form-只校验表单其中一个字段" class="headerlink" title="el-form 只校验表单其中一个字段"></a>el-form 只校验表单其中一个字段</h3><p>有时候我们需要单独校验一些字段，比如发送验证码，单独对手机号进行校验，可以这样做：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">this.$refs.form.validateField(&#x27;name&#x27;, valid =&gt; &#123;</span><br><span class="line">    if (valid) &#123; </span><br><span class="line">        console.log(&#x27;send!&#x27;); </span><br><span class="line">    &#125; else &#123; </span><br><span class="line">        console.log(&#x27;error send!&#x27;); </span><br><span class="line">        return false; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="el-dialog-重新打开弹窗，清除表单信息"><a href="#el-dialog-重新打开弹窗，清除表单信息" class="headerlink" title="el-dialog 重新打开弹窗，清除表单信息"></a>el-dialog 重新打开弹窗，清除表单信息</h3><p>有人会在打开弹窗时，在$nextTick里重置表单，而我选择在关闭弹窗后进行重置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog @closed=&quot;resetForm&quot;&gt;</span><br><span class="line">    &lt;el-form ref=&quot;form&quot;&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        resetForm() &#123;</span><br><span class="line">            this.$refs.form.resetFields()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="el-dialog-的-destroy-on-close-属性设置无效"><a href="#el-dialog-的-destroy-on-close-属性设置无效" class="headerlink" title="el-dialog 的 destroy-on-close 属性设置无效"></a>el-dialog 的 destroy-on-close 属性设置无效</h3><p>destroy-on-close 设置为 true 后发现弹窗关闭后 DOM 元素仍在，没有被销毁。</p>
<p>解决办法：在 el-dialog 上添加 v-if。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog :visible.sync=&quot;visible&quot; v-if=&quot;visible&quot; destroy-on-close&gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="el-table-表格内容超出省略"><a href="#el-table-表格内容超出省略" class="headerlink" title="el-table 表格内容超出省略"></a>el-table 表格内容超出省略</h3><p>当表格内容过长时，手动添加样式比较麻烦，偷偷告诉你，只需要添加一个 show-overflow-tooltip 就可以搞定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column</span><br><span class="line">  prop=&quot;address&quot;</span><br><span class="line">  label=&quot;地址&quot;</span><br><span class="line">  width=&quot;180&quot;</span><br><span class="line">  show-overflow-tooltip</span><br><span class="line">&gt;</span><br><span class="line">&lt;/el-table-column&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>效果如下： <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c41012695f0c43d6a6f0e5df018fc2cf~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<h3 id="利用sync修饰符关闭新增弹层"><a href="#利用sync修饰符关闭新增弹层" class="headerlink" title="利用sync修饰符关闭新增弹层"></a>利用sync修饰符关闭新增弹层</h3><blockquote>
<p>这里我们学习一个新的技巧，**<code>sync修饰符</code>**</p>
</blockquote>
<p> 按照常规，想要让父组件更新**<code>showDialog</code>**的话，需要这样做 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="variable language_">this</span>.$emit(<span class="string">&#x27;changedialog&#x27;</span>, <span class="literal">false</span>) <span class="comment">//触发事件</span></span><br><span class="line"><span class="comment">// 父组件</span></span><br><span class="line">&lt;child @changedialog=<span class="string">&quot;method&quot;</span> :showDialog=<span class="string">&quot;showDialog&quot;</span> /&gt;</span><br><span class="line"> <span class="title function_">method</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">showDialog</span> = value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>但是，vuejs为我们提供了**<code>sync修饰符</code>**，它提供了一种简写模式 也就是</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件 update:固定写法 (update:props名称, 值)</span></span><br><span class="line"><span class="variable language_">this</span>.$emit(<span class="string">&#x27;update:showDialog&#x27;</span>, <span class="literal">false</span>) <span class="comment">//触发事件</span></span><br><span class="line"><span class="comment">// 父组件 sync修饰符</span></span><br><span class="line">&lt;child  :showDialog.<span class="property">sync</span>=<span class="string">&quot;showDialog&quot;</span> /&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>只要用sync修饰，就可以省略父组件的监听和方法，直接将值赋值给showDialog</p>
<h1 id="多个el-table-内嵌图片显示出错的问题"><a href="#多个el-table-内嵌图片显示出错的问题" class="headerlink" title="多个el-table 内嵌图片显示出错的问题"></a>多个el-table 内嵌图片显示出错的问题</h1><p>1.每一列加入:key&#x3D;”Math.random()”</p>
<p>2.slot-scope&#x3D;”scope”写道 template 里面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column label=<span class="string">&quot;紧急程度&quot;</span> align=<span class="string">&quot;center&quot;</span> :key=<span class="string">&quot;Math.random()&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">​        &lt;template slot-scope=<span class="string">&quot;scope&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">​         &lt;img</span><br><span class="line"></span><br><span class="line">​          v-<span class="keyword">if</span>=<span class="string">&quot;scope.row.isChongxinRevisited==&#x27;1&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">​          style=<span class="string">&quot;width:20px;height:20px&quot;</span></span><br><span class="line"></span><br><span class="line">​          src=<span class="string">&quot;@/assets/images/xfts/cxcf.png&quot;</span></span><br><span class="line"></span><br><span class="line">​         /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​        &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">​       &lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-权限设计和管理" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/21/%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1%E5%92%8C%E7%AE%A1%E7%90%86/" class="article-date">
  	<time datetime="2022-08-21T09:02:33.135Z" itemprop="datePublished">2022-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="权限设计-RBAC的权限设计思想"><a href="#权限设计-RBAC的权限设计思想" class="headerlink" title="权限设计-RBAC的权限设计思想"></a>权限设计-RBAC的权限设计思想</h2><blockquote>
<p>首先，我们先了解下什么是传统的权限设计</p>
</blockquote>
<p><img src="/assets/image-20200901150655343.png" alt="image-20200901150655343"></p>
<p>从上面的图中，我们发现，传统的权限设计是对每个人进行单独的权限设置，但这种方式已经不适合目前企业的高效管控权限的发展需求，因为每个人都要单独去设置权限</p>
<blockquote>
<p>  基于此，RBAC的权限模型就应运而生了，RBAC(Role-Based Access control) ，也就是基于角色的权限分配解决方案，相对于传统方案，RBAC提供了中间层Role（角色），其权限模式如下</p>
</blockquote>
<p><img src="/assets/image-20200901151025021.png" alt="image-20200901151025021"></p>
<p>RBAC实现了用户和权限点的分离，想对某个用户设置权限，只需要对该用户设置相应的角色即可，而该角色就拥有了对应的权限，这样一来，权限的分配和设计就做到了极简，高效，当想对用户收回权限时，只需要收回角色即可，接下来，我们就在该项目中实施这一设想</p>
<h2 id="给分配员工角色"><a href="#给分配员工角色" class="headerlink" title="给分配员工角色"></a>给分配员工角色</h2><p>**<code>目标</code>**在员工管理页面，分配角色</p>
<h3 id="新建分配角色窗体"><a href="#新建分配角色窗体" class="headerlink" title="新建分配角色窗体"></a>新建分配角色窗体</h3><blockquote>
<p>在上一节章节中，员工管理的角色功能，我们并没有实现，此章节我们实现给员工分配角色</p>
</blockquote>
<p><img src="/assets/image-20200901151151286.png" alt="image-20200901151151286"></p>
<p>从上图中，可以看出，用户和角色是**<code>1对多</code>**的关系，即一个用户可以拥有多个角色，比如公司的董事长可以拥有总经理和系统管理员一样的角色</p>
<p>首先，新建分配角色窗体 <strong><code>assign-role.vue</code></strong> 	</p>
<p><img src="/assets/image-20200728172853451.png" alt="image-20200728172853451"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dialog title=&quot;分配角色&quot; :visible=&quot;showRoleDialog&quot;&gt;</span><br><span class="line">    &lt;!-- el-checkbox-group选中的是 当前用户所拥有的角色  需要绑定 当前用户拥有的角色--&gt;</span><br><span class="line">    &lt;el-checkbox-group&gt;</span><br><span class="line">      &lt;!-- 选项 --&gt;</span><br><span class="line">    &lt;/el-checkbox-group&gt;</span><br><span class="line">    &lt;el-row slot=&quot;footer&quot; type=&quot;flex&quot; justify=&quot;center&quot;&gt;</span><br><span class="line">      &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; size=&quot;small&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button size=&quot;small&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    showRoleDialog: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    // 用户的id 用来查询当前用户的角色信息</span><br><span class="line">    userId: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: null</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="获取角色列表和当前用户角色"><a href="#获取角色列表和当前用户角色" class="headerlink" title="获取角色列表和当前用户角色"></a>获取角色列表和当前用户角色</h3><p><strong>获取所有角色列表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 分配角色 --&gt;</span><br><span class="line">  &lt;el-checkbox-group v-model=&quot;roleIds&quot;&gt;</span><br><span class="line">    &lt;el-checkbox v-for=&quot;item in list&quot; :key=&quot;item.id&quot; :label=&quot;item.id&quot;&gt;</span><br><span class="line">      &#123;&#123;</span><br><span class="line">        item.name</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &lt;/el-checkbox&gt;</span><br><span class="line">  &lt;/el-checkbox-group&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>获取角色列表</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getRoleList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/setting&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">showRoleDialog</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">userId</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">list</span>: [], <span class="comment">// 角色列表</span></span><br><span class="line">      <span class="attr">roleIds</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getRoleList</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">//  获取所有角色</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getRoleList</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; rows &#125; = <span class="keyword">await</span> <span class="title function_">getRoleList</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span> = rows</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>获取用户的当前角色</strong>  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getUserDetailById &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">async</span> <span class="title function_">getUserDetailById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; roleIds &#125; = <span class="keyword">await</span> <span class="title function_">getUserDetailById</span>(id)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">roleIds</span> = roleIds <span class="comment">// 赋值本用户的角色</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>点击角色弹出层</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 编辑角色</span><br><span class="line"> async  editRole(id) &#123;</span><br><span class="line">      this.userId = id // props传值 是异步的</span><br><span class="line">      await this.$refs.assignRole.getUserDetailById(id) // 父组件调用子组件方法</span><br><span class="line">      this.showRoleDialog = true</span><br><span class="line">    &#125;,</span><br><span class="line">  &lt;!-- 放置角色分配组件 --&gt;</span><br><span class="line"> &lt;assign-role ref=&quot;assignRole&quot; :show-role-dialog.sync=&quot;showRoleDialog&quot; :user-id=&quot;userId&quot; /&gt;</span><br></pre></td></tr></table></figure>

<h3 id="给员工分配角色"><a href="#给员工分配角色" class="headerlink" title="给员工分配角色"></a>给员工分配角色</h3><p><strong>分配角色接口</strong>  <strong><code>api/employees.js</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> * 给用户分配角色</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">assignRoles</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/user/assignRoles&#x27;</span>,</span><br><span class="line">    data,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>确定保存</strong>  <strong><code>assign-role</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">btnOK</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">assignRoles</span>(&#123; <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">userId</span>, <span class="attr">roleIds</span>: <span class="variable language_">this</span>.<span class="property">roleIds</span> &#125;)</span><br><span class="line">      <span class="comment">//   关闭窗体</span></span><br><span class="line">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;update:showRoleDialog&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>**取消或者关闭 **  <strong><code>assign-role</code></strong> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">btnCancel</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">roleIds</span> = [] <span class="comment">// 清空原来的数组</span></span><br><span class="line">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;update:showRoleDialog&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 分配员工权限</p>
<h2 id="权限点管理页面开发"><a href="#权限点管理页面开发" class="headerlink" title="权限点管理页面开发"></a>权限点管理页面开发</h2><p>**<code>目标</code>**： 完成权限点页面的开发和管理</p>
<h3 id="新建权限点管理页面"><a href="#新建权限点管理页面" class="headerlink" title="新建权限点管理页面"></a>新建权限点管理页面</h3><blockquote>
<p>人已经有了角色， 那么权限是什么</p>
</blockquote>
<p>在企业服务中，权限一般分割为 <strong>页面访问权限</strong>，<strong>按钮操作权限</strong>，<strong>API访问权限</strong></p>
<blockquote>
<p>API权限多见于在后端进行拦截，所以我们这一版本只做**<code>页面访问</code><strong>和</strong><code>按钮操作授权</code>&#x2F;**</p>
</blockquote>
<p>由此，我们可以根据业务需求设计权限管理页面</p>
<p><img src="/assets/image-20200901160508382.png" alt="image-20200901160508382"></p>
<p><strong>完成权限页面结构</strong> <strong><code>src/views/permission/index.vue</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;dashboard-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">      &lt;!-- 靠右的按钮 --&gt;</span><br><span class="line">      &lt;page-tools&gt;</span><br><span class="line">        &lt;template v-slot:after&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; size=&quot;small&quot;&gt;添加权限&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/page-tools&gt;</span><br><span class="line">      &lt;!-- 表格 --&gt;</span><br><span class="line">      &lt;el-table border&gt;</span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;名称&quot; /&gt;</span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;标识&quot; /&gt;</span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;描述&quot; /&gt;</span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;操作&quot;&gt;</span><br><span class="line">          &lt;template&gt;</span><br><span class="line">            &lt;el-button type=&quot;text&quot;&gt;添加&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button type=&quot;text&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button type=&quot;text&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">      &lt;/el-table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p><strong>封装权限管理的增删改查请求</strong>  <strong><code>src/api/permisson.js</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getPermissionList</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/permission&#x27;</span>,</span><br><span class="line">    params</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 新增权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">addPermission</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/permission&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">updatePermission</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">$&#123;data.id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">delPermission</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取权限详情</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getPermissionDetail</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="获取权限数据并转化树形"><a href="#获取权限数据并转化树形" class="headerlink" title="获取权限数据并转化树形"></a>获取权限数据并转化树形</h3><p>这里，我们通过树形操作方法，将列表转化成层级数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; getPermissionList &#125; from &#x27;@/api/permission&#x27;</span><br><span class="line">import &#123; transListToTreeData &#125; from &#x27;@/utils&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      formData: &#123;</span><br><span class="line">        name: &#x27;&#x27;, // 名称</span><br><span class="line">        code: &#x27;&#x27;, // 标识</span><br><span class="line">        description: &#x27;&#x27;, // 描述</span><br><span class="line">        type: &#x27;&#x27;, // 类型 该类型 不需要显示 因为点击添加的时候已经知道类型了</span><br><span class="line">        pid: &#x27;&#x27;, // 因为做的是树 需要知道添加到哪个节点下了</span><br><span class="line">        enVisible: &#x27;0&#x27; // 开启</span><br><span class="line">      &#125;,</span><br><span class="line">      rules: &#123;</span><br><span class="line">        name: [&#123; required: true, message: &#x27;权限名称不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;],</span><br><span class="line">        code: [&#123; required: true, message: &#x27;权限标识不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      showDialog: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getPermissionList()</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    showText() &#123;</span><br><span class="line">      return this.formData.id ? &#x27;编辑&#x27; : &#x27;新增&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    async  getPermissionList() &#123;</span><br><span class="line">      this.list = transListToTreeData(await getPermissionList(), &#x27;0&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><strong>绑定表格数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table :data=&quot;list&quot; border=&quot;&quot; row-key=&quot;id&quot;&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;名称&quot; prop=&quot;name&quot; /&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;标识&quot; prop=&quot;code&quot; /&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;描述&quot; prop=&quot;description&quot; /&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;操作&quot;&gt;</span><br><span class="line">          &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">            &lt;el-button v-if=&quot;row.type === 1&quot; type=&quot;text&quot; @click=&quot;addPermission(row.id, 2)&quot;&gt;添加&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button type=&quot;text&quot; @click=&quot;editPermission(row.id)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button type=&quot;text&quot; @click=&quot;delPermission(row.id)&quot;&gt; 删除&lt;/el-button&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">      &lt;/el-table&gt;</span><br></pre></td></tr></table></figure>

<p>需要注意的是， 如果需要树表， 需要给<strong>el-table</strong>配置<strong>row-key</strong>属性  id</p>
<blockquote>
<p>当type为1时为访问权限，type为2时为功能权限</p>
</blockquote>
<blockquote>
<p>和前面内容一样，我们需要完成 新增权限 &#x2F; 删除权限 &#x2F; 编辑权限</p>
</blockquote>
<h3 id="新增编辑权限的弹层"><a href="#新增编辑权限的弹层" class="headerlink" title="新增编辑权限的弹层"></a>新增编辑权限的弹层</h3><p><strong>新增权限&#x2F;编辑权限弹层</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 放置一个弹层 用来编辑新增节点 --&gt;</span><br><span class="line"> &lt;el-dialog :title=&quot;`$&#123;showText&#125;权限点`&quot; :visible=&quot;showDialog&quot; @close=&quot;btnCancel&quot;&gt;</span><br><span class="line">    &lt;!-- 表单 --&gt;</span><br><span class="line">    &lt;el-form ref=&quot;perForm&quot; :model=&quot;formData&quot; :rules=&quot;rules&quot; label-width=&quot;120px&quot;&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;权限名称&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;formData.name&quot; style=&quot;width:90%&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;权限标识&quot; prop=&quot;code&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;formData.code&quot; style=&quot;width:90%&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;权限描述&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;formData.description&quot; style=&quot;width:90%&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;开启&quot;&gt;</span><br><span class="line">        &lt;el-switch</span><br><span class="line">          v-model=&quot;formData.enVisible&quot;</span><br><span class="line">          active-value=&quot;1&quot;</span><br><span class="line">          inactive-value=&quot;0&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;el-row slot=&quot;footer&quot; type=&quot;flex&quot; justify=&quot;center&quot;&gt;</span><br><span class="line">      &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">        &lt;el-button size=&quot;small&quot; type=&quot;primary&quot; @click=&quot;btnOK&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button size=&quot;small&quot; @click=&quot;btnCancel&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<h3 id="新增，编辑，删除权限点"><a href="#新增，编辑，删除权限点" class="headerlink" title="新增，编辑，删除权限点"></a>新增，编辑，删除权限点</h3><p><strong>新增&#x2F;删除&#x2F;编辑逻辑</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; updatePermission, addPermission, getPermissionDetail, delPermission, getPermissionList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">     <span class="comment">// 删除操作</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">delPermission</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.$confirm(<span class="string">&#x27;确定要删除该数据吗&#x27;</span>)</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">delPermission</span>(id)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getPermissionList</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&#x27;删除成功&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">btnOK</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">perForm</span>.<span class="title function_">validate</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">formData</span>.<span class="property">id</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">updatePermission</span>(<span class="variable language_">this</span>.<span class="property">formData</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">addPermission</span>(<span class="variable language_">this</span>.<span class="property">formData</span>)</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//  提示消息</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&#x27;新增成功&#x27;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getPermissionList</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">showDialog</span> = <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">btnCancel</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">formData</span> = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 名称</span></span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 标识</span></span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 描述</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 类型 该类型 不需要显示 因为点击添加的时候已经知道类型了</span></span><br><span class="line">        <span class="attr">pid</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 因为做的是树 需要知道添加到哪个节点下了</span></span><br><span class="line">        <span class="attr">enVisible</span>: <span class="string">&#x27;0&#x27;</span> <span class="comment">// 开启</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">perForm</span>.<span class="title function_">resetFields</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showDialog</span> = <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">addPermission</span>(<span class="params">pid, type</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">formData</span>.<span class="property">pid</span> = pid</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">formData</span>.<span class="property">type</span> = type</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showDialog</span> = <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">editPermission</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="comment">// 根据获取id获取详情</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">formData</span> = <span class="keyword">await</span> <span class="title function_">getPermissionDetail</span>(id)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showDialog</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong>: 权限点管理页面开发</p>
<h2 id="给角色分配权限"><a href="#给角色分配权限" class="headerlink" title="给角色分配权限"></a>给角色分配权限</h2><p>**<code>目标</code>**： 完成给角色分配权限的业务</p>
<h3 id="新建分配权限弹出层"><a href="#新建分配权限弹出层" class="headerlink" title="新建分配权限弹出层"></a>新建分配权限弹出层</h3><blockquote>
<p>在公司设置的章节中，我们没有实现分配权限的功能，在这里我们来实现一下</p>
</blockquote>
<p><strong>封装分配权限的api</strong>  <strong><code>src/api/setting.js</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给角色分配权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">assignPerm</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/role/assignPrem&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>给角色分配权限弹出层</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog title=&quot;分配权限&quot; :visible=&quot;showPermDialog&quot; @close=&quot;btnPermCancel&quot;&gt;</span><br><span class="line">      &lt;!-- 权限是一颗树 --&gt;</span><br><span class="line">      &lt;!-- 将数据绑定到组件上 --&gt;</span><br><span class="line">      &lt;!-- check-strictly 如果为true 那表示父子勾选时  不互相关联 如果为false就互相关联 --&gt;</span><br><span class="line">      &lt;!-- id作为唯一标识 --&gt;</span><br><span class="line">      &lt;el-tree</span><br><span class="line">        ref=&quot;permTree&quot;</span><br><span class="line">        :data=&quot;permData&quot;</span><br><span class="line">        :props=&quot;defaultProps&quot;</span><br><span class="line">        :show-checkbox=&quot;true&quot;</span><br><span class="line">        :check-strictly=&quot;true&quot;</span><br><span class="line">        :default-expand-all=&quot;true&quot;</span><br><span class="line">        :default-checked-keys=&quot;selectCheck&quot;</span><br><span class="line">        node-key=&quot;id&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!-- 确定 取消 --&gt;</span><br><span class="line">      &lt;el-row slot=&quot;footer&quot; type=&quot;flex&quot; justify=&quot;center&quot;&gt;</span><br><span class="line">        &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; size=&quot;small&quot; @click=&quot;btnPermOK&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; @click=&quot;btnPermCancel&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p><strong>定义数据</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">showPermDialog</span>: <span class="literal">false</span>, <span class="comment">// 控制分配权限弹层的显示后者隐藏</span></span><br><span class="line"><span class="attr">defaultProps</span>: &#123;</span><br><span class="line">  <span class="attr">label</span>: <span class="string">&#x27;name&#x27;</span></span><br><span class="line">&#125;,</span><br><span class="line"> <span class="attr">permData</span>: [], <span class="comment">// 专门用来接收权限数据 树形数据</span></span><br><span class="line"><span class="attr">selectCheck</span>: [], <span class="comment">// 定义一个数组来接收 已经选中的节点</span></span><br><span class="line"><span class="attr">roleId</span>: <span class="literal">null</span> <span class="comment">// 用来记录分配角色的id</span></span><br></pre></td></tr></table></figure>

<p><strong>点击分配权限</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button size=&quot;small&quot; type=&quot;success&quot; @click=&quot;assignPerm(row.id)&quot;&gt;分配权限&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<h3 id="给角色分配权限-1"><a href="#给角色分配权限-1" class="headerlink" title="给角色分配权限"></a>给角色分配权限</h3><p><strong>分配权限</strong>&#x2F;<strong>树形数据</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> &#123; transListToTreeData &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getPermissionList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 点击分配权限</span></span><br><span class="line">  <span class="comment">// 获取权限点数据 在点击的时候调用 获取权限点数据</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">assignPerm</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">permData</span> = <span class="title function_">tranListToTreeData</span>(<span class="keyword">await</span> <span class="title function_">getPermissionList</span>(), <span class="string">&#x27;0&#x27;</span>) <span class="comment">// 转化list到树形数据</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">roleId</span> = id</span><br><span class="line">      <span class="comment">// 应该去获取 这个id的 权限点</span></span><br><span class="line">      <span class="comment">// 有id 就可以 id应该先记录下来</span></span><br><span class="line">      <span class="keyword">const</span> &#123; permIds &#125; = <span class="keyword">await</span> <span class="title function_">getRoleDetail</span>(id) <span class="comment">// permIds是当前角色所拥有的权限点数据</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">selectCheck</span> = permIds <span class="comment">// 将当前角色所拥有的权限id赋值</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showPermDialog</span> = <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span>  <span class="title function_">btnPermOK</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 调用el-tree的方法</span></span><br><span class="line">      <span class="comment">// console.log(this.$refs.permTree.getCheckedKeys())</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">assignPerm</span>(&#123; <span class="attr">permIds</span>: <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">permTree</span>.<span class="title function_">getCheckedKeys</span>(), <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">roleId</span> &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&#x27;分配权限成功&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showPermDialog</span> = <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">btnPermCancel</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">selectCheck</span> = [] <span class="comment">// 重置数据</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showPermDialog</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 给角色分配权限</p>
<h2 id="前端权限应用-页面访问和菜单"><a href="#前端权限应用-页面访问和菜单" class="headerlink" title="前端权限应用-页面访问和菜单"></a>前端权限应用-页面访问和菜单</h2><p>**<code>目标</code>**： 在当前项目应用用户的页面访问权限</p>
<h3 id="权限受控的主体思路"><a href="#权限受控的主体思路" class="headerlink" title="权限受控的主体思路"></a>权限受控的主体思路</h3><blockquote>
<p>到了最关键的环节，我们设置的权限如何应用？</p>
</blockquote>
<p>在上面的几个小节中，我们已经把给用户分配了角色， 给角色分配了权限，那么在用户登录获取资料的时候，会自动查出该用户拥有哪些权限，这个权限需要和我们的菜单还有路由有效结合起来</p>
<blockquote>
<p>我们在路由和页面章节中，已经介绍过，动态权限其实就是根据用户的实际权限来访问的，接下来我们操作一下</p>
</blockquote>
<p><img src="/assets/image-20200730002842243.png" alt="image-20200730002842243"></p>
<p>在权限管理页面中，我们设置了一个<strong>标识</strong>， 这个标识可以和我们的路由模块进行关联，也就是说，如果用户拥有这个标识，那么用户就可以<strong>拥有这个路由模块</strong>，如果没有这个标识，就不能<strong>访问路由模块</strong></p>
<blockquote>
<p>用什么来实现？</p>
</blockquote>
<p>vue-router提供了一个叫做<a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/api/#router-addroutes">addRoutes</a>的API方法，这个方法的含义是<strong>动态添加路由规则</strong></p>
<p>思路如下</p>
<p><img src="/assets/image-20200901164312005.png" alt="image-20200901164312005"></p>
<h3 id="新建Vuex中管理权限的模块"><a href="#新建Vuex中管理权限的模块" class="headerlink" title="新建Vuex中管理权限的模块"></a>新建Vuex中管理权限的模块</h3><blockquote>
<p> 在<strong>主页模块</strong>章节中，我们将用户的资料设置到vuex中，其中便有权限数据，我们可以就此进行操作</p>
</blockquote>
<p>我们可以在vuex中新增一个permission模块</p>
<p><strong><code>src/store/modules/permission.js</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vuex的权限模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; constantRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="comment">// vuex中的permission模块用来存放当前的 静态路由 + 当前用户的 权限路由</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">routes</span>: constantRoutes <span class="comment">// 所有人默认拥有静态路由</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="comment">// newRoutes可以认为是 用户登录 通过权限所得到的动态路由的部分</span></span><br><span class="line">  <span class="title function_">setRoutes</span>(<span class="params">state, newRoutes</span>) &#123;</span><br><span class="line">    <span class="comment">// 下面这么写不对 不是语法不对 是业务不对</span></span><br><span class="line">    <span class="comment">// state.routes = [...state.routes, ...newRoutes]</span></span><br><span class="line">    <span class="comment">// 有一种情况  张三 登录 获取了动态路由 追加到路由上  李四登录 4个动态路由</span></span><br><span class="line">    <span class="comment">// 应该是每次更新 都应该在静态路由的基础上进行追加</span></span><br><span class="line">    state.<span class="property">routes</span> = [...constantRoutes, ...newRoutes]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在Vuex管理模块中引入permisson模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> permission <span class="keyword">from</span> <span class="string">&#x27;./modules/permission&#x27;</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    <span class="comment">// 子模块   $store.state.app.</span></span><br><span class="line">    <span class="comment">// mapGetters([])</span></span><br><span class="line">    app,</span><br><span class="line">    settings,</span><br><span class="line">    user,</span><br><span class="line">    permission</span><br><span class="line">  &#125;,</span><br><span class="line">  getters</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Vuex筛选权限路由"><a href="#Vuex筛选权限路由" class="headerlink" title="Vuex筛选权限路由"></a>Vuex筛选权限路由</h3><blockquote>
<p> OK， 那么我们在哪将用户的标识和权限进行关联呢 ？</p>
</blockquote>
<p><img src="/assets/image-20200815184203715.png" alt="image-20200815184203715"></p>
<p>我们可以在这张图中，进一步的进行操作</p>
<p><img src="/assets/image-20200815184407204.png" alt="image-20200815184407204"></p>
<p>访问权限的数据在用户属性**<code>menus</code><strong>中，</strong><code>menus</code>**中的标识该怎么和路由对应呢？</p>
<p><img src="/assets/image-20200815185230597.png" alt="image-20200815185230597"></p>
<blockquote>
<p>  可以将路由模块的根节点**<code>name</code>**属性命名和权限标识一致，这样只要标识能对上，就说明用户拥有了该权限</p>
</blockquote>
<p>这一步，在我们命名路由的时候已经操作过了</p>
<p><img src="/assets/image-20200730011629326.png" alt="image-20200730011629326"></p>
<p>接下来， vuex的permission中提供一个action，进行关联</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; asyncRoutes, constantRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// 筛选权限路由</span></span><br><span class="line">  <span class="comment">// 第二个参数为当前用户的所拥有的菜单权限</span></span><br><span class="line">  <span class="comment">// menus: [&quot;settings&quot;,&quot;permissions&quot;]</span></span><br><span class="line">  <span class="comment">// asyncRoutes是所有的动态路由</span></span><br><span class="line">  <span class="comment">// asyncRoutes  [&#123;path: &#x27;setting&#x27;,name: &#x27;setting&#x27;&#125;,&#123;&#125;]</span></span><br><span class="line">  <span class="title function_">filterRoutes</span>(<span class="params">context, menus</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> routes = []</span><br><span class="line">    <span class="comment">//   筛选出 动态路由中和menus中能够对上的路由</span></span><br><span class="line">    menus.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// key就是标识</span></span><br><span class="line">      <span class="comment">// asyncRoutes 找 有没有对象中的name属性等于 key的 如果找不到就没权限 如果找到了 要筛选出来</span></span><br><span class="line">      routes.<span class="title function_">push</span>(...asyncRoutes.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">name</span> === key)) <span class="comment">// 得到一个数组 有可能 有元素 也有可能是空数组</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 得到的routes是所有模块中满足权限要求的路由数组</span></span><br><span class="line">    <span class="comment">// routes就是当前用户所拥有的 动态路由的权限</span></span><br><span class="line">    context.<span class="title function_">commit</span>(<span class="string">&#x27;setRoutes&#x27;</span>, routes) <span class="comment">// 将动态路由提交给mutations</span></span><br><span class="line">    <span class="keyword">return</span> routes <span class="comment">// 这里为什么还要return  state数据 是用来 显示左侧菜单用的  return  是给路由addRoutes用的</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="权限拦截出调用筛选权限Action"><a href="#权限拦截出调用筛选权限Action" class="headerlink" title="权限拦截出调用筛选权限Action"></a>权限拦截出调用筛选权限Action</h3><p>在拦截的位置，调用关联action， 获取新增routes，并且<strong>addRoutes</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 权限拦截在路由跳转  导航守卫</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span> <span class="comment">// 引入store实例 和组件中的this.$store是一回事</span></span><br><span class="line"><span class="keyword">import</span> nprogress <span class="keyword">from</span> <span class="string">&#x27;nprogress&#x27;</span> <span class="comment">// 引入进度条</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;nprogress/nprogress.css&#x27;</span> <span class="comment">// 引入进度条样式</span></span><br><span class="line"><span class="comment">// 不需要导出  因为只需要让代码执行即可</span></span><br><span class="line"><span class="comment">// 前置守卫</span></span><br><span class="line"><span class="comment">// next是前置守卫必须必须必须执行的钩子  next必须执行 如果不执行 页面就死了</span></span><br><span class="line"><span class="comment">// next()  放过</span></span><br><span class="line"><span class="comment">// next(false) 跳转终止</span></span><br><span class="line"><span class="comment">// next(地址) 跳转到某个地址</span></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">&#x27;/login&#x27;</span>, <span class="string">&#x27;/404&#x27;</span>] <span class="comment">// 定义白名单</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="title function_">async</span>(to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  nprogress.<span class="title function_">start</span>() <span class="comment">// 开启进度条的意思</span></span><br><span class="line">  <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">token</span>) &#123;</span><br><span class="line">    <span class="comment">// 只有有token的情况下 才能获取资料</span></span><br><span class="line">    <span class="comment">//   如果有token</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果要访问的是 登录页</span></span><br><span class="line">      <span class="title function_">next</span>(<span class="string">&#x27;/&#x27;</span>) <span class="comment">// 跳到主页  // 有token 用处理吗？不用</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 只有放过的时候才去获取用户资料</span></span><br><span class="line">      <span class="comment">// 是每次都获取吗</span></span><br><span class="line">      <span class="comment">// 如果当前vuex中有用户的资料的id 表示 已经有资料了 不需要获取了 如果没有id才需要获取</span></span><br><span class="line">      <span class="keyword">if</span> (!store.<span class="property">getters</span>.<span class="property">userId</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果没有id才表示当前用户资料没有获取过</span></span><br><span class="line">        <span class="comment">// async 函数所return的内容 用 await就可以接收到</span></span><br><span class="line">        <span class="keyword">const</span> &#123; roles &#125; = <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/getUserInfo&#x27;</span>)</span><br><span class="line">        <span class="comment">// 如果说后续 需要根据用户资料获取数据的话 这里必须改成 同步</span></span><br><span class="line">        <span class="comment">// 筛选用户的可用路由</span></span><br><span class="line">        <span class="comment">// actions中函数 默认是Promise对象 调用这个对象 想要获取返回的值话 必须 加 await或者是then</span></span><br><span class="line">        <span class="comment">// actions是做异步操作的</span></span><br><span class="line">        <span class="keyword">const</span> routes = <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;permission/filterRoutes&#x27;</span>, roles.<span class="property">menus</span>)</span><br><span class="line">        <span class="comment">// routes就是筛选得到的动态路由</span></span><br><span class="line">        <span class="comment">// 动态路由 添加到 路由表中 默认的路由表 只有静态路由 没有动态路由</span></span><br><span class="line">        <span class="comment">// addRoutes  必须 用 next(地址) 不能用next()</span></span><br><span class="line">        router.<span class="title function_">addRoutes</span>(routes) <span class="comment">// 添加动态路由到路由表  铺路</span></span><br><span class="line">        <span class="comment">// 添加完动态路由之后</span></span><br><span class="line">        <span class="title function_">next</span>(to.<span class="property">path</span>) <span class="comment">// 相当于跳到对应的地址  相当于多做一次跳转 为什么要多做一次跳转</span></span><br><span class="line">        <span class="comment">// 进门了，但是进门之后我要去的地方的路还没有铺好，直接走，掉坑里，多做一次跳转，再从门外往里进一次，跳转之前 把路铺好，再次进来的时候，路就铺好了</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//   没有token的情况下</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">//  表示要去的地址在白名单</span></span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  nprogress.<span class="title function_">done</span>() <span class="comment">// 解决手动切换地址时 进度条不关闭的问题</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 后置守卫</span></span><br><span class="line">router.<span class="title function_">afterEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  nprogress.<span class="title function_">done</span>() <span class="comment">// 关闭进度条</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="静态路由动态路由解除合并"><a href="#静态路由动态路由解除合并" class="headerlink" title="静态路由动态路由解除合并"></a>静态路由动态路由解除合并</h3><p><strong>注意</strong>： 这里有个非常容易出问题的位置，当我们判断用户是否已经添加路由的前后，不能都是用**next()**，</p>
<p>在添加路由之后应该使用 <strong>next(to.path)<strong>， 否则会使刷新页面之后 权限消失，这属于一个vue-router的</strong>已知缺陷</strong></p>
<p>同时，不要忘记，我们将原来的静态路由 + 动态路由合体的模式 改成 只有静态路由  <strong><code>src/router/index.js</code></strong></p>
<p><img src="/assets/image-20200730012805239.png" alt="image-20200730012805239"></p>
<blockquote>
<p>  此时，我们已经完成了权限设置的一半， 此时我们发现左侧菜单失去了内容，这是因为左侧菜单读取的是固定的路由，我们要把它换成实时的最新路由</p>
</blockquote>
<p>在**<code>src/store/getters.js</code>**配置导出routes</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">sidebar</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">app</span>.<span class="property">sidebar</span>,</span><br><span class="line">  <span class="attr">device</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">app</span>.<span class="property">device</span>,</span><br><span class="line">  <span class="attr">token</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">token</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">userInfo</span>.<span class="property">username</span>, <span class="comment">// 建立用户名称的映射</span></span><br><span class="line">  <span class="attr">userId</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">userInfo</span>.<span class="property">userId</span>, <span class="comment">// 建立用户id的映射</span></span><br><span class="line">  <span class="attr">companyId</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">userInfo</span>.<span class="property">companyId</span>, <span class="comment">// 建立用户的公司Id映射</span></span><br><span class="line">  <span class="attr">routes</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">permission</span>.<span class="property">routes</span> <span class="comment">// 导出当前的路由</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在左侧菜单组件中， 引入routes</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">  ...<span class="title function_">mapGetters</span>([</span><br><span class="line">    <span class="string">&#x27;sidebar&#x27;</span>, <span class="string">&#x27;routes&#x27;</span></span><br><span class="line">  ]),</span><br></pre></td></tr></table></figure>

<blockquote>
<p> OK，到现在为止，我们已经可以实现不同用户登录的时候，菜单是动态的了</p>
</blockquote>
<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 前端权限应用-页面访问和菜单</p>
<h2 id="登出时，重置路由权限和-404问题"><a href="#登出时，重置路由权限和-404问题" class="headerlink" title="登出时，重置路由权限和 404问题"></a>登出时，重置路由权限和 404问题</h2><p><strong>目标</strong>： 处理当登出页面时，路由不正确的问题</p>
<blockquote>
<p> 上一小节，我们看似完成了访问权限的功能，实则不然，因为当我们登出操作之后，虽然看不到菜单，但是用户实际上可以访问页面，直接在地址栏输入地址就能访问</p>
</blockquote>
<p>这是怎么回事？</p>
<blockquote>
<p> 这是因为我们前面在<strong>addRoutes</strong>的时候，一直都是在<strong>加</strong>，登出的时候，我们并没有删，也没有重置，也就是说，我们之前加的路由在登出之后一直在，这怎么处理？</p>
</blockquote>
<p>大家留意我们的<strong>router&#x2F;index.js</strong>文件，发现一个重置路由方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重置路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">resetRouter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> newRouter = <span class="title function_">createRouter</span>()</span><br><span class="line">  router.<span class="property">matcher</span> = newRouter.<span class="property">matcher</span> <span class="comment">// 重新设置路由的可匹配路径</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没错，这个方法就是将路由重新实例化，相当于换了一个新的路由，之前**<code>加的路由</code>**自然不存在了，只需要在登出的时候， 处理一下即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登出的action</span></span><br><span class="line"><span class="title function_">lgout</span>(<span class="params">context</span>) &#123;</span><br><span class="line">  <span class="comment">// 删除token</span></span><br><span class="line">  context.<span class="title function_">commit</span>(<span class="string">&#x27;removeToken&#x27;</span>) <span class="comment">// 不仅仅删除了vuex中的 还删除了缓存中的</span></span><br><span class="line">  <span class="comment">// 删除用户资料</span></span><br><span class="line">  context.<span class="title function_">commit</span>(<span class="string">&#x27;removeUserInfo&#x27;</span>) <span class="comment">// 删除用户信息</span></span><br><span class="line">  <span class="comment">// 重置路由</span></span><br><span class="line">  <span class="title function_">resetRouter</span>()</span><br><span class="line">  <span class="comment">// 还有一步  vuex中的数据是不是还在</span></span><br><span class="line">  <span class="comment">// 要清空permission模块下的state数据</span></span><br><span class="line">  <span class="comment">// vuex中 user子模块  permission子模块</span></span><br><span class="line">  <span class="comment">// 子模块调用子模块的action  默认情况下 子模块的context是子模块的</span></span><br><span class="line">  <span class="comment">// 父模块 调用 子模块的action</span></span><br><span class="line">  context.<span class="title function_">commit</span>(<span class="string">&#x27;permission/setRoutes&#x27;</span>, [], &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  <span class="comment">// 子模块调用子模块的action 可以 将 commit的第三个参数 设置成  &#123; root: true &#125; 就表示当前的context不是子模块了 而是父模块</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除此之外，我们发现在页面刷新的时候，本来应该拥有权限的页面出现了404，这是因为404的匹配权限放在了静态路由，而动态路由在没有addRoutes之前，找不到对应的地址，就会显示404，所以我们需要将404放置到动态路由的最后</p>
<p><strong><code>src/permission.js</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">addRoutes</span>([...routes, &#123; <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>, <span class="attr">redirect</span>: <span class="string">&#x27;/404&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;]) <span class="comment">// 添加到路由表</span></span><br></pre></td></tr></table></figure>

<p><strong>提交代码</strong></p>
<h2 id="功能权限应用"><a href="#功能权限应用" class="headerlink" title="功能权限应用"></a>功能权限应用</h2><p><strong>目标</strong>： 实现功能权限的应用</p>
<h3 id="功能权限的受控思路"><a href="#功能权限的受控思路" class="headerlink" title="功能权限的受控思路"></a>功能权限的受控思路</h3><blockquote>
<p> 上小节中，当我们拥有了一个模块，一个页面的访问权限之后，页面中的某些功能，用户可能有，也可能没有，这就是功能权限</p>
</blockquote>
<p>这就是上小节，查询出来的数据中的**<code>points</code>**</p>
<blockquote>
<p> 比如，我们想对员工管理的删除功能做个权限怎么做？</p>
</blockquote>
<p>首先需要在员工管理的权限点下， 新增一个删除权限点，启用</p>
<p><img src="/assets/image-20200730020732919.png" alt="image-20200730020732919"></p>
<blockquote>
<p>  我们要做的就是看看用户，是否拥有<strong>point-user-delete</strong>这个point，有就可以让删除能用，没有就隐藏或者禁用</p>
</blockquote>
<h3 id="使用Mixin技术将检查方法注入"><a href="#使用Mixin技术将检查方法注入" class="headerlink" title="使用Mixin技术将检查方法注入"></a>使用Mixin技术将检查方法注入</h3><p>所以，我们可以采用一个新的技术 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/mixins.html">mixin(混入)</a>来让所有的组件可以拥有一个公共的方法</p>
<p><strong><code>src/mixin/checkPermission.js</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">checkPermission</span>(<span class="params">key</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; userInfo &#125; = store.<span class="property">state</span>.<span class="property">user</span></span><br><span class="line">      <span class="keyword">if</span> (userInfo.<span class="property">roles</span>.<span class="property">points</span> &amp;&amp; userInfo.<span class="property">roles</span>.<span class="property">points</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> userInfo.<span class="property">roles</span>.<span class="property">points</span>.<span class="title function_">some</span>(<span class="function"><span class="params">item</span> =&gt;</span> item === key)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>在员工组件中检查权限点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button :disabled=&quot;!checkPermission(&#x27;POINT-USER-UPDATE&#x27;)&quot; type=&quot;text&quot; size=&quot;small&quot; @click=&quot;$router.push(`/employees/detail/$&#123;obj.row.id&#125;`)&quot;&gt;查看&lt;/el-button&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时，可以通过配置权限的方式，检查权限的可用性了</p>
<p><strong>提交代码</strong></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-小程序笔记x" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/21/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AC%94%E8%AE%B0x/" class="article-date">
  	<time datetime="2022-08-21T08:41:34.473Z" itemprop="datePublished">2022-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="小程序-z-index"><a href="#小程序-z-index" class="headerlink" title="小程序 z-index"></a>小程序 z-index</h1><p>z-index必须是双方组件都有position熟悉下才会生效。如果你上级，注意不是父级，很多文档在这块都误导人，说成父级，注意，你想在上层，那么就需要两个组件都需要有position属性。</p>
<h1 id="小程序应用生命周期"><a href="#小程序应用生命周期" class="headerlink" title="小程序应用生命周期"></a>小程序应用生命周期</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.js    小程序的生命周期函数在 app.js 中声明</span></span><br><span class="line"><span class="title class_">App</span>(&#123;</span><br><span class="line">  <span class="attr">onLaunch</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; </span><br><span class="line">      <span class="comment">//小程序初始化(全局只触发一次)</span></span><br><span class="line">      <span class="comment">// 在onLaunch函数中，我们可以像其中添加自己想要进行的初始操作，例如获取用户信息、申请权限、获取服务器数据等，为小程序的后续功能提供方便。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onShow</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//小程序显示</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onHide</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//小程序隐藏</span></span><br><span class="line">      <span class="comment">// onHide的时间点是微信小程序被切到后台时开始执行。通过onHide函数，我们可以实现小程序被切到后台后，计时器暂停计时、统计切后台次数等自己想要的功能。</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onError</span>: <span class="keyword">function</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">      <span class="comment">//小程序错误</span></span><br><span class="line">      <span class="comment">// onError函数的执行时间点是在我们的代码运行出错时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>用户首次打开小程序，触发 <code>onLaunch</code>（全局只触发一次）。</li>
<li>小程序初始化完成后，触发 <code>onShow</code> 方法，监听小程序显示。</li>
<li>小程序从前台进入后台，触发 <code>onHide</code> 方法。</li>
<li>小程序从后台进入前台显示，触发 <code>onShow</code> 方法。</li>
<li>小程序后台运行一定时间，会被销毁。</li>
<li>小程序出错，触发<code>onError</code></li>
</ul>
<blockquote>
<p>onLaunch, onShow 方法会返回一个参数对象， 里面包含了三个参数 ， path,query和scene ，path是打开小程序的路径</p>
</blockquote>
<p>query是打开小程序页面url的参数，scene是打开小程序的场景值</p>
<h1 id="页面的生命周期"><a href="#页面的生命周期" class="headerlink" title="页面的生命周期"></a>页面的生命周期</h1><ul>
<li>进入页面，触发<code>onLoad</code>方法(类似于vue中的created)，返回不触发,实测跳转到tab页面，onload也不会触发。</li>
<li>页面载入后触发<code>onShow</code>方法，显示页面。</li>
<li>页面未在页面栈中，初次加载页面，会触发<code>onReady</code>(类似于vue中的mounted)方法，渲染页面元素和样式</li>
<li>离开本页面时，触发<code>onHide</code>方法。</li>
<li>当页面从页面栈中被销毁时，触发<code>onUnload</code>方法</li>
</ul>
<h1 id="组件生命周期"><a href="#组件生命周期" class="headerlink" title="组件生命周期"></a>组件生命周期</h1><p>组件的生命周期，指的是组件自身的一些函数，这些函数在特殊的时间点或遇到一些特殊的框架事件时被自动触发。</p>
<p>其中，最重要的生命周期是 <code>created</code> <code>attached</code> <code>detached</code> ，包含一个组件实例生命流程的最主要时间点。</p>
<ul>
<li>组件实例刚刚被创建好时， <code>created</code> 生命周期被触发。此时，组件数据 <code>this.data</code> 就是在 <code>Component</code> 构造器中定义的数据 <code>data</code> 。 <strong>此时还不能调用 <code>setData</code> 。</strong> 通常情况下，这个生命周期只应该用于给组件 <code>this</code> 添加一些自定义属性字段。</li>
<li>在组件完全初始化完毕、进入页面节点树后， <code>attached</code> 生命周期被触发。此时， <code>this.data</code> 已被初始化为组件的当前值。这个生命周期很有用，绝大多数初始化工作可以在这个时机进行。</li>
<li>在组件离开页面节点树后， <code>detached</code> 生命周期被触发。退出一个页面时，如果组件还在页面节点树中，则 <code>detached</code> 会被触发。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/lifetimes.html">【生命周期参考】</a></p>
<h5 id="定义生命周期方法"><a href="#定义生命周期方法" class="headerlink" title="定义生命周期方法"></a>定义生命周期方法</h5><p>生命周期方法可以直接定义在 <code>Component</code> 构造器的第一级参数中。</p>
<p>自小程序基础库版本 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">2.2.3</a> 起，组件的的生命周期也可以在 <code>lifetimes</code> 字段内进行声明（这是推荐的方式，其优先级最高）。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Component</span>(&#123;</span><br><span class="line">  <span class="attr">lifetimes</span>: &#123;</span><br><span class="line">    <span class="attr">attached</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 在组件实例进入页面节点树时执行</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">detached</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 在组件实例被从页面节点树移除时执行</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 以下是旧式的定义方式，可以保持对 &lt;2.2.3 版本基础库的兼容</span></span><br><span class="line">  <span class="attr">attached</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 在组件实例进入页面节点树时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">detached</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 在组件实例被从页面节点树移除时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="可用的全部生命周期"><a href="#可用的全部生命周期" class="headerlink" title="可用的全部生命周期"></a>可用的全部生命周期</h5><p>如下表所示。</p>
<table>
<thead>
<tr>
<th align="left">生命周期</th>
<th align="left">参数</th>
<th align="left">描述</th>
<th align="left">最低版本</th>
</tr>
</thead>
<tbody><tr>
<td align="left">created</td>
<td align="left">无</td>
<td align="left">在组件实例刚刚被创建时执行，不能执行数据赋值操作 beforeCreated</td>
<td align="left"><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">1.6.3</a></td>
</tr>
<tr>
<td align="left">attached</td>
<td align="left">无</td>
<td align="left">在组件实例进入页面节点树时执行 created 对组件进行赋值操作</td>
<td align="left"><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">1.6.3</a></td>
</tr>
<tr>
<td align="left">ready</td>
<td align="left">无</td>
<td align="left">在组件在视图层布局完成后执行 mounted</td>
<td align="left"><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">1.6.3</a></td>
</tr>
<tr>
<td align="left">moved</td>
<td align="left">无</td>
<td align="left">在组件实例被移动到节点树另一个位置时执行</td>
<td align="left"><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">1.6.3</a></td>
</tr>
<tr>
<td align="left">detached</td>
<td align="left">无</td>
<td align="left">在组件实例被从页面节点树移除时执行 destoryed</td>
<td align="left"><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">1.6.3</a></td>
</tr>
<tr>
<td align="left">error</td>
<td align="left"><code>Object Error</code></td>
<td align="left">每当组件方法抛出错误时执行</td>
<td align="left"><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">2.4.1</a></td>
</tr>
</tbody></table>
<h1 id="页面间跳转"><a href="#页面间跳转" class="headerlink" title="页面间跳转"></a>页面间跳转</h1><h2 id="wx-navigateTo"><a href="#wx-navigateTo" class="headerlink" title="wx.navigateTo"></a>wx.navigateTo</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">button bindtap=<span class="string">&quot;jumpInfo&quot;</span> data-id=<span class="string">&quot;1&quot;</span>&gt;跳转&lt;/button&gt;</span><br><span class="line"></span><br><span class="line"><span class="title function_">jumpInfo</span>(<span class="params">e</span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> id=e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">id</span></span><br><span class="line"></span><br><span class="line">  wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//最好使用绝对路径</span></span><br><span class="line"></span><br><span class="line">   <span class="attr">url</span>:<span class="string">`./info/index?id=<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"> &#125;,</span><br><span class="line"></span><br><span class="line">在跳转过去的页面的</span><br><span class="line"></span><br><span class="line"> <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(options);   可以获得携带过来的参数</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>



<h2 id="wx-switchTab-Object-object"><a href="#wx-switchTab-Object-object" class="headerlink" title="wx.switchTab(Object object)"></a>wx.switchTab(Object object)</h2><blockquote>
<p>本接口从基础库版本 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">2.3.1</a> 起支持在小程序插件中使用</p>
</blockquote>
<p>跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面,并会清空页面栈中其他的页面路径</p>
<p>在小程序插件中使用时，只能在当前插件的页面中调用</p>
<h2 id="wx-reLaunch-Object-object"><a href="#wx-reLaunch-Object-object" class="headerlink" title="wx.reLaunch(Object,object)"></a>wx.reLaunch(Object,object)</h2><p>关闭所有页面(会清空页面栈中其他的页面路径)，打开到应用内的某个页面</p>
<p>在小程序插件中使用时，只能在当前插件的页面中调用</p>
<h2 id="wx-redirectTo-Object-object"><a href="#wx-redirectTo-Object-object" class="headerlink" title="wx.redirectTo(Object object)"></a>wx.redirectTo(Object object)</h2><p>关闭当前页面，跳转到应用内的某个页面。注意再次返回的时候返回的是来之前的页面,因为</p>
<p>wx.redirectTo执行的是替换页面栈里的路径.但是不允许跳转到 tabbar 页面。</p>
<p>在小程序插件中使用时，只能在当前插件的页面中调用</p>
<h2 id="wx-navigateBack-Object-object"><a href="#wx-navigateBack-Object-object" class="headerlink" title="wx.navigateBack(Object object)"></a>wx.navigateBack(Object object)</h2><p>注意使用方法与上面的不同</p>
<blockquote>
<p>  wx.navigateBack({</p>
<p>   url:<code>./info/index?id=$&#123;id&#125;</code></p>
<p>  })</p>
</blockquote>
<p>关闭当前页面，返回上一页面或多级页面。可通过 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/getCurrentPages.html">getCurrentPages</a> 获取当前的页面栈，决定需要返回几层。</p>
<p>在小程序插件中使用时，只能在当前插件的页面中调用</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">默认值</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">delta</td>
<td align="left">number</td>
<td align="left">1</td>
<td align="left">否</td>
<td align="left">返回的页面数，如果 delta 大于现有页面数，则返回到首页。</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">function</td>
<td align="left"></td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">function</td>
<td align="left"></td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">function</td>
<td align="left"></td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">back</span>(<span class="params"></span>) &#123;</span><br><span class="line">   wx.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">     <span class="attr">delta</span>: <span class="number">1</span>,</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>



<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：调用 navigateTo 跳转时，调用该方法的页面会被加入堆栈，而 redirectTo 方法则不会。见下方示例代码</span></span><br><span class="line"><span class="comment">// navigateBack(&#123;</span></span><br><span class="line"><span class="comment">//      delta: 1, 这种方法返回上一个页面页面栈必须有值,换句话说如果上一个页面是用的redirectTo跳转而来的,那么这个方法则会达不到效果</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处是A页面</span></span><br><span class="line">wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;B?id=1&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处是B页面</span></span><br><span class="line">wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;C?id=1&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在C页面内 navigateBack，将返回A页面</span></span><br><span class="line">wx.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">  <span class="attr">delta</span>: <span class="number">2</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h1 id="组件间传值"><a href="#组件间传值" class="headerlink" title="组件间传值"></a>组件间传值</h1><p>父传子</p>
<p>首先在组件的js文件里写接收父组件的名字prop</p>
<p>Component({</p>
<p>  &#x2F;**</p>
<p>  * 组件的属性列表</p>
<p>  *&#x2F;</p>
<p>  properties: {</p>
<p>  prop:{</p>
<p>​    type:Object,</p>
<p>​    value:”默认值”</p>
<p>  }</p>
<p>  },</p>
<p>接着在组件里使用</p>
<view class="mask" >

  <view class="ui" >



<p>​     <view class="cancel" bindtap="cancelUiCourse">X</view></p>
<p>​     <view class="xiaogun"></view></p>
<p>​     <view class="course" style=""></p>
<p>​      <view></view></p>
<p>​      <view></view></p>
<p>​     </view></p>
  </view>



</view>

<p>接着父组件中 传值prop&#x3D;”“</p>
<p><mask bind:closeMask="closeMask" prop="" wx:if=""></mask></p>
<p>子传父</p>
<p>首先子组件触发事件</p>
<p>bindtap&#x3D;”cancelUiCourse”</p>
<view class="mask" >

  <view class="ui" >

<p>   2423423</p>
<p>​     <view class="cancel" bindtap="cancelUiCourse">X</view></p>
<p>​     <view class="xiaogun"></view></p>
<p>​     <view class="course" style=""></p>
<p>​      <view></view></p>
<p>​      <view></view></p>
<p>​     </view></p>
  </view>



</view>

<p>接着发射事件,并传参数</p>
<p> cancelUiCourse(){</p>
<p>​     this.triggerEvent(‘closeMask’,false)</p>
<p>   }</p>
<p>接着父组件里接收并调用</p>
<p><mask bind:closeMask="closeMask" prop="" wx:if=""></mask></p>
<p>closeMask(e)</p>
<p> {</p>
<p>  &#x2F;&#x2F; console.log(e);</p>
<p>  this.setData({</p>
<p>   isMaskShow:e.detail  注意detail里才能获取到</p>
<p>  })</p>
<p> },</p>
<h1 id="组件插槽的使用"><a href="#组件插槽的使用" class="headerlink" title="组件插槽的使用"></a>组件插槽的使用</h1><p>定义组件</p>
<p>首先在需要使用组件的页面的json文件里</p>
<p> “usingComponents”: {</p>
<p>  “coma”:”&#x2F;components&#x2F;coma&#x2F;coma”,</p>
<p>  “mask”:”&#x2F;components&#x2F;mask&#x2F;index”</p>
<p> }</p>
<p>组件coma</p>
<p><text>comA组件</text></p>
<p><slot name="top"></slot></p>
<p><slot name="left"></slot></p>
<p><slot name="right"></slot></p>
<p>接着在页面使用</p>
<p>组件<coma></p>
<p>  <view slot="top">这是上面的组件</view></p>
<p>  <view slot="left">这是左面的组件</view></p>
<p>  <view slot="right">这是右面的组件</view></p>
</coma>



<h1 id="使用bool类型充当属性-checked"><a href="#使用bool类型充当属性-checked" class="headerlink" title="使用bool类型充当属性 checked"></a>使用bool类型充当属性 checked</h1><p>  1 字符串和 花括号之间一定不要存在空格 否则会导致识别失败 </p>
<p>   以下写法就是错误的示范</p>
<p>​     <checkbox checked="    "> </checkbox></p>
<h1 id="列表循环"><a href="#列表循环" class="headerlink" title="列表循环"></a>列表循环</h1><p>  1 wx:for&#x3D;”“ wx:for-item&#x3D;”循环项的名称” wx:for-index&#x3D;”循环项的索引”</p>
<p>  2 wx:key&#x3D;”唯一的值” 用来提高列表渲染的性能</p>
<p>   1 wx:key 绑定一个普通的字符串的时候 那么这个字符串名称 肯定是 循环数组 中的 对象的 唯一属性</p>
<p>   2 wx:key &#x3D;”*this” 就表示 你的数组 是一个普通的数组 *this 表示是 循环项 </p>
<p>​    [1,2,3,44,5]</p>
<p>​    [“1”,”222”,”adfdf”]</p>
<p>  3 当出现 数组的嵌套循环的时候 尤其要注意 以下绑定的名称 不要重名</p>
<p>​    wx:for-item&#x3D;”item” wx:for-index&#x3D;”index”</p>
<p>  4 默认情况下 我们 不写</p>
<p>​    wx:for-item&#x3D;”item” wx:for-index&#x3D;”index”</p>
<p>​    小程序也会把 循环项的名称 和 索引的名称 item 和 index </p>
<p>​    只有一层循环的话 （wx:for-item&#x3D;”item” wx:for-index&#x3D;”index”） 可以省略</p>
<p> 9 对象循环</p>
<p>  1 wx:for&#x3D;”“ wx:for-item&#x3D;”对象的值” wx:for-index&#x3D;”对象的属性”</p>
<p>  2 循环对象的时候 最好把 item和index的名称都修改一下</p>
<p>   wx:for-item&#x3D;”value” wx:for-index&#x3D;”key”</p>
<p> –&gt;</p>
 <view>

<p>  &lt;view </p>
<p> wx:for&#x3D;”“</p>
<p> wx:for-item&#x3D;”item”</p>
<p> wx:for-index&#x3D;”index”</p>
<p> wx:key&#x3D;”id”</p>
<p>  &gt;</p>
<p>   索引：</p>
<p>   --</p>
<p>   值:</p>
  </view>

 </view>



 <view>

<p>  <view>对象循环</view></p>
<p>  &lt;view </p>
<p> wx:for&#x3D;”“</p>
<p> wx:for-item&#x3D;”value” </p>
<p> wx:for-index&#x3D;”key”</p>
<p> wx:key&#x3D;”age”</p>
<p> &gt;</p>
<p>   属性:</p>
<p>   --</p>
<p>   值:</p>
  </view>

<h1 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h1><p>   1 wx:if&#x3D;”Infinity“</p>
<p>​    1 if , else , if else</p>
<p>​    wx:if</p>
<p>​    wx:elif</p>
<p>​    wx:else </p>
<p>   2 hidden </p>
<p>​    1 在标签上直接加入属性 hidden </p>
<p>​    2 hidden&#x3D;”true“</p>
<p>   3 什么场景下用哪个</p>
<p>​    1 当标签不是频繁的切换显示 优先使用 wx:if</p>
<p>​     直接把标签从 页面结构给移除掉 </p>
<p>​    2 当标签频繁的切换显示的时候 优先使用 hidden</p>
<p>​     通过添加样式的方式来切换显示 </p>
<p>​     hidden 属性 不要和 样式 display一起使用因为hidden是通过display:none来实现显示和隐藏的 再使用display会把原来的覆盖</p>
<h1 id="计算rpx"><a href="#计算rpx" class="headerlink" title="计算rpx"></a>计算rpx</h1><p>4 利用 一个属性 calc属性 css 和 wxss 都支持 一个属性</p>
<p> 1 750 和 rpx 中间不要留空格</p>
<p> 2 运算符的两边也不要留空格</p>
<p> *&#x2F;</p>
<p> view{</p>
<p>  &#x2F;* width: 200rpx; *&#x2F;</p>
<p>  height: 200rpx;</p>
<p>  font-size: 40rpx;</p>
<p>  background-color: aqua;</p>
<p> &#x2F;* 以下代码写法是错误 *&#x2F;</p>
<p> &#x2F;* width:750 rpx * 100 &#x2F; 375 ; *&#x2F;</p>
<p> width:calc(750rpx * 100 &#x2F; 375);</p>
<p> }</p>
<p>-- </p>
<h1 id="image-图片标签"><a href="#image-图片标签" class="headerlink" title="image 图片标签"></a>image 图片标签</h1><p> 1 src 指定要加载的图片的路径</p>
<p>  图片存在默认的宽度和高度 320 * 240   原图大小是 200 * 100</p>
<p> 2 mode 决定 图片内容 如何 和 图片标签 宽高 做适配</p>
<p>  1 scaleToFill 默认值 不保持纵横比缩放图片，使图片的宽高完全拉伸至填满 image 元素 </p>
<p>  2 aspectFit 保持宽高比 确保图片的长边 显示出来  页面轮播图 常用</p>
<p>  3 aspectFill 保持纵横比缩放图片，只保证图片的 短 边能完全显示出来。 少用</p>
<p>  4 widthFix 以前web的图片的 宽度指定了之后 高度 会自己按比例来调整  常用 </p>
<p>  5 bottom。。 类似以前的backgroud-position </p>
<p> 3 小程序当中的图片 直接就支持 懒加载 lazy-load</p>
<p>  1 lazy-load 会自己判断 当 图片 出现在 视口 上下 三屏的高度 之内的时候 自己开始加载图片 </p>
<p> –&gt;</p>
 <image mode="bottom" lazy-load src="https://tva2.sinaimg.cn/large/007DFXDhgy1g51jlzfb4lj305k02s0sp.jpg" />

<h1 id="轮播图外层容器-swiper"><a href="#轮播图外层容器-swiper" class="headerlink" title="轮播图外层容器 swiper"></a>轮播图外层容器 swiper</h1><p> 2 每一个轮播项 swiper-item</p>
<p> 3 swiper标签 存在默认样式</p>
<p>  1 width 100%</p>
<p>  2 height 150px  image 存在默认宽度和高度 320 * 240 </p>
<p>  3 swiper 高度 无法实现由内容撑开 </p>
<p> 4 先找出来 原图的宽度和高度 等比例 给swiper 定 宽度和高度</p>
<p>  原图的宽度和高度 1125 * 352 px</p>
<p>  swiper 宽度 &#x2F; swiper 高度 &#x3D; 原图的宽度 &#x2F; 原图的高度</p>
<p>  swiper 高度 &#x3D; swiper 宽度 * 原图的高度 &#x2F; 原图的宽度</p>
<p>  height: 100vw * 352 &#x2F; 1125</p>
<p> 5 autoplay 自动轮播</p>
<p> 6 interval 修改轮播时间</p>
<p> 7 circular 衔接轮播</p>
<p> 8 indicator-dots 显示 指示器 分页器 索引器 </p>
<p> 9 indicator-color 指示器的未选择的颜色 </p>
<p> 10 indicator-active-color 选中的时候的指示器的颜色 </p>
<p> –&gt;</p>
<swiper autoplay interval="1000" circular indicator-dots indicator-color="#0094ff" indicator-active-color="#ff0094">

<p>  <swiper-item> <image mode="widthFix" src="//gw.alicdn.com/imgextra/i1/44/O1CN013zKZP11CCByG5bAeF_!!44-0-lubanu.jpg" /> </swiper-item></p>
<p>  <swiper-item> <image mode="widthFix" src="//aecpm.alicdn.com/simba/img/TB1CWf9KpXXXXbuXpXXSutbFXXX.jpg_q50.jpg" /> </swiper-item></p>
<p>  <swiper-item> <image mode="widthFix" src="//gw.alicdn.com/imgextra/i2/37/O1CN01syHZxs1C8zCFJj97b_!!37-0-lubanu.jpg" /> </swiper-item></p>
</swiper>

<h1 id="导航组件-navigator"><a href="#导航组件-navigator" class="headerlink" title="导航组件 navigator"></a>导航组件 navigator</h1><p> 0 块级元素 默认会换行 可以直接加宽度和高度 </p>
<p> 1 url 要跳转的页面路径 绝对路径 相对路径</p>
<p> 2 target 要跳转到当前的小程序 还是其他的小程序的页面</p>
<p>  self 默认值 自己 小程序的页面 </p>
<p>  miniProgram 其他的小程序的页面</p>
<p> 3 open-type 跳转的方式</p>
<p>  1 navigate 默认值 保留当前页面，跳转到应用内的某个页面，但是不能跳到 tabbar 页面</p>
<p>  2 redirect 关闭当前页面，跳转到应用内的某个页面，但是不允许跳转到 tabbar 页面。</p>
<p>  3 switchTab 跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面</p>
<p>  4 reLaunch 关闭所有页面，打开到应用内的某个页面</p>
<p> –&gt;</p>
<p> <navigator url="/pages/demo10/demo10"> 轮播图页面 </navigator></p>
<p> <navigator url="/pages/index/index"> 直接跳转到 tabbar页面 </navigator></p>
<p> <navigator open-type="redirect" url="/pages/demo10/demo10"> 轮播图页面 redirect </navigator></p>
<p> <navigator open-type="switchTab" url="/pages/index/index"> switchTab直接跳转到 tabbar页面 </navigator></p>
<p> <navigator open-type="reLaunch" url="/pages/index/index"> reLaunch 可以随便跳 </navigator> </p>
<h1 id="rich-text-富文本标签"><a href="#rich-text-富文本标签" class="headerlink" title="rich-text 富文本标签"></a>rich-text 富文本标签</h1><p> 1 nodes属性来实现</p>
<p>  1 接收标签字符串 </p>
<p>  2 接收对象数组 </p>
<p> –&gt;</p>
<p> <rich-text nodes=""></rich-text></p>
<p>Page({</p>
<p> data: {</p>
<p>   1 标签字符串 最常用的</p>
<p>   html:’&lt;div class&#x3D;”tpl-wrapper” data-tpl-id&#x3D;”m_h_v31icon_1” style&#x3D;”margin…..</p>
<h1 id="button-标签"><a href="#button-标签" class="headerlink" title="button 标签"></a>button 标签</h1><p> 1 外观的属性</p>
<p>  1 size 控制按钮的大小</p>
<p>   1 default 默认大小</p>
<p>   2 mini 小尺寸</p>
<p>  2 type 用来控制按钮的颜色</p>
<p>   1 default 灰色</p>
<p>   2 primary 绿色</p>
<p>   3 warn 红色</p>
<p>  3 plain 按钮是否镂空，背景色透明</p>
<p>  4 loading 文字前显示正在等待图标</p>
<p> –&gt;</p>
<p> <button>默认按钮</button></p>
<p> <button size="mini"> mini 默认按钮</button></p>
<p> <button type="primary"> primary 按钮</button> </p>
<p> <button type="warn"> warn 按钮</button> </p>
<p> <button type="warn" plain> plain 按钮</button> </p>
<p> <button type="primary" loading> loading 按钮</button> </p>
<h1 id="button-开发能力"><a href="#button-开发能力" class="headerlink" title="button 开发能力"></a>button 开发能力</h1><p> open-type：</p>
<p> 1 contact 直接打开 客服对话功能 需要在微信小程序的后台配置  只能够通过真机调试来打开 </p>
<p> 2 share 转发当前的小程序 到微信朋友中  不能把小程序 分享到 朋友圈 </p>
<p> 3 getPhoneNumber 获取当前用户的手机号码信息 结合一个事件来使用 不是企业的小程序账号 没有权限来获取用户的手机号码 </p>
<p>  1 绑定一个事件 bindgetphonenumber </p>
<p>  2 在事件的回调函数中 通过参数来获取信息 </p>
<p>  3 获取到的信息 已经加密过了 </p>
<p>   需要用户自己待见小程序的后台服务器，在后台服务器中进行解析 手机号码，返回到小程序中 就可以看到信息了</p>
<p> 4 getUserInfo 获取当前用户的个人信息</p>
<p>  1 使用方法 类似 获取用户的手机号码</p>
<p>  2 可以直接获取 不存在加密的字段 </p>
<p> 5 launchApp 在小程序当中 直接打开 app</p>
<p>  1 需要现在 app中 通过app的某个链接 打开 小程序</p>
<p>  2 在小程序 中 再通过 这个功能 重新打开 app</p>
<p>  3 找到 京东的app 和 京东的小程序 </p>
<p> 6 openSetting 打开小程序内置的 授权页面</p>
<p>  1 授权页面中 只会出现 用户曾经点击过的 权限 </p>
<p> 7 feedback 打开 小程序内置的 意见反馈页面 </p>
<p>  1 只能够通过真机调试来打开 </p>
<p> –&gt;</p>
<p><button open-type="contact">contact</button></p>
<p><button open-type="share">share</button></p>
<p><button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">getPhoneNumber</button></p>
<p><button open-type="getUserInfo" bindgetuserinfo="getUserInfo">getUserInfo</button></p>
<p><button open-type="launchApp">launchApp</button></p>
<p><button open-type="openSetting">openSetting</button></p>
<p><button open-type="feedback">feedback</button></p>
<p>Page({</p>
<p> &#x2F;&#x2F; 获取用户的手机号码信息</p>
<p> getPhoneNumber(e){</p>
<p>  console.log(e);</p>
<p> },</p>
<p> &#x2F;&#x2F; 获取用户个人信息</p>
<p> getUserInfo(e){</p>
<p>  console.log(e);</p>
<p> }</p>
<p>})</p>
<h1 id="操作数组最好深拷贝"><a href="#操作数组最好深拷贝" class="headerlink" title="操作数组最好深拷贝"></a>操作数组最好深拷贝</h1><p>var newArr &#x3D; JSON.parse(JSON.stringify(this.data.list));</p>
<p>直接修改也可以但是深拷贝更规范</p>
<h1 id="网络请求"><a href="#网络请求" class="headerlink" title="网络请求"></a>网络请求</h1><p>使用 <code>wx.request</code> 方法，<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html">详情参见官方API</a></p>
<p>](<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html">https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html</a>)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例: 请求豆瓣最新上映电影列表</span></span><br><span class="line">wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;http://www.bufantec.com/api/douban/movie/in_theaters&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">start</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">limit</span>: <span class="string">&quot;20&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">header</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> <span class="comment">// 默认值</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.apizza.net/project/219bd7da9f36824337b05a33e9e08c51/browse?pass=a511db3cf920386c952dd6bdfbcf42fd">获取豆瓣电影及电影详情</a></p>
<p><strong><code>wx.request</code> 返回数据说明: 第一个data 是微信返回的信息,data 里面的 data 才是后台返回给我们的数据</strong></p>
<h2 id="请求封装"><a href="#请求封装" class="headerlink" title="请求封装"></a>请求封装</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> baseUrl <span class="keyword">from</span> <span class="string">&quot;./baseUrl&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">function</span>(<span class="params">config</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,rejected</span>)=&gt;</span>&#123;</span><br><span class="line">    wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: baseUrl + config.<span class="property">url</span>,</span><br><span class="line">      <span class="attr">method</span>:config.<span class="property">method</span> ? (config.<span class="property">method</span>).<span class="title function_">toUpperCase</span>() :  <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">      <span class="comment">// method: (config.method).toUpperCase() || &quot;GET&quot;,</span></span><br><span class="line">      <span class="attr">data</span>:config.<span class="property">data</span>,</span><br><span class="line">      <span class="attr">header</span>:&#123;</span><br><span class="line">        <span class="string">&quot;content-type&quot;</span>:<span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">timeout</span>:<span class="number">5000</span>,</span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">        <span class="title function_">resolve</span>(res)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">fail</span>(<span class="params">res</span>)&#123;</span><br><span class="line">        <span class="title function_">rejected</span>(res)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request</span><br></pre></td></tr></table></figure>

<p>baseUrl.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var url = &quot;http://bufantec.com&quot;</span><br><span class="line"></span><br><span class="line">export default url</span><br></pre></td></tr></table></figure>

<h3 id="接着在相对应API页面"><a href="#接着在相对应API页面" class="headerlink" title="###接着在相对应API页面"></a>###接着在相对应API页面</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;../../request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">movieDetail</span>(<span class="params">data</span>)&#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line"></span><br><span class="line">   <span class="attr">url</span>:<span class="string">&quot;/api/douban/movie/subject&quot;</span>,</span><br><span class="line"></span><br><span class="line">   data</span><br><span class="line"></span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;movieDetail&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接着在响应页面使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">async</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> &#123;</span><br><span class="line"></span><br><span class="line">​     <span class="attr">data</span>: res</span><br><span class="line"></span><br><span class="line">   &#125; = <span class="keyword">await</span> <span class="title function_">comingsoon</span>(&#123;</span><br><span class="line"></span><br><span class="line">​     <span class="attr">start</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">start</span>,</span><br><span class="line"></span><br><span class="line">​     <span class="attr">limit</span>: <span class="number">10</span></span><br><span class="line"></span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;数据&quot;</span>, res);</span><br><span class="line"></span><br><span class="line">   <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line"></span><br><span class="line">​     <span class="attr">list</span>: res.<span class="property">data</span>.<span class="property">list</span>,</span><br><span class="line"></span><br><span class="line">​     <span class="attr">totalPage</span>: res.<span class="property">data</span>.<span class="property">totalPage</span></span><br><span class="line"></span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">list</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">或者<span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="title function_">coming_soon</span>(&#123;</span><br><span class="line">          <span class="attr">start</span>:<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">start</span>,</span><br><span class="line">          <span class="attr">limit</span>:<span class="number">5</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">list</span>:res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">list</span>,</span><br><span class="line">        <span class="attr">totalPage</span>:res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">totalPage</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h1 id="页面间通信"><a href="#页面间通信" class="headerlink" title="页面间通信"></a>页面间通信</h1><h5 id="第一种地址栏传递信息"><a href="#第一种地址栏传递信息" class="headerlink" title="第一种地址栏传递信息"></a>第一种地址栏传递信息</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">     <span class="attr">url</span>: <span class="string">`./info/index?name=<span class="subst">$&#123;libai&#125;</span>`</span>,</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>



<h5 id="第二种全局变量"><a href="#第二种全局变量" class="headerlink" title="第二种全局变量"></a>第二种全局变量</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.globalData</span><br><span class="line">// 在app.js中设置对象 globalData&#123;&#125;</span><br><span class="line">// 在要传值的页面引入 var app = getApp();</span><br><span class="line">app.globalData.name = &quot;王安石&quot;;</span><br><span class="line">// 在要接受值的页面引入  var app = getApp();</span><br><span class="line">console.log(app.globalData.name);</span><br></pre></td></tr></table></figure>

<h4 id="本地缓存"><a href="#本地缓存" class="headerlink" title="本地缓存"></a>本地缓存</h4><p><strong>注意</strong>:不同与浏览器本地缓存storage ，小程序本地缓存分为同步和异步操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 在要传值的页面</span><br><span class="line">wx.setStorageSync(&quot;name&quot;,&quot;陆游&quot;);</span><br><span class="line">// 在要接受值的页面</span><br><span class="line">wx.getStorageSync(&quot;name&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">remove</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="comment">// 移除某一条数据</span></span><br><span class="line">   wx.<span class="title function_">removeStorageSync</span>(<span class="string">&quot;age&quot;</span>)</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="title function_">clear</span>(<span class="params"></span>)&#123;</span><br><span class="line">   wx.<span class="title function_">clearStorageSync</span>()</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="title function_">getStorageInfo</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(wx.<span class="title function_">getStorageInfoSync</span>())</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="title function_">goInfo</span>(<span class="params">e</span>)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">id</span>);</span><br><span class="line">   <span class="keyword">var</span> id = e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">id</span>;</span><br><span class="line">   wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">   wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">     <span class="attr">url</span>: <span class="string">`./info/index`</span>,</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>

<p><img src="E:\MD学习笔记\图片笔记\数组循环.jpg"></p>
<h1 id="小程序获取用户权限"><a href="#小程序获取用户权限" class="headerlink" title="小程序获取用户权限"></a>小程序获取用户权限</h1><p>1.open-data获取</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//若要对组件设置样式必须给父级元素设置</span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123; isLogin &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">open-data</span>  <span class="attr">type</span>=<span class="string">&quot;userAvatarUrl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">open-data</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">open-data</span> <span class="attr">type</span>=<span class="string">&quot;userNickName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">open-data</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    当前状态为:&#123;&#123; status1 &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;button bindtap=<span class="string">&quot;openSettings&quot;</span> <span class="attr">wx</span>:<span class="keyword">if</span>=<span class="string">&quot;&#123;&#123;isShow&#125;&#125;&quot;</span>&gt;</span><br><span class="line">  打开设置界面</span><br><span class="line">&lt;/button&gt;</span><br><span class="line"><span class="comment">//button点击触发openSettings函数自动跳转到设置页面(注意这个跳转api必须要用按钮触发)</span></span><br><span class="line">文档<span class="attr">https</span>:<span class="comment">//developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/wx.openSetting.html</span></span><br><span class="line"><span class="title function_">openSettings</span>(<span class="params"></span>)&#123;</span><br><span class="line">    wx.<span class="title function_">openSetting</span>(&#123;</span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">fail</span>(<span class="params">res</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onShow</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ciname&quot;</span>)</span><br><span class="line">     <span class="comment">// wx.getSetting(Object object)</span></span><br><span class="line"><span class="comment">//基础库 1.2.0 开始支持，低版本需做兼容处理。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//本接口从基础库版本 2.6.3 起支持在小程序插件中使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//wx.getSetting获取用户的当前设置。返回值中只会出现小程序已经向用户请求过的权限。</span></span><br><span class="line">    wx.<span class="title function_">getSetting</span>(&#123;</span><br><span class="line">     [文档] (<span class="attr">https</span>:<span class="comment">//developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/wx.getSetting.html)</span></span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="comment">// 以前没有授权过小程序应用访问定位</span></span><br><span class="line">        <span class="keyword">if</span>(res.<span class="property">authSetting</span>[<span class="string">&quot;scope.userLocation&quot;</span>] == <span class="literal">undefined</span>)&#123;</span><br><span class="line">            <span class="comment">//提前发起授权请求</span></span><br><span class="line">       <span class="comment">//开发者可以使用 wx.authorize 在调用需授权 API 之前，提前向用户发起授权请求。</span></span><br><span class="line">            wx.<span class="title function_">authorize</span>(&#123;</span><br><span class="line">                文档<span class="attr">https</span>:<span class="comment">//developers.weixin.qq.com/miniprogram/dev/api/open-api/authorize/wx.authorize.html</span></span><br><span class="line">              <span class="attr">scope</span>:<span class="string">&quot;scope.userLocation&quot;</span>,</span><br><span class="line">              <span class="title function_">success</span>(<span class="params">res1</span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(res1);</span><br><span class="line">                _this.<span class="title function_">getLocation</span>();</span><br><span class="line">                <span class="comment">// if(res1.errMsg == &quot;authorize:ok&quot;)&#123;</span></span><br><span class="line">                <span class="comment">//   _this.getLocation();</span></span><br><span class="line">                <span class="comment">// &#125;else&#123;</span></span><br><span class="line">                <span class="comment">//  </span></span><br><span class="line">                <span class="comment">// &#125;</span></span><br><span class="line">                </span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="title function_">fail</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;拒绝授权&quot;</span>);</span><br><span class="line">                wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                      <span class="attr">title</span>: <span class="string">&#x27;请点击按钮去授予小程序访问定位权限&#x27;</span>,</span><br><span class="line">                      <span class="attr">icon</span>:<span class="string">&quot;none&quot;</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                  <span class="comment">//拒绝授权后跳转按钮出现用户点击跳转到设置页面</span></span><br><span class="line">                    _this.<span class="title function_">setData</span>(&#123;</span><br><span class="line">                      <span class="attr">isShow</span>:<span class="literal">true</span></span><br><span class="line">                    &#125;)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(res.<span class="property">authSetting</span>[<span class="string">&quot;scope.userLocation&quot;</span>] == <span class="literal">false</span>)&#123;</span><br><span class="line">          <span class="comment">// 拒绝授权 同样提示用户需要获取权限,按钮出现跳转到设置页面</span></span><br><span class="line">          wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;请点击按钮去授予小程序访问定位权限&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>:<span class="string">&quot;none&quot;</span></span><br><span class="line">          &#125;)</span><br><span class="line">          _this.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">isShow</span>:<span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="comment">// 授权成功 用户同意授权直接调用getLocation()方法</span></span><br><span class="line">          _this.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">isShow</span>:<span class="literal">false</span></span><br><span class="line">          &#125;)</span><br><span class="line">          _this.<span class="title function_">getLocation</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">getLocation</span>(<span class="params"></span>)&#123;</span><br><span class="line">    qqmapsdk = <span class="keyword">new</span> <span class="title class_">QQMapWX</span>(&#123;</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;ZKOBZ-UNLCJ-IHBFE-KNJA4-6FO27-CZBLM&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">      wx.<span class="title function_">getLocation</span>(&#123;</span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">        qqmapsdk.<span class="title function_">search</span>(&#123;</span><br><span class="line">          <span class="attr">keyword</span>:<span class="string">&quot;影院&quot;</span>,</span><br><span class="line">          <span class="attr">location</span>:&#123;</span><br><span class="line">            <span class="attr">latitude</span>: res.<span class="property">latitude</span>,</span><br><span class="line">            <span class="attr">longitude</span>: res.<span class="property">longitude</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="title function_">success</span>(<span class="params">result</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">            _this.<span class="title function_">setData</span>(&#123;</span><br><span class="line">              <span class="attr">list</span>:result.<span class="property">data</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>





<h1 id="自定义Tabbar"><a href="#自定义Tabbar" class="headerlink" title="自定义Tabbar"></a>自定义Tabbar</h1><h3 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h3><h4 id="1-配置信息"><a href="#1-配置信息" class="headerlink" title="1. 配置信息"></a>1. 配置信息</h4><ul>
<li>在 <code>app.json</code> 中的 <code>tabBar</code> 项指定 <code>custom</code> 字段，同时其余 <code>tabBar</code> 相关配置也补充完整。</li>
<li>所有 tab 页的 json 里需声明 <code>usingComponents</code> 项，也可以在 <code>app.json</code> 全局开启。</li>
</ul>
<p>示例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tabBar&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;custom&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;selectedColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;page/component/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;组件&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;page/API/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;接口&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;usingComponents&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-在根目录下"><a href="#2-在根目录下" class="headerlink" title="2.在根目录下"></a>2.在根目录下</h4><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210422223207967.png" alt="image-20210422223207967"></p>
<p>在wxml写对应样式</p>
<h2 id="自定义-tabBar"><a href="#自定义-tabBar" class="headerlink" title="自定义 tabBar"></a>自定义 tabBar</h2><blockquote>
<p>基础库 2.5.0 开始支持，低版本需做<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">兼容处理</a>。</p>
</blockquote>
<p>自定义 tabBar 可以让开发者更加灵活地设置 tabBar 样式，以满足更多个性化的场景。</p>
<p>在自定义 tabBar 模式下</p>
<ul>
<li>为了保证低版本兼容以及区分哪些页面是 tab 页，tabBar 的相关配置项需完整声明，但这些字段不会作用于自定义 tabBar 的渲染。</li>
<li>此时需要开发者提供一个自定义组件来渲染 tabBar，所有 tabBar 的样式都由该自定义组件渲染。推荐用 fixed 在底部的 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html">cover-view</a> + <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/component/cover-image.html">cover-image</a> 组件渲染样式，以保证 tabBar 层级相对较高。</li>
<li>与 tabBar 样式相关的接口，如 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/tab-bar/wx.setTabBarItem.html">wx.setTabBarItem</a> 等将失效。</li>
<li><strong>每个 tab 页下的自定义 tabBar 组件实例是不同的</strong>，可通过自定义组件下的 <code>getTabBar</code> 接口，获取当前页面的自定义 tabBar 组件实例。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//tabbar wxml文件</span></span><br><span class="line">&lt;cover-view <span class="keyword">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">cover-view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123; tabList &#125;&#125;&quot;</span> <span class="attr">data-path</span>=<span class="string">&quot;&#123;&#123; item.path &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;tabList&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;goPage&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">cover-image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; item.selectedImg &#125;&#125;&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;index == current &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cover-image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">cover-image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; item.img &#125;&#125;&quot;</span> <span class="attr">wx:else</span> <span class="attr">class</span>=<span class="string">&quot;img&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cover-image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">cover-view</span>&gt;</span></span></span><br><span class="line">&lt;/cover-view&gt;</span><br><span class="line"><span class="comment">//tabbar的js文件</span></span><br><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">current</span>:<span class="number">4</span>,</span><br><span class="line">    <span class="attr">tabList</span>:[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">img</span>:<span class="string">&quot;/static/icons/home.png&quot;</span>,</span><br><span class="line">        <span class="attr">selectedImg</span>:<span class="string">&quot;/static/icons/home-active.png&quot;</span>,</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&quot;/pages/home/index&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">img</span>:<span class="string">&quot;/static/icons/movie.png&quot;</span>,</span><br><span class="line">        <span class="attr">selectedImg</span>:<span class="string">&quot;/static/icons/movie-active.png&quot;</span>,</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&quot;/pages/movie/index&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">img</span>:<span class="string">&quot;/static/icons/ticket-active.png&quot;</span>,</span><br><span class="line">        <span class="attr">selectedImg</span>:<span class="string">&quot;/static/icons/ticket-active.png&quot;</span>,</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&quot;/pages/ticket/index&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">img</span>:<span class="string">&quot;/static/icons/cinema.png&quot;</span>,</span><br><span class="line">        <span class="attr">selectedImg</span>:<span class="string">&quot;/static/icons/cinema-active.png&quot;</span>,</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&quot;/pages/cinema/index&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">     </span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">img</span>:<span class="string">&quot;/static/icons/main.png&quot;</span>,</span><br><span class="line">        <span class="attr">selectedImg</span>:<span class="string">&quot;/static/icons/main-active.png&quot;</span>,</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&quot;/pages/main/index&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"> <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">goPage</span>(<span class="params">e</span>)&#123;</span><br><span class="line">      wx.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">path</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//接着在每一个tabbar跳转的页面</span></span><br><span class="line"> <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">     可写打印一下  <span class="variable language_">this</span>.<span class="title function_">getTabBar</span>()看看</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getTabBar</span>()</span><br><span class="line">      .<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">current</span>: <span class="number">0</span></span><br><span class="line">      &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h1 id="小程序加载页面检测token"><a href="#小程序加载页面检测token" class="headerlink" title="小程序加载页面检测token"></a>小程序加载页面检测token</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!wx.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>))&#123;</span><br><span class="line">      wx.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>:<span class="string">&quot;登录提示&quot;</span>,</span><br><span class="line">        <span class="attr">content</span>:<span class="string">&quot;暂未登录,是否跳转到登录页面&quot;</span>,</span><br><span class="line">        <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">          <span class="keyword">if</span>(res.<span class="property">confirm</span>)&#123;</span><br><span class="line">            <span class="comment">// 跳转到登录界面</span></span><br><span class="line">            wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">              <span class="attr">url</span>: <span class="string">&#x27;./login/index&#x27;</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="swiper动效"><a href="#swiper动效" class="headerlink" title="swiper动效"></a>swiper动效</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;view <span class="keyword">class</span>=<span class="string">&quot;swiper&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">swiper</span> <span class="attr">indicator-dots</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span> <span class="attr">autoplay</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span> <span class="attr">interval</span>=<span class="string">&quot;&#123;&#123;3000&#125;&#125;&quot;</span> <span class="attr">circular</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">bindchange</span>=<span class="string">&quot;bannnerChange&quot;</span> <span class="attr">previous-margin</span>=<span class="string">&quot;40rpx&quot;</span> <span class="attr">next-margin</span>=<span class="string">&quot;40rpx&quot;</span> <span class="attr">class</span>=<span class="string">&quot;square-dot&quot;</span> <span class="attr">indicator-dots</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">indicator-active-color</span>=<span class="string">&quot;#fff&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;banner&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.path&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img&quot;</span> <span class="attr">style</span>=<span class="string">&quot;transform:&#123;&#123;currentBanner==index?&#x27;scale(1)&#x27;:&#x27;&#x27;&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span></span><br><span class="line">  &lt;/view&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="title function_">bannnerChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">currentBanner</span>: e.<span class="property">detail</span>.<span class="property">current</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h1 id="小程序用户登录"><a href="#小程序用户登录" class="headerlink" title="小程序用户登录"></a>小程序用户登录</h1><h2 id="判断登录状态"><a href="#判断登录状态" class="headerlink" title="判断登录状态"></a>判断登录状态</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">if</span>(!wx.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>))&#123;</span><br><span class="line">     wx.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">       <span class="attr">title</span>:<span class="string">&quot;登录提示&quot;</span>,</span><br><span class="line">       <span class="attr">content</span>:<span class="string">&quot;暂未登录,是否跳转到登录页面&quot;</span>,</span><br><span class="line">       <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">         <span class="keyword">if</span>(res.<span class="property">confirm</span>)&#123;</span><br><span class="line">           <span class="comment">// 跳转到登录界面</span></span><br><span class="line">           wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">             <span class="attr">url</span>: <span class="string">&#x27;./login/index&#x27;</span>,</span><br><span class="line">           &#125;)</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">    wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        wx.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;token&#x27;</span>, res.<span class="property">code</span>)</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">code</span>) &#123;</span><br><span class="line">          <span class="title function_">doLogin</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>: res.<span class="property">code</span>,</span><br><span class="line">            <span class="attr">appid</span>: <span class="string">&quot;wx9921b2c70aa18d61&quot;</span></span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;登录回调&#x27;</span>, res)</span><br><span class="line">            wx.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;session&#x27;</span>, res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">id</span>)</span><br><span class="line">          </span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// return</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    wx.<span class="title function_">getUserProfile</span>(&#123;</span><br><span class="line">      <span class="attr">lang</span>: <span class="string">&#x27;zh_CN&#x27;</span>,</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&#x27;用于页面展示&#x27;</span>,</span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;用户信息&#x27;</span>, res.<span class="property">userInfo</span>)</span><br><span class="line">        wx.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;head&#x27;</span>, res.<span class="property">userInfo</span>.<span class="property">avatarUrl</span>, )</span><br><span class="line">        wx.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;userName&#x27;</span>, res.<span class="property">userInfo</span>.<span class="property">nickName</span>, )</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(wx.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;userName&#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> (wx.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;userName&#x27;</span>)) &#123;</span><br><span class="line">          wx.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;../../main/index&#x27;</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">   </span><br><span class="line">  <span class="comment">//  wx.login(&#123;</span></span><br><span class="line">  <span class="comment">//     async   success(res) &#123;</span></span><br><span class="line">  <span class="comment">//          console.log(&quot;res.code&quot;,res.code);</span></span><br><span class="line">  <span class="comment">//          const &#123;data: rres&#125; = await doLogin(&#123;</span></span><br><span class="line">  <span class="comment">//             code: res.code,</span></span><br><span class="line">  <span class="comment">//             appid: &quot;wxb8b05a8fedd650f5&quot;,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//          &#125;)</span></span><br><span class="line">  <span class="comment">//          console.log(rres);</span></span><br><span class="line">  <span class="comment">//       &#125;</span></span><br><span class="line">  <span class="comment">//    &#125;)</span></span><br><span class="line">     wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">        <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">          <span class="title function_">doLogin</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>:res.<span class="property">code</span>,</span><br><span class="line">            <span class="attr">appid</span>:<span class="string">&quot;wxb8b05a8fedd650f5&quot;</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">            wx.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;token&#x27;</span>, result.<span class="property">data</span>.<span class="property">data</span>.<span class="property">id</span>);</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h1 id="开启下拉刷新"><a href="#开启下拉刷新" class="headerlink" title="开启下拉刷新"></a>开启下拉刷新</h1><p>在想要开启的页面的json文件里enablePullDownRefresh设置为true</p>
<h2 id="监听下拉刷新事件"><a href="#监听下拉刷新事件" class="headerlink" title="监听下拉刷新事件"></a>监听下拉刷新事件</h2><h4 id="onPullDownRefresh"><a href="#onPullDownRefresh" class="headerlink" title="onPullDownRefresh(){"></a>onPullDownRefresh(){</h4><h4 id="-1"><a href="#-1" class="headerlink" title="}"></a>}</h4><p>与onload平级</p>
<h1 id="下拉刷新提示框"><a href="#下拉刷新提示框" class="headerlink" title="下拉刷新提示框"></a>下拉刷新提示框</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> baseUrl <span class="keyword">from</span> <span class="string">&quot;./baseUrl.js&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>)&#123;</span><br><span class="line">  wx.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&quot;加载中&quot;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve , rejected</span>) =&gt;</span>&#123;</span><br><span class="line">      wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: baseUrl + config.<span class="property">url</span>,</span><br><span class="line">        <span class="attr">method</span>:config.<span class="property">method</span>,</span><br><span class="line">        <span class="attr">header</span>:&#123;</span><br><span class="line">          <span class="string">&quot;content-type&quot;</span>:<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufan-token&quot;</span>:wx.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;bufan-token&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">data</span>:config.<span class="property">data</span>,</span><br><span class="line">        <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line"></span><br><span class="line">          <span class="title function_">resolve</span>(res)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">fail</span>(<span class="params">res</span>)&#123;</span><br><span class="line">          </span><br><span class="line">          <span class="title function_">rejected</span>(res)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 不管发送的请求是成功还是失败  都会执行的回调函数</span></span><br><span class="line">        <span class="title function_">complete</span>(<span class="params"></span>)&#123;</span><br><span class="line">          wx.<span class="title function_">hideLoading</span>()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></table></figure>

<h1 id="小程序uniapp单个页面设置背景颜色"><a href="#小程序uniapp单个页面设置背景颜色" class="headerlink" title="小程序uniapp单个页面设置背景颜色"></a>小程序uniapp单个页面设置背景颜色</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=<span class="string">&quot;scss&quot;</span>&gt;</span><br><span class="line">	page &#123;</span><br><span class="line">		background-<span class="attr">color</span>: #f1ece7;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="滚动到页面顶部"><a href="#滚动到页面顶部" class="headerlink" title="滚动到页面顶部"></a>滚动到页面顶部</h1><p>将页面滚动到目标位置，支持选择器和滚动距离两种方式定位<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/scroll/wx.pageScrollTo.html">wx.pageScrollTo()</a></p>
<h1 id="小程序自定义轮播小点的样式"><a href="#小程序自定义轮播小点的样式" class="headerlink" title="小程序自定义轮播小点的样式"></a>小程序自定义轮播小点的样式</h1><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 页面  &lt;swiper class=&quot;square-dot&quot; indicator-dots indicator-active-color=&quot;#fff&quot;&gt;...&lt;/swiper&gt;</span></span><br><span class="line"></span><br><span class="line">swiper<span class="selector-class">.square-dot</span> <span class="selector-class">.wx-swiper-dot</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.4</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">10</span>rpx;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">10</span>rpx;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">20</span>rpx;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">8</span>rpx <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">swiper<span class="selector-class">.square-dot</span> <span class="selector-class">.wx-swiper-dot</span><span class="selector-class">.wx-swiper-dot-active</span>&#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="去除小程序胶囊按钮"><a href="#去除小程序胶囊按钮" class="headerlink" title="去除小程序胶囊按钮"></a>去除小程序胶囊按钮</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #ifdef MP-WEIXIN</span></span><br><span class="line">				<span class="keyword">var</span> menu = uni.<span class="title function_">getMenuButtonBoundingClientRect</span>();</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(uni.<span class="title function_">getMenuButtonBoundingClientRect</span>())</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">top</span> = menu.<span class="property">top</span> + menu.<span class="property">height</span>;</span><br><span class="line">			<span class="comment">// #endif</span></span><br></pre></td></tr></table></figure>

<h1 id="checkbox双向绑定"><a href="#checkbox双向绑定" class="headerlink" title="checkbox双向绑定"></a>checkbox双向绑定</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">listEvents</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="comment">// 实现全选按钮的选中</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> arr = e.<span class="property">detail</span>.<span class="property">value</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(arr);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 当列表项checkbox状态发生变更的时候  对应的数据也需要随之发生变更</span></span><br><span class="line">    <span class="comment">// 如何知道购物车列表商品是否全部选中</span></span><br><span class="line">    <span class="keyword">var</span> newArr = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">list</span>));</span><br><span class="line">    newArr.<span class="title function_">forEach</span>(<span class="function"><span class="params">ele</span> =&gt;</span>&#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//ele.id 1,2  arr[1,2]</span></span><br><span class="line">      <span class="keyword">if</span>(arr.<span class="title function_">includes</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(ele.<span class="property">id</span>)))&#123;</span><br><span class="line">        ele.<span class="property">isChecked</span> = <span class="literal">true</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        ele.<span class="property">isChecked</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; </span><br><span class="line">      <span class="attr">list</span>:newArr</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(arr.<span class="property">length</span> == <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">list</span>.<span class="property">length</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">isAllChecked</span>:<span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">isAllChecked</span>:<span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">totalEvents</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">allEvents</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> newArr = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">list</span>));</span><br><span class="line">    <span class="comment">// 如何知道列表项现在的状态</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">isAllChecked</span>)&#123;</span><br><span class="line">      newArr.<span class="title function_">forEach</span>(<span class="function"><span class="params">ele</span> =&gt;</span>&#123;</span><br><span class="line">        ele.<span class="property">isChecked</span> = <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">isAllChecked</span>:<span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      newArr.<span class="title function_">forEach</span>(<span class="function"><span class="params">ele</span> =&gt;</span>&#123;</span><br><span class="line">        ele.<span class="property">isChecked</span> = <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">isAllChecked</span>:<span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">list</span>:newArr</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">totalEvents</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">checkboxEvents</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-微信公众号开发" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/21/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91/" class="article-date">
  	<time datetime="2022-08-21T08:41:34.469Z" itemprop="datePublished">2022-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="微信公众号开发"><a href="#微信公众号开发" class="headerlink" title="微信公众号开发"></a>微信公众号开发</h1><p>若需要内网穿透 设置如下</p>
<p>在项目下新建vue.config.js文件</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520162440129.png" alt="image-20210520162440129"></p>
<p>并</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">80</span>,<span class="comment">//设置端口号</span></span><br><span class="line">    <span class="attr">disableHostCheck</span>: <span class="literal">true</span><span class="comment">//webpack的安全验证关了</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://natapp.cn/article/natapp_newbie">https://natapp.cn/article/natapp_newbie</a></p>
<p>下载natapp后再 natapp所在目录开启控制台</p>
<p>输入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">natapp -authtoken=获取的token</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520164625199.png" alt="image-20210520164625199"></p>
<p>接着打开Forwarding后面的网址,即可访问本地的网址,即实现内网穿透</p>
<p>接着打开微信开发平台</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520164858470.png" alt="image-20210520164858470"></p>
<p>选择公众号网页</p>
<p>把地址放到上方</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520164956954.png" alt="image-20210520164956954"></p>
<p>接着在测试号管理界面填写URL和token(一般从后端获取)</p>
<p>向不凡的服务器发送appid和获取来的code后,接着不凡的服务器会想微信的服务器发送请求下面的接口配置信息就是这样的作用</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520165057198.png" alt="image-20210520165057198"> </p>
<p>点提交 后填写域名  注意不要写协议头</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520192913787.png" alt="image-20210520192913787"></p>
<p>接着扫码关注测试号二维码</p>
<p>接着</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520170021199.png" alt="image-20210520170021199"></p>
<p> <img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520192934518.png" alt="image-20210520192934518"></p>
<p>准备阶段完成</p>
<p>因为不凡后台不识别我们的appid和appsecret所以要注册一下</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520170616133.png" alt="image-20210520170616133"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520170642878.png" alt="image-20210520170642878"></p>
<p>地址中appid和appsecret换成自己的回车一下即可</p>
<p>具体参考微信官方文档</p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html">https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html</a></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520194800801.png" alt="image-20210520194800801"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;div @click=<span class="string">&quot;getUserInfo&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>WX<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; userInfo.nickname &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px; heigh: 200px&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;userInfo.headimgurl&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> host = <span class="string">&#x27;http://bufantec.com&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> appid = <span class="string">&#x27;wx06d3f6a0b1cb869d&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> redirect_uri = <span class="string">&#x27;http://4qe9y3.natappfree.cc/wx&#x27;</span> <span class="comment">//授权同意后 会跳转到这个地址</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> url = <span class="string">`https://open.weixin.qq.com/connect/oauth2/authorize?appid=<span class="subst">$&#123;appid&#125;</span>&amp;redirect_uri=<span class="subst">$&#123;redirect_uri&#125;</span>&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=STATE#wechat_redirect`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">code</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">//同意授权后地址栏的query里会携带code,以这个判断是否登录</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">userInfo</span>: &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// console.log(wx)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="property">code</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">code</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">code</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">code</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="title function_">getUserInfo</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = url</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">code</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">getUserInfo</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> axiosUrl = <span class="string">`<span class="subst">$&#123;host&#125;</span>/wx/user/getUserInfo?appid=<span class="subst">$&#123;appid&#125;</span>&amp;code=<span class="subst">$&#123;<span class="variable language_">this</span>.code&#125;</span>`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      axios.<span class="title function_">get</span>(axiosUrl).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res===&#x27;</span>, res)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">userInfo</span> = res.<span class="property">data</span>.<span class="property">data</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="JSDK"><a href="#JSDK" class="headerlink" title="JSDK"></a>JSDK</h1><h1 id="JSSDK使用步骤"><a href="#JSSDK使用步骤" class="headerlink" title="JSSDK使用步骤"></a><strong>JSSDK使用步骤</strong></h1><h4 id="步骤一：绑定域名"><a href="#步骤一：绑定域名" class="headerlink" title="步骤一：绑定域名"></a><strong>步骤一：绑定域名</strong></h4><p>先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS接口安全域名”。</p>
<p>备注：登录后可在“开发者中心”查看对应的接口权限。</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520222358237.png" alt="image-20210520222358237"></p>
<h4 id="步骤二：引入JS文件"><a href="#步骤二：引入JS文件" class="headerlink" title="步骤二：引入JS文件"></a><strong>步骤二：引入JS文件</strong></h4><p>在需要调用JS接口的页面引入如下JS文件，（支持https）：<a target="_blank" rel="noopener" href="http://res.wx.qq.com/open/js/jweixin-1.6.0.js">http://res.wx.qq.com/open/js/jweixin-1.6.0.js</a></p>
<p>如需进一步提升服务稳定性，当上述资源不可访问时，可改访问：<a target="_blank" rel="noopener" href="http://res2.wx.qq.com/open/js/jweixin-1.6.0.js">http://res2.wx.qq.com/open/js/jweixin-1.6.0.js</a> （支持https）。</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520222422175.png" alt="image-20210520222422175"></p>
<p>备注：支持使用 AMD&#x2F;CMD 标准模块加载方法加载</p>
<h4 id="步骤三：通过config接口注入权限验证配置"><a href="#步骤三：通过config接口注入权限验证配置" class="headerlink" title="步骤三：通过config接口注入权限验证配置"></a><strong>步骤三：通过config接口注入权限验证配置</strong></h4><p>所有需要使用JS-SDK的页面必须先注入配置信息，否则将无法调用（同一个url仅需调用一次，对于变化url的SPA的web app可在每次url变化时进行调用,目前Android微信客户端不支持pushState的H5新特性，所以使用pushState来实现web app的页面会导致签名失败，此问题会在Android6.2中修复）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wx.<span class="title function_">config</span>(&#123;</span><br><span class="line">  <span class="attr">debug</span>: <span class="literal">true</span>, <span class="comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span></span><br><span class="line">  <span class="attr">appId</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 必填，公众号的唯一标识</span></span><br><span class="line">  <span class="attr">timestamp</span>: , <span class="comment">// 必填，生成签名的时间戳</span></span><br><span class="line">  <span class="attr">nonceStr</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 必填，生成签名的随机串</span></span><br><span class="line">  <span class="attr">signature</span>: <span class="string">&#x27;&#x27;</span>,<span class="comment">// 必填，签名</span></span><br><span class="line">  <span class="attr">jsApiList</span>: [] <span class="comment">// 必填，需要使用的JS接口列表</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>具体代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    JSDK</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;choiceImg&quot;</span>&gt;</span>选取照片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">:disabled</span>=<span class="string">&quot;flag&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;startRec&quot;</span>&gt;</span>录音开始<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;stopRec&quot;</span>&gt;</span>结束录音<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;scan&quot;</span>&gt;</span>扫描<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">style</span>=<span class="string">&quot;width: 100px; height: 100px; margin: 10px&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">v-for</span>=<span class="string">&quot;item in imgsList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:src</span>=<span class="string">&quot;item&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>录音显示的文本&#123;&#123; recResult &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>扫描显示&#123;&#123; scanResult &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> appid = <span class="string">&#x27;wx06d3f6a0b1cb869d&#x27;</span> <span class="comment">// 自己的appid</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 请求地址</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> host = <span class="string">&#x27;http://bufantec.com&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> referer = <span class="string">&#x27;http://4j6qfr.natappfree.cc/jsdk&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> axiosUrl = <span class="string">`<span class="subst">$&#123;host&#125;</span>/wx/user/getAccessToken?appId=<span class="subst">$&#123;appid&#125;</span>&amp;referer=<span class="subst">$&#123;referer&#125;</span>`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">//选取张图片回显列表</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">imgsList</span>: [],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">//控制录音按钮的线显示</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">flag</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">//语音识别的结果文本,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">recResult</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">scanResult</span>: <span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;wx&#x27;</span>, wx)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="title function_">wxConfig</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//开始录音接口</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">startRec</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">flag</span> = <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      wx.<span class="title function_">startRecord</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//扫描</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">scan</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> _this = <span class="variable language_">this</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      wx.<span class="title function_">scanQRCode</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">needResult</span>: <span class="number">0</span>, <span class="comment">// 默认为0，扫描结果由微信处理，1则直接返回扫描结果，</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">scanType</span>: [<span class="string">&#x27;qrCode&#x27;</span>, <span class="string">&#x27;barCode&#x27;</span>], <span class="comment">// 可以指定扫二维码还是一维码，默认二者都有</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          _this.<span class="property">scanResult</span> = res.<span class="property">resultStr</span> <span class="comment">// 当needResult 为 1 时，扫码返回的结果</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//结束录音</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">stopRec</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> _this = <span class="variable language_">this</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      wx.<span class="title function_">stopRecord</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">var</span> localId = res.<span class="property">localId</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          _this.<span class="property">flag</span> = <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          wx.<span class="title function_">translateVoice</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">localId</span>: localId, <span class="comment">// 需要识别的音频的本地Id，由录音相关接口获得</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">isShowProgressTips</span>: <span class="number">1</span>, <span class="comment">// 默认为1，显示进度提示</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              _this.<span class="property">recResult</span> = res.<span class="property">translateResult</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="comment">// alert(res.translateResult) // 语音识别的结果</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//分享</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">shareFirend</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      wx.<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//需在用户可能点击分享按钮前就先调用</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        wx.<span class="title function_">updateAppMessageShareData</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">title</span>: <span class="string">&#x27;辣鸡&#x27;</span>, <span class="comment">// 分享标题</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">desc</span>: <span class="string">&#x27;这是一段不凡的描述信息&#x27;</span>, <span class="comment">// 分享描述</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">link</span>: referer, <span class="comment">// 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">imgUrl</span>: <span class="string">&#x27;http://doc.bufanui.com/static/images/logo.jpg&#x27;</span>, <span class="comment">// 分享图标</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// 设置成功</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//拍照或者本地选取照片</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">choiceImg</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> _this = <span class="variable language_">this</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      wx.<span class="title function_">chooseImage</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">count</span>: <span class="number">3</span>, <span class="comment">// 默认9</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">sizeType</span>: [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>], <span class="comment">// 可以指定是原图还是压缩图，默认二者都有</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">sourceType</span>: [<span class="string">&#x27;album&#x27;</span>, <span class="string">&#x27;camera&#x27;</span>], <span class="comment">// 可以指定来源是相册还是相机，默认二者都有</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          _this.<span class="property">imgsList</span> = res.<span class="property">localIds</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">wxConfig</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      axios.<span class="title function_">get</span>(axiosUrl).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        wx.<span class="title function_">config</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//给全局注入wx.config方法</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">debug</span>: <span class="literal">true</span>, <span class="comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">appId</span>: appid, <span class="comment">// 必填，公众号的唯一标识</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">timestamp</span>: res.<span class="property">data</span>.<span class="property">timestamp</span>, <span class="comment">// 必填，生成签名的时间戳</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">nonceStr</span>: res.<span class="property">data</span>.<span class="property">noncestr</span>, <span class="comment">// 必填，生成签名的随机串</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">signature</span>: res.<span class="property">data</span>.<span class="property">signature</span>, <span class="comment">// 必填，签名</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">jsApiList</span>: [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&#x27;updateAppMessageShareData&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&#x27;chooseImage&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&#x27;startRecord&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&#x27;stopRecord&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&#x27;translateVoice&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&#x27;scanQRCode&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          ] <span class="comment">// 必填，需要使用的JS接口列表</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="title function_">shareFirend</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="微信支付"><a href="#微信支付" class="headerlink" title="微信支付"></a>微信支付</h1><p>见视频</p>
<h1 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h1><p>package.json</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;vue-cli-service serve&quot;</span>,</span><br><span class="line">    <span class="string">&quot;wx&quot;</span>: <span class="string">&quot;vue-cli-service serve --production&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-cli-service build&quot;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>npm run build</p>
<p>vue.config.js 里修改publicPath的路径 改成相对目录(具体问后端)</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210520223910948.png" alt="image-20210520223910948"></p>
<p> 打包后 如若需要要修改响应的baseUrl 和取消proxy等</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-树形结构遍历" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/21/%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E9%81%8D%E5%8E%86/" class="article-date">
  	<time datetime="2022-08-21T08:41:34.465Z" itemprop="datePublished">2022-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>树形结构遍历</p>
<p>function recursionFindObj(data, id){<br>        var result &#x3D; null;<br>        if(!data){<br>            &#x2F;&#x2F; return; 中断执行<br>            return;<br>        }<br>        for(let i in data){<br>            &#x2F;&#x2F; 已经找到了属性值所在的对象就终止循环,以免后面的循环覆盖result,导致出错<br>            if(result !&#x3D;&#x3D; null){<br>                break;<br>            }<br>            var item &#x3D; data[i];<br>            if(item.id &#x3D;&#x3D; id){<br>                result &#x3D; item;<br>                break;<br>            }else if(item.children){<br>                result &#x3D; recursionFindObj(item.children, id);<br>            }<br>        }<br>        return result;<br>    }</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-潘家成中后台管理模板" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/21/%E6%BD%98%E5%AE%B6%E6%88%90%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E6%A8%A1%E6%9D%BF/" class="article-date">
  	<time datetime="2022-08-21T08:40:53.918Z" itemprop="datePublished">2022-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>配置接口地址</p>
<p>1 在setting.js里</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;乐居后台管理系统2012&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@type</span> &#123;<span class="type">boolean</span>&#125; true | false</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description</span> Whether fix the header</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">fixedHeader</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@type</span> &#123;<span class="type">boolean</span>&#125; true | false</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description</span> Whether show the logo in sidebar</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">sidebarLogo</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// host:&quot;http://leju.bufan.cloud&quot;,</span></span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;http://localhost&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着在vue.config.js里</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="attr">port</span>: port,</span><br><span class="line">  <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">overlay</span>: &#123;</span><br><span class="line">    <span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">errors</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">proxy</span>: &#123;</span><br><span class="line">    <span class="comment">// 配置代理 希望拦截当前的host地址 替换为目标地址</span></span><br><span class="line">    <span class="comment">// key: &#123;&#125;   ;  key为拦截的规则,可以是正则表达式</span></span><br><span class="line">    <span class="string">&#x27;/(lejuAdmin|admin)&#x27;</span>: &#123;</span><br><span class="line">      <span class="attr">target</span>: host, <span class="comment">// 8080可以省略不写 所以代理地址和当前项目不是同一个地址!!</span></span><br><span class="line">      <span class="attr">changeOrigin</span>: <span class="literal">true</span> <span class="comment">// 如果是跨域 需要添加</span></span><br><span class="line">      <span class="comment">// pathRewrite: &#123;</span></span><br><span class="line">      <span class="comment">//   // [&#x27;/xxx&#x27;]: &#x27;/yyy&#x27; // 定位key的地址,转化为value地址</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// before: require(&#x27;./mock/mock-server.js&#x27;)</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="新增页面但是不需要在侧边导航栏显示"><a href="#新增页面但是不需要在侧边导航栏显示" class="headerlink" title="新增页面但是不需要在侧边导航栏显示"></a>新增页面但是不需要在侧边导航栏显示</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;addArticle&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;AddArticle&#x27;</span>,</span><br><span class="line">        <span class="attr">hidden</span>: <span class="literal">true</span>,<span class="comment">//表示侧边导航栏不显示</span></span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/content/article/Detail/index&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;新增文章&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;el-icon-document&#x27;</span>, </span><br><span class="line">         <span class="attr">activeMenu</span>: <span class="string">&#x27;/content/article&#x27;</span><span class="comment">//表示相应的左侧导航栏高亮</span></span><br><span class="line">              &#125;</span><br></pre></td></tr></table></figure>

<p>路由设置注意事项</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当设置 true 的时候该路由不会在侧边栏出现 如401，login等页面，或者如一些编辑页面/edit/1</span></span><br><span class="line"><span class="attr">hidden</span>: <span class="literal">true</span> <span class="comment">// (默认 false)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当设置 noRedirect 的时候该路由在面包屑导航中不可被点击</span></span><br><span class="line"><span class="attr">redirect</span>: <span class="string">&#x27;noRedirect&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当你一个路由下面的 children 声明的路由大于1个时，自动会变成嵌套的模式--如组件页面</span></span><br><span class="line"><span class="comment">// 只有一个时，会将那个子路由当做根路由显示在侧边栏--如引导页面</span></span><br><span class="line"><span class="comment">// 若你想不管路由下面的 children 声明的个数都显示你的根路由</span></span><br><span class="line"><span class="comment">// 你可以设置 alwaysShow: true，这样它就会忽略之前定义的规则，一直显示根路由</span></span><br><span class="line"><span class="attr">alwaysShow</span>: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;router-name&#x27;</span> <span class="comment">// 设定路由的名字，一定要填写不然使用&lt;keep-alive&gt;时会出现各种问题</span></span><br><span class="line"><span class="attr">meta</span>: &#123;</span><br><span class="line">  <span class="attr">roles</span>: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;editor&#x27;</span>] <span class="comment">// 设置该路由进入的权限，支持多个权限叠加</span></span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;title&#x27;</span> <span class="comment">// 设置该路由在侧边栏和面包屑中展示的名字</span></span><br><span class="line">  <span class="attr">icon</span>: <span class="string">&#x27;svg-name&#x27;</span> <span class="comment">// 设置该路由的图标，支持 svg-class，也支持 el-icon-x element-ui 的 icon</span></span><br><span class="line">  <span class="attr">noCache</span>: <span class="literal">true</span> <span class="comment">// 如果设置为true，则不会被 &lt;keep-alive&gt; 缓存(默认 false)</span></span><br><span class="line">  <span class="attr">breadcrumb</span>: <span class="literal">false</span> <span class="comment">//  如果设置为false，则不会在breadcrumb面包屑中显示(默认 true)</span></span><br><span class="line">  <span class="attr">affix</span>: <span class="literal">true</span> <span class="comment">// 如果设置为true，它则会固定在tags-view中(默认 false)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 当路由设置了该属性，则会高亮相对应的侧边栏。</span></span><br><span class="line">  <span class="comment">// 这在某些场景非常有用，比如：一个文章的列表页路由为：/article/list</span></span><br><span class="line">  <span class="comment">// 点击文章进入文章详情页，这时候路由为/article/1，但你想在侧边栏高亮文章列表的路由，就可以进行如下设置</span></span><br><span class="line">  <span class="attr">activeMenu</span>: <span class="string">&#x27;/article/list&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="全局过滤器的使用"><a href="#全局过滤器的使用" class="headerlink" title="全局过滤器的使用"></a>全局过滤器的使用</h1><p>第一步在src目录下创建 filters文件夹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于存放所有的全局 过滤器方法</span></span><br><span class="line"><span class="keyword">import</span> <span class="variable constant_">NP</span> <span class="keyword">from</span> <span class="string">&quot;number-precision&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把以分为单位的number转换为元为单位的字符串并且保留两位小数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">money</span>(<span class="params">v, n</span>) &#123;</span><br><span class="line">  <span class="comment">// v/100 并且保留2位小数  在关于钱的计算上 是否采用四舍五入是需要根据具体场景的</span></span><br><span class="line">  <span class="comment">// 我们这里最小单位是分 所以也不存在问题</span></span><br><span class="line">  <span class="keyword">return</span> (n || <span class="string">&quot;&quot;</span>) + v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initAttrArr</span>(<span class="params">v</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> reg = <span class="regexp">/^\[\&#123;\&quot;/gi</span>;</span><br><span class="line">  <span class="keyword">if</span> (reg.<span class="title function_">test</span>(v)) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(v);</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">      str = str + element.<span class="property">key</span> + <span class="string">&quot;:&quot;</span> + element.<span class="property">value</span> + <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// function money(v, n) &#123;</span></span><br><span class="line"><span class="comment">//     // v/100 并且保留2位小数  在关于钱的计算上 是否采用四舍五入是需要根据具体场景的</span></span><br><span class="line"><span class="comment">//     // 我们这里最小单位是分 所以也不存在问题</span></span><br><span class="line"><span class="comment">//     return (n || &#x27;&#x27;) + NP.round(v / 100, 2)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  money,</span><br><span class="line">  initAttrArr,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第二步</p>
<p>在main.js中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> filters <span class="keyword">from</span> <span class="string">&#x27;./filters&#x27;</span> <span class="comment">// global filters</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> filters) &#123;</span><br><span class="line">  <span class="title class_">Vue</span>.<span class="title function_">filter</span>(key, filters[key])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="全局样式的设置"><a href="#全局样式的设置" class="headerlink" title="全局样式的设置"></a>全局样式的设置</h1><p>src&#x2F;styles&#x2F;index.scss</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#app &#123;</span><br><span class="line">  <span class="attr">height</span>: <span class="number">100</span>%;</span><br><span class="line">  min-<span class="attr">width</span>: 1366px;</span><br><span class="line"><span class="comment">//设置最小宽度后页面上的内容不会随之改变</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>src&#x2F;layout&#x2F;AppMain可设置 主要显示区域的样式</p>
<h1 id="图标"><a href="#图标" class="headerlink" title="图标"></a>图标</h1><p>一</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;i style=<span class="string">&quot;margin-right: 6px&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;el-icon-view&quot;</span>&gt;&lt;/i&gt;</span><br></pre></td></tr></table></figure>

<p>二 要先把图标文件下载到src&#x2F;icons&#x2F;svg文件夹里</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tag</span><br><span class="line">           style=<span class="string">&quot;font-size: 25px&quot;</span></span><br><span class="line">           v-<span class="keyword">else</span>-<span class="keyword">if</span>=<span class="string">&quot;scope.row.payType === 1&quot;</span></span><br><span class="line">           effect=<span class="string">&quot;dark&quot;</span></span><br><span class="line">         &gt;</span><br><span class="line">           <span class="language-xml"><span class="tag">&lt;<span class="name">svg-icon</span> <span class="attr">icon-class</span>=<span class="string">&quot;aliPay&quot;</span> /&gt;</span></span></span><br><span class="line">         &lt;/el-tag&gt;</span><br></pre></td></tr></table></figure>

<p>路由里</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&quot;商品管理&quot;</span>, <span class="attr">icon</span>: <span class="string">&quot;el-icon-s-shop&quot;</span> &#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">path</span>: <span class="string">&quot;permission&quot;</span>,</span><br><span class="line">       <span class="attr">name</span>: <span class="string">&quot;Permission&quot;</span>,</span><br><span class="line">       <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;@/views/power/permission&quot;</span>),</span><br><span class="line">       <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&quot;资源管理&quot;</span>, <span class="attr">icon</span>: <span class="string">&quot;menu&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<h1 id="用户登录-x2F-退出"><a href="#用户登录-x2F-退出" class="headerlink" title="用户登录&#x2F;退出"></a>用户登录&#x2F;退出</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; removeToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/myauth.js&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210516142201037.png" alt="image-20210516142201037"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">toggleSideBar</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;app/toggleSideBar&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// async logout() &#123;</span></span><br><span class="line">    <span class="comment">//   await this.$store.dispatch(&#x27;user/logout&#x27;)</span></span><br><span class="line">    <span class="comment">//   this.$router.push(`/login?redirect=$&#123;this.$route.fullPath&#125;`)</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">removeToken</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="跨域代理"><a href="#跨域代理" class="headerlink" title="跨域代理"></a>跨域代理</h1><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210516145732862.png" alt="image-20210516145732862"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210516145743353.png" alt="image-20210516145743353"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210516145620224.png" alt="image-20210516145620224"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210516145552710.png" alt="image-20210516145552710"></p>
<p>解释:配置代理前</p>
<p>我们网页的地址为:<a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a></p>
<p>想要访问<a target="_blank" rel="noopener" href="http://leju.bufan.cloud/lejuAdmin/orderReturn/findReturnApply/">http://leju.bufan.cloud/lejuAdmin/orderReturn/findReturnApply/</a></p>
<p>这样的网址 就会跨域</p>
<p>配置完后我们自己电脑的网页地址前面就为<a target="_blank" rel="noopener" href="http://leju.bufan.cloud/">http://leju.bufan.cloud/</a></p>
<h2 id="1-一个完整的webpack配置代理代码"><a href="#1-一个完整的webpack配置代理代码" class="headerlink" title="1. 一个完整的webpack配置代理代码"></a>1. 一个完整的webpack配置代理代码</h2><p>设置代理的前提条件：<br>1、需要使用本地开发插件：<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server">webpack-dev-server</a>。<br>2、webpack-dev-server使用的是<a target="_blank" rel="noopener" href="https://github.com/chimurai/http-proxy-middleware">http-proxy-middleware</a>来实现跨域代理的。<br>3、webpack版本： 3.0、4.0亲测有效</p>
<p>一个webpack配置信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  //...</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      &#x27;/api&#x27;: &#123;</span><br><span class="line">        target: &#x27;http://www.baidu.com/&#x27;,</span><br><span class="line">        pathRewrite: &#123;&#x27;^/api&#x27; : &#x27;&#x27;&#125;,</span><br><span class="line">        changeOrigin: true,     // target是域名的话，需要这个参数，</span><br><span class="line">        secure: false,          // 设置支持https协议的代理</span><br><span class="line">      &#125;,</span><br><span class="line">      &#x27;/api2&#x27;: &#123;</span><br><span class="line">          .....</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="2-配置中主要的参数说明"><a href="#2-配置中主要的参数说明" class="headerlink" title="2. 配置中主要的参数说明"></a>2. 配置中主要的参数说明</h2><h3 id="2-1-‘-x2F-api’"><a href="#2-1-‘-x2F-api’" class="headerlink" title="2.1 ‘&#x2F;api’"></a>2.1 ‘&#x2F;api’</h3><p>捕获API的标志，如果API中有这个字符串，那么就开始匹配代理，<br>比如API请求<code>/api/users</code>, 会被代理到请求 <a target="_blank" rel="noopener" href="http://www.baidu.com/api/users">http://www.baidu.com/api/users</a> 。</p>
<h3 id="2-2-target"><a href="#2-2-target" class="headerlink" title="2.2 target"></a>2.2 target</h3><p>代理的API地址，就是需要跨域的API地址。<br>地址可以是域名,如：<code>http://www.baidu.com</code><br>也可以是IP地址：<code>http://127.0.0.1:3000</code><br>如果是域名需要额外添加一个参数<code>changeOrigin: true</code>，否则会代理失败。</p>
<h3 id="2-3-pathRewrite"><a href="#2-3-pathRewrite" class="headerlink" title="2.3 pathRewrite"></a>2.3 pathRewrite</h3><p>路径重写，也就是说会修改最终请求的API路径。<br>比如访问的API路径：<code>/api/users</code>,<br>设置<code>pathRewrite: &#123;&#39;^/api&#39; : &#39;&#39;&#125;,</code>后，<br>最终代理访问的路径：<code>http://www.baidu.com/users</code>，<br>这个参数的目的是给代理命名后，在访问时把命名删除掉。</p>
<h3 id="2-4-changeOrigin"><a href="#2-4-changeOrigin" class="headerlink" title="2.4 changeOrigin"></a>2.4 changeOrigin</h3><p>这个参数可以让target参数是域名。</p>
<h3 id="2-5-secure"><a href="#2-5-secure" class="headerlink" title="2.5 secure"></a>2.5 secure</h3><p><code>secure: false</code>,不检查安全问题。<br>设置后，可以接受运行在 HTTPS 上，可以使用无效证书的后端服务器</p>
<h3 id="2-6-其他参数配置查看http-proxy-middleware文档"><a href="#2-6-其他参数配置查看http-proxy-middleware文档" class="headerlink" title="2.6 其他参数配置查看http-proxy-middleware文档"></a>2.6 其他参数配置查看http-proxy-middleware文档</h3><p>其他的配置参数等信息，可以查看这里：<a target="_blank" rel="noopener" href="https://github.com/chimurai/http-proxy-middleware">https://github.com/chimurai/h...</a></p>
<h2 id="3-参考资料"><a href="#3-参考资料" class="headerlink" title="3. 参考资料"></a>3. 参考资料</h2><p>webpack-dev-server： <a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server">https://github.com/webpack/we...</a><br>http-proxy-middleware： <a target="_blank" rel="noopener" href="https://github.com/chimurai/http-proxy-middleware">https://github.com/chimurai/h...</a><br><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/dev-server/#devserver-proxy">webpack官网 devServer.proxy配置</a></p>
<h1 id="把sku颜色规格转换"><a href="#把sku颜色规格转换" class="headerlink" title="把sku颜色规格转换"></a>把sku颜色规格转换</h1><p>模板的fillters预设有转换函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initAttrArr</span>(<span class="params">v</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> reg = <span class="regexp">/^\[\&#123;\&quot;/gi</span>;</span><br><span class="line">  <span class="keyword">if</span> (reg.<span class="title function_">test</span>(v)) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(v);</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    arr.<span class="title function_">forEach</span>(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">      str = str + element.<span class="property">key</span> + <span class="string">&quot;:&quot;</span> + element.<span class="property">value</span> + <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="导出excle表格"><a href="#导出excle表格" class="headerlink" title="导出excle表格"></a>导出excle表格</h1><h3 id="1-引入插件"><a href="#1-引入插件" class="headerlink" title="1.引入插件"></a>1.引入插件</h3><p>从panjiachen的项目里下载的<strong>vue-element-admin-master</strong>(<a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin">https://github.com/PanJiaChen/vue-element-admin</a>) 的src里的vendor文件复制到我们的项目里并安装依赖包</p>
<p>安装依赖包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install xlsx file-saver -S</span><br><span class="line">npm install script-loader -S -D</span><br></pre></td></tr></table></figure>

<h3 id="2-页面使用"><a href="#2-页面使用" class="headerlink" title="2.页面使用"></a>2.页面使用</h3><p>引入导出按钮</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button</span><br><span class="line">      type=&quot;primary&quot;</span><br><span class="line">      size=&quot;mini&quot;</span><br><span class="line">      :loading=&quot;downloadLoading&quot;</span><br><span class="line">      @click=&quot;handleDownload&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      导出商品列表excel文件</span><br><span class="line">    &lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleDownload</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">downloadLoading</span> = <span class="literal">true</span></span><br><span class="line">    <span class="title function_">import</span>(<span class="string">&#x27;@/vendor/Export2Excel&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">excel</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> tHeader = [<span class="string">&#x27;商品名称&#x27;</span>, <span class="string">&#x27;商品品牌&#x27;</span>, <span class="string">&#x27;商品价格&#x27;</span>]</span><br><span class="line">      <span class="keyword">const</span> filterVal = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;brandName&#x27;</span>, <span class="string">&#x27;price&#x27;</span>]</span><br><span class="line">      <span class="keyword">const</span> data = []</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">goodsList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">out</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> outArr = []</span><br><span class="line">        filterVal.<span class="title function_">forEach</span>(<span class="function">(<span class="params">inner</span>) =&gt;</span> &#123;</span><br><span class="line">          outArr.<span class="title function_">push</span>(out[inner])</span><br><span class="line">        &#125;)</span><br><span class="line">        data.<span class="title function_">push</span>(outArr)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//data====&gt;[[&#x27;家乐铭品鞋柜&#x27;,&#x27;家乐名品 (JLVP)&#x27;,&#x27;4100&#x27;]]</span></span><br><span class="line">      <span class="comment">// console.log(&#x27;list===&#x27;,JSON.stringify()list)</span></span><br><span class="line">      excel.<span class="title function_">export_json_to_excel</span>(&#123;</span><br><span class="line">        <span class="attr">header</span>: tHeader,</span><br><span class="line">        data,</span><br><span class="line">        <span class="attr">filename</span>: <span class="variable language_">this</span>.<span class="property">filename</span>,</span><br><span class="line">        <span class="attr">autoWidth</span>: <span class="variable language_">this</span>.<span class="property">autoWidth</span>,</span><br><span class="line">        <span class="attr">bookType</span>: <span class="variable language_">this</span>.<span class="property">bookType</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">downloadLoading</span> = <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h1 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">申浩:</span><br><span class="line">这个在 src下的 components里</span><br><span class="line"></span><br><span class="line">申浩:</span><br><span class="line">有个index.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">申浩:</span><br><span class="line">在里边注册，然后在main.<span class="property">js</span>里用vue.<span class="property">use</span>调用</span><br><span class="line"></span><br><span class="line">申浩:</span><br><span class="line">就全局注册组件了</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-乐购项目遇到的问题总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/21/%E4%B9%90%E8%B4%AD%E9%A1%B9%E7%9B%AE%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" class="article-date">
  	<time datetime="2022-08-21T08:38:43.237Z" itemprop="datePublished">2022-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="乐购项目遇到的问题总结"><a href="#乐购项目遇到的问题总结" class="headerlink" title="乐购项目遇到的问题总结"></a>乐购项目遇到的问题总结</h1><h2 id="方法一响应路由参数的变化"><a href="#方法一响应路由参数的变化" class="headerlink" title="方法一响应路由参数的变化"></a>方法一响应路由参数的变化</h2><p>提醒一下，当使用路由参数时，例如从 <code>/user/foo</code> 导航到 <code>/user/bar</code>，<strong>原来的组件实例会被复用</strong>。因为两个路由都渲染同个组件，比起销毁再创建，复用则显得更加高效。<strong>不过，这也意味着组件的生命周期钩子不会再被调用</strong>。</p>
<p>复用组件时，想对路由参数的变化作出响应的话，你可以简单地 watch (监测变化) <code>$route</code> 对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = &#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    $route(to, <span class="keyword">from</span>) &#123;</span><br><span class="line">      <span class="comment">// 对路由变化作出响应...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者使用 2.2 中引入的 <code>beforeRouteUpdate</code> <a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html">导航守卫</a>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = &#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">  <span class="title function_">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    <span class="comment">// react to route changes...</span></span><br><span class="line">    <span class="comment">// don&#x27;t forget to call next()</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="E:\MD学习笔记\img\路由跳转1.jpg"></p>
<h2 id="方法二利用导航守卫"><a href="#方法二利用导航守卫" class="headerlink" title="方法二利用导航守卫"></a>方法二利用导航守卫</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Foo</span> = &#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`...`</span>,</span><br><span class="line">  <span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    <span class="comment">// 在渲染该组件的对应路由被 confirm 前调用</span></span><br><span class="line">    <span class="comment">// 不！能！获取组件实例 `this`</span></span><br><span class="line">    <span class="comment">// 因为当守卫执行前，组件实例还没被创建</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    <span class="comment">// 在当前路由改变，但是该组件被复用时调用</span></span><br><span class="line">    <span class="comment">// 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，</span></span><br><span class="line">    <span class="comment">// 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span></span><br><span class="line">    <span class="comment">// 可以访问组件实例 `this`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeRouteLeave</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    <span class="comment">// 导航离开该组件的对应路由时调用</span></span><br><span class="line">    <span class="comment">// 可以访问组件实例 `this`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="E:\MD学习笔记\img\路由守卫.jpg"></p>
<h2 id="第三种"><a href="#第三种" class="headerlink" title="第三种"></a>第三种</h2><p><img src="E:\MD学习笔记\img\路由.jpg"></p>
<p>这样可以检测到每个组件的变化从而组件会渲染</p>
<h2 id="第四种"><a href="#第四种" class="headerlink" title="第四种"></a>第四种</h2><p><img src="E:\MD学习笔记\img\第四种.jpg"></p>
<p>不要用push,而是重新发起数据请求,获得值后再重新进行渲染</p>
<h2 id="第五种"><a href="#第五种" class="headerlink" title="第五种"></a>第五种</h2><p>先push到一个空白页面,然后在这个空白页面的created方法里在携带参数push回来即可</p>
<h1 id="组件缓存"><a href="#组件缓存" class="headerlink" title="组件缓存"></a>组件缓存</h1><p><img src="E:\MD学习笔记\img\服装.jpg"></p>
<h3 id="解决组件缓存带来的问题"><a href="#解决组件缓存带来的问题" class="headerlink" title="解决组件缓存带来的问题"></a>解决组件缓存带来的问题</h3><h4 id="1、prop"><a href="#1、prop" class="headerlink" title="1、prop:"></a>1、prop:</h4><p><strong>include</strong>: 字符串或正则表达式。只有匹配的组件会被缓存。<br><strong>exclude</strong>: 字符串或正则表达式。任何匹配的组件都不会被缓存。<br>　　exclude优先级大于include</p>
<p><img src="E:\MD学习笔记\img\name.jpg"></p>
<p>1先给要缓存的组件加上name</p>
<p>2在App.vue中</p>
<p><img src="E:\MD学习笔记\img\keep.jpg"></p>
<h2 id="2-利用meta"><a href="#2-利用meta" class="headerlink" title="2.利用meta"></a>2.利用meta</h2><p><img src="E:\MD学习笔记\img\meta.jpg"></p>
<p><img src="E:\MD学习笔记\img\213123.jpg"></p>
<h4 id="3、keep-alive生命周期钩子函数：activated、deactivated"><a href="#3、keep-alive生命周期钩子函数：activated、deactivated" class="headerlink" title="3、keep-alive生命周期钩子函数：activated、deactivated"></a>3、keep-alive生命周期钩子函数：activated、deactivated</h4><p>使用&#96;&#96;会将数据保留在内存中，如果要在每次进入页面的时候获取最新的数据，需要在<code>activated</code>阶段获取数据，承担原来<code>created</code>钩子中获取数据的任务。</p>
<p>　　被包含在 &#96;&#96; 中创建的组件，会多出两个生命周期的钩子: activated 与 deactivated</p>
<p>　　<code>activated</code>：在组件被激活时调用，在组件第一次渲染时也会被调用，之后每次keep-alive激活时被调用。</p>
<p>　　<code>deactivated</code>：在组件被停用时调用。</p>
<p>　　注意：只有组件被 <code>keep-alive</code> 包裹时，这两个生命周期才会被调用，如果作为正常组件使用，是不会被调用，以及在 2.1.0 版本之后，使用 <code>exclude</code> 排除之后，就算被包裹在 <code>keep-alive</code> 中，这两个钩子依然不会被调用！另外在服务端渲染时此钩子也不会被调用的。</p>
<p>　　什么时候获取数据？</p>
<p>　　当引入<code>keep-alive</code> 的时候，页面第一次进入，钩子的触发顺序<code>created-&gt; mounted-&gt; activated</code>，退出时触发<code>deactivated</code>。当再次进入（前进或者后退）时，只触发<code>activated</code>。</p>
<p>我们知道 <code>keep-alive</code> 之后页面模板第一次初始化解析变成HTML片段后，再次进入就不在重新解析而是读取内存中的数据，即，只有当数据变化时，才使用VirtualDOM进行diff更新。故，页面进入的数据获取应该在<code>activated</code>中也放一份。数据下载完毕手动操作DOM的部分也应该在<code>activated</code>中执行才会生效。</p>
<p><img src="E:\MD学习笔记\img\active.jpg"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-乐居前台项目总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/21/%E4%B9%90%E5%B1%85%E5%89%8D%E5%8F%B0%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" class="article-date">
  	<time datetime="2022-08-21T08:38:43.233Z" itemprop="datePublished">2022-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="发送请求显示加载框"><a href="#发送请求显示加载框" class="headerlink" title="发送请求显示加载框"></a>发送请求显示加载框</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mport baseUrl <span class="keyword">from</span> <span class="string">&quot;./baseUrl&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>)&#123;</span><br><span class="line">	uni.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line">		<span class="attr">title</span>:<span class="string">&quot;加载中&quot;</span></span><br><span class="line">	&#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,rejected</span>)=&gt;</span>&#123;</span><br><span class="line">        uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:baseUrl+config.<span class="property">url</span>,</span><br><span class="line">            <span class="attr">method</span>:config.<span class="property">method</span>,</span><br><span class="line">            <span class="attr">data</span>:config.<span class="property">data</span>,</span><br><span class="line">			<span class="attr">header</span>:&#123;</span><br><span class="line">				<span class="string">&quot;token&quot;</span>:uni.<span class="title function_">getStorageSync</span>(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">            <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(res)</span><br><span class="line">            &#125;,</span><br><span class="line">           <span class="title function_">fail</span>(<span class="params">err</span>)&#123;</span><br><span class="line">            <span class="title function_">rejected</span>(err)</span><br><span class="line">           &#125;,</span><br><span class="line">		   <span class="title function_">complete</span>(<span class="params"></span>) &#123;</span><br><span class="line">		   	uni.<span class="title function_">hideLoading</span>()</span><br><span class="line">		   &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></table></figure>

<h1 id="本地的商品收藏"><a href="#本地的商品收藏" class="headerlink" title="本地的商品收藏"></a>本地的商品收藏</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">collect</span>(<span class="params">item</span>) &#123;</span><br><span class="line">			<span class="keyword">var</span> ids = uni.<span class="title function_">getStorageSync</span>(<span class="string">&quot;ids&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span> (ids == <span class="literal">undefined</span> || ids == <span class="literal">null</span> || ids == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">				uni.<span class="title function_">setStorageSync</span>(<span class="string">&quot;ids&quot;</span>, [item])</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">papersList</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span>	ele.<span class="property">id</span> == item.<span class="property">id</span></span><br><span class="line">				&#125;).<span class="property">collect</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (ids.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">				ids.<span class="title function_">push</span>(item)</span><br><span class="line">				uni.<span class="title function_">setStorageSync</span>(<span class="string">&quot;ids&quot;</span>, ids)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">papersList</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span>	ele.<span class="property">id</span> == item.<span class="property">id</span></span><br><span class="line">				&#125;).<span class="property">collect</span> = <span class="literal">true</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">var</span> arc = ids.<span class="title function_">find</span>(<span class="function"><span class="params">ele</span> =&gt;</span> ele.<span class="property">id</span> == item.<span class="property">id</span>);</span><br><span class="line">				<span class="keyword">if</span> (arc) &#123;</span><br><span class="line">					<span class="keyword">var</span> index = ids.<span class="title function_">findIndex</span>(<span class="function"><span class="params">ele</span> =&gt;</span> ele.<span class="property">id</span> == item.<span class="property">id</span>)</span><br><span class="line">					ids.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">					uni.<span class="title function_">setStorageSync</span>(<span class="string">&quot;ids&quot;</span>, ids)</span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">papersList</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">					<span class="keyword">return</span>	ele.<span class="property">id</span> == item.<span class="property">id</span></span><br><span class="line">					&#125;).<span class="property">collect</span> = <span class="literal">false</span></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					ids.<span class="title function_">push</span>(item);</span><br><span class="line">					uni.<span class="title function_">setStorageSync</span>(<span class="string">&quot;ids&quot;</span>, ids)</span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">papersList</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">					<span class="keyword">return</span>	ele.<span class="property">id</span> == item.<span class="property">id</span></span><br><span class="line">					&#125;).<span class="property">collect</span> = <span class="literal">true</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="全局css变量"><a href="#全局css变量" class="headerlink" title="全局css变量"></a>全局css变量</h1><p>uni-app 提供内置 CSS 变量</p>
<table>
<thead>
<tr>
<th align="left">CSS变量</th>
<th align="left">描述</th>
<th align="left">App</th>
<th align="left">小程序</th>
<th align="left">H5</th>
</tr>
</thead>
<tbody><tr>
<td align="left">–status-bar-height</td>
<td align="left">系统状态栏高度</td>
<td align="left"><a target="_blank" rel="noopener" href="http://www.html5plus.org/doc/zh_cn/navigator.html#plus.navigator.getStatusbarHeight">系统状态栏高度</a>、nvue注意见下</td>
<td align="left">25px</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">–window-top</td>
<td align="left">内容区域距离顶部的距离</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">NavigationBar 的高度</td>
</tr>
<tr>
<td align="left">–window-bottom</td>
<td align="left">内容区域距离底部的距离</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">TabBar 的高度</td>
</tr>
</tbody></table>
<p><strong>注意：</strong></p>
<ul>
<li><code>var(--status-bar-height)</code> 此变量在微信小程序环境为固定 <code>25px</code>，在 App 里为手机实际状态栏高度。</li>
<li>当设置 <code>&quot;navigationStyle&quot;:&quot;custom&quot;</code> 取消原生导航栏后，由于窗体为沉浸式，占据了状态栏位置。此时可以使用一个高度为 <code>var(--status-bar-height)</code> 的 view 放在页面顶部，避免页面内容出现在状态栏。</li>
<li>由于在H5端，不存在原生导航栏和tabbar，也是前端div模拟。如果设置了一个固定位置的居底view，在小程序和App端是在tabbar上方，但在H5端会与tabbar重叠。此时可使用<code>--window-bottom</code>，不管在哪个端，都是固定在tabbar上方。</li>
<li>目前 nvue 在App端，还不支持 <code>--status-bar-height</code>变量，替代方案是在页面onLoad时通过uni.getSystemInfoSync().statusBarHeight获取状态栏高度，然后通过style绑定方式给占位view设定高度。下方提供了示例代码</li>
</ul>
<p><strong>代码块</strong></p>
<p>快速书写css变量的方法是：在css中敲hei，在候选助手中即可看到3个css变量。（HBuilderX 1.9.6以上支持）</p>
<p>示例1 - 普通页面使用css变量：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- HBuilderX 2.6.3+ 新增 page-meta, 详情：https://uniapp.dcloud.io/component/page-meta --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">page-meta</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigation-bar</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">page-meta</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;status_bar&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 这里是状态栏 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span> 状态栏下的文字 <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.status_bar</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="built_in">var</span>(--status-bar-height);</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toTop&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 这里可以放一个向上箭头，它距离底部tabbar上浮10px--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.toTop</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">bottom</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--window-bottom) + <span class="number">10px</span>)</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="固定值"><a href="#固定值" class="headerlink" title="固定值"></a>固定值</h3><p><code>uni-app</code> 中以下组件的高度是固定的，不可修改：</p>
<table>
<thead>
<tr>
<th align="left">组件</th>
<th align="left">描述</th>
<th align="left">App</th>
<th align="left">H5</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NavigationBar</td>
<td align="left">导航栏</td>
<td align="left">44px</td>
<td align="left">44px</td>
</tr>
<tr>
<td align="left">TabBar</td>
<td align="left">底部选项卡</td>
<td align="left">HBuilderX 2.3.4之前为56px，2.3.4起和H5调为一致，统一为 50px。但可以自主更改高度）</td>
<td align="left">50px</td>
</tr>
</tbody></table>
<p>各小程序平台，包括同小程序平台的iOS和Android的高度也不一样。</p>
<h1 id="globalData"><a href="#globalData" class="headerlink" title="globalData"></a>globalData</h1><p>小程序有globalData，这是一种简单的全局变量机制。这套机制在uni-app里也可以使用，并且全端通用。</p>
<p>以下是 App.vue 中定义globalData的相关配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;  </span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;  </span><br><span class="line">        <span class="attr">globalData</span>: &#123;  </span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;text&#x27;</span>  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>js中操作globalData的方式如下： <code>getApp().globalData.text = &#39;test&#39;</code></p>
<h1 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h1><p>uni-app 内置了 <strong>Vuex</strong> 。<br>使用 Vuex 需要遵守的规则：</p>
<ul>
<li>应用层级的状态应该集中到单个 store 对象中。</li>
<li>提交 mutation 是更改状态的唯一方法，并且这个过程是同步的。</li>
<li>异步逻辑都应该封装到 action 里面。</li>
</ul>
<h2 id="在uni中使用vuex"><a href="#在uni中使用vuex" class="headerlink" title="在uni中使用vuex:"></a>在uni中使用vuex:</h2><ul>
<li>在 uni-app 项目根目录下，新建 store 目录，在此目录下新建 index.js 文件。在 index.js 文件配置如下：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 页面路径：store/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);<span class="comment">//vue的插件机制</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Vuex.Store 构造器选项</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>:&#123;<span class="comment">//存放状态</span></span><br><span class="line">        <span class="string">&quot;username&quot;</span>:<span class="string">&quot;foo&quot;</span></span><br><span class="line">        <span class="string">&quot;age&quot;</span>:<span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<ul>
<li>在 main.js 中导入文件。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：main.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$store</span> = store</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 store 对象提供给 “store” 选项，这可以把 store 的实例注入所有的子组件</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    store,</span><br><span class="line">    ...<span class="title class_">App</span></span><br><span class="line">&#125;)</span><br><span class="line">app.$mount()</span><br></pre></td></tr></table></figure>

<p><strong>获取state</strong></p>
<p>1.通过属性访问，需要在根节点注入 <code>store</code> 。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span>;<span class="comment">//需要引入store</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">username</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> store.<span class="property">state</span>.<span class="property">username</span> </span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.在组件中使用，通过 <code>this.$store</code> 访问到 <code>state</code> 里的数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">username</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">username</span> </span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="mapState"><a href="#mapState" class="headerlink" title="mapState"></a>mapState</h4><p>3.通过 <code>mapState</code> 辅助函数获取。</p>
<p>当一个组件需要获取多个状态的时候，将这些状态都声明为计算属性会有些重复和冗余。<br>为了解决这个问题，我们可以使用 <strong>mapState 辅助函数</strong> 帮助我们生成计算属性，让你少按几次键：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: <span class="title function_">mapState</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 从state中拿到数据 箭头函数可使代码更简练</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">username</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">username</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">age</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;) </span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>当映射的计算属性的名称与 <code>state</code> 的子节点名称相同时，我们也可以给 <code>mapState</code> 传一个字符串数组。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: <span class="title function_">mapState</span>([</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;username&#x27;</span>,<span class="comment">//映射 this.username 为 store.state.username</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;age&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        ])</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>为了能够使用 <code>this</code> 获取组件自己的data数据，必须使用常规函数。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">firstName</span>:<span class="string">&quot;Li&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,    </span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapState</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>: <span class="keyword">function</span> (<span class="params">state</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="string">&#x27; &#x27;</span> +  state.<span class="property">username</span> </span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">age</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">age</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用对象展开运算符</li>
</ul>
<p><code>mapState</code> 函数返回的是一个对象。使用对象展开运算符将多个对象合并为一个，以使我们可以将最终对象传给 <code>computed</code> 属性。极大地简化写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//使用对象展开运算符将此对象混入到外部对象中</span></span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapState</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">username</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">age</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">age</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a>Getter</h3><p>可以认为是 <code>store</code> 的计算属性，对 <code>state</code> 的加工，是派生出来的数据。</p>
<ul>
<li>就像 <code>computed</code> 计算属性一样，<code>getter</code> 返回的值会根据它的依赖被缓存起来，且只有当它的依赖值发生改变才会被重新计算。</li>
<li>可以在多组件中共享 <code>getter</code> 函数，这样做还可以提高运行效率。</li>
</ul>
<p>在 <code>uni-app</code> 项目根目录下，<code>store</code> 目录 <code>index.js</code> 文件下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">todos</span>: [&#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;我是内容一&#x27;</span>,</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;我是内容二&#x27;</span>,</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="attr">doneTodos</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">done</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p>在 <code>store</code> 上注册 <code>getter</code>，<code>getter</code> 方法接受以下参数：</p>
<ul>
<li>state, 如果在模块中定义则为模块的局部状态</li>
<li>getters, 等同于 store.getters</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">todos</span>: [&#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;我是内容一&#x27;</span>,</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;我是内容二&#x27;</span>,</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="attr">doneTodos</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">done</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">doneTodosCount</span>: <span class="function">(<span class="params">state, getters</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//state ：可以访问数据</span></span><br><span class="line">            <span class="comment">//getters：访问其他函数，等同于 store.getters</span></span><br><span class="line">            <span class="keyword">return</span> getters.<span class="property">doneTodos</span>.<span class="property">length</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">getTodoById</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.<span class="property">todos</span>.<span class="title function_">find</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">id</span> === id)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p><strong>获取getters</strong></p>
<p>1.通过属性访问，<code>Getter</code> 会暴露为 <code>store.getters</code> 对象，你可以以属性的形式访问这些值。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in todos&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.id&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.text&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.done&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span><span class="comment">//需要引入store</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">todos</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> store.<span class="property">getters</span>.<span class="property">doneTodos</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意，<code>getter</code> 在通过属性访问时是作为 <code>Vue</code> 的响应式系统的一部分缓存其中的。</p>
<p>2.通过 <code>this.$store</code> 访问。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in todos&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.id&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.text&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.done&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">todos</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>.<span class="property">doneTodos</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.通过方法访问。</p>
<p>你也可以通过让 <code>getter</code> 返回一个函数，来实现给 <code>getter</code> 传参。在你对 <code>store</code> 里的数组进行查询时非常有用。</p>
<p>注意，<code>getter</code> 在通过方法访问时，每次都会去进行调用，而不会缓存结果。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in todos&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">todos</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>.<span class="title function_">getTodoById</span>(<span class="number">2</span>) </span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="mapGetters"><a href="#mapGetters" class="headerlink" title="mapGetters"></a>mapGetters</h4><p>4.通过 <code>mapGetters</code> 辅助函数访问。</p>
<p><code>mapGetters</code> 辅助函数仅仅是将 <code>store</code> 中的 <code>getter</code> 映射到局部计算属性：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;doneTodosCount&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;mapGetters&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span> <span class="comment">//引入mapGetters</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 使用对象展开运算符将 getter 混入 computed 对象中</span></span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapGetters</span>([</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;doneTodos&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;doneTodosCount&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// ...</span></span></span><br><span class="line"><span class="language-javascript">            ])</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你想将一个 <code>getter</code> 属性另取一个名字，使用对象形式：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;doneCount&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;mapGetters&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span> <span class="comment">//引入mapGetters</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapGetters</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 把 `this.doneCount` 映射为 `this.$store.getters.doneTodosCount`</span></span></span><br><span class="line"><span class="language-javascript">              <span class="attr">doneCount</span>: <span class="string">&#x27;doneTodosCount&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Mutation"><a href="#Mutation" class="headerlink" title="Mutation"></a>Mutation</h3><p><strong>Vuex中store数据改变的唯一方法就是mutation</strong></p>
<p>通俗的理解，<code>mutations</code> 里面装着改变数据的方法集合，处理数据逻辑的方法全部放在 <code>mutations</code> 里，使数据和视图分离。</p>
<p>Vuex 中的 <code>mutation</code> 非常类似于事件：每个 <code>mutation</code> 都有一个字符串的 事件类型 (type) 和 一个 回调函数 (handler)。这个回调函数就是我们实际进行状态更改的地方，并且它会接受 <code>state</code> 作为第一个参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state</span>) &#123;</span><br><span class="line">            <span class="comment">// 变更状态</span></span><br><span class="line">            state.<span class="property">count</span> += <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p>你不能直接调用一个 mutation handler。这个选项更像是事件注册：“当触发一个类型为 add 的 <code>mutation</code> 时，调用此函数”，要唤醒一个 mutation handler，你需要以相应的 type 调用 <code>store.commit</code> 方法。</p>
<p><strong>注意</strong>：<code>store.commit</code> 调用 <code>mutation</code>（需要在根节点注入 store）。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span>    </span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addCount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            store.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>传入参数</strong></p>
<p>你可以向 <code>store.commit</code> 传入额外的参数，即 <code>mutation</code> 的 载荷（payload）：</p>
<p>还是以累加器的例子来实现 <code>mutation</code> 函数的传参，来动态定义累加的数量。</p>
<ul>
<li>在 <code>mutation</code> 传参（载荷）可以传递一个参数。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state, n</span>) &#123;</span><br><span class="line">            state.<span class="property">count</span> += n</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">addCount</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                store.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>, <span class="number">5</span>)<span class="comment">//每次累加 5</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>在 <code>mutation</code> 传参（载荷）可以也可以传递一个对象。让我们修改上面累加器的例子：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">            state.<span class="property">count</span> += payload.<span class="property">amount</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            addCount () &#123;<span class="comment">//把载荷和type分开提交</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                store.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>, &#123; <span class="attr">amount</span>: <span class="number">10</span> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><strong>提交方式</strong></p>
<p>1.对象风格的提交方式</p>
<p>我们修改组件中 <code>store.commit</code> 提交方式：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addCount</span>(<span class="params"></span>) &#123;<span class="comment">//整个对象都作为载荷传给 mutation 函数</span></span></span><br><span class="line"><span class="language-javascript">                store.<span class="title function_">commit</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&#x27;add&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">amount</span>: <span class="number">6</span></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当使用对象风格的提交方式，整个对象都作为载荷传给 mutation 函数，因此 handler 保持不变：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">add</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">        state.<span class="property">count</span> += payload.<span class="property">amount</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="mapMutations"><a href="#mapMutations" class="headerlink" title="mapMutations"></a>mapMutations</h4><p>2.通过 <code>mapMutations</code> 辅助函数提交。</p>
<p>创建组件方法提交 <code>mutation</code>。</p>
<p>使用 <code>mapMutations</code> 辅助函数将组件中的 <code>methods</code> 映射为 <code>store.commit</code> 调用（需要在根节点注入 <code>store</code>）。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapMutations</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapMutations</span>([<span class="string">&#x27;add&#x27;</span>])<span class="comment">//对象展开运算符直接拿到add</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 页面路径：store/index.js --&gt;</span></span><br><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import Vuex from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"></span><br><span class="line">const store = new Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        add(state) &#123;</span><br><span class="line">            // 变更状态</span><br><span class="line">            state.count += 2</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">export default store</span><br></pre></td></tr></table></figure>

<p><strong>遵守规则</strong></p>
<p>既然 <code>Vuex</code> 的 <code>store</code> 中的状态是响应式的，那么当我们变更状态时，监视状态的 <code>Vue</code> 组件也会自动更新。这也意味着 <code>Vuex</code> 中的 <code>mutation</code> 也需要与使用 <code>Vue</code> 一样遵守一些注意事项：</p>
<ul>
<li>最好提前在你的 <code>store</code> 中初始化好所有所需属性。</li>
<li>当需要在对象上添加新属性时，你应该<ul>
<li>使用 <code>Vue.set(obj, &#39;newProp&#39;, 123)</code>, 或者</li>
<li>以新对象替换老对象。例如，利用对象展开运算符我们可以这样写：</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">state.<span class="property">obj</span> = &#123; ...state.<span class="property">obj</span>, <span class="attr">newProp</span>: <span class="number">123</span> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>Mutation 必须是同步函数</strong></p>
<p>一条重要的原则就是要记住** mutation 必须是同步函数**</p>
<p>我们要通过提交 <code>mutation</code> 的方式来改变状态数据，是因为我们想要更明确地追踪到状态的变化。如果是类似下面这样异步的话：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    someMutation (state) &#123;</span><br><span class="line">        api.<span class="title function_">callAsyncMethod</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">count</span>++</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们就不知道什么时候状态会发生改变，所以也就无法追踪了，这与 <code>mutation</code> 的设计初心相悖，所以强制规定它必须是同步函数。</p>
<h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><p><code>action</code> 类似于 <code>mutation</code> ，不同在于：</p>
<ul>
<li>action 提交的是 <code>mutation</code>，通过 <code>mutation</code> 来改变 <code>state</code> ，而不是直接变更状态。</li>
<li>action 可以包含任意异步操作。</li>
</ul>
<p>让我们来注册一个简单的 <code>action</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>:&#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state</span>) &#123;</span><br><span class="line">            <span class="comment">// 变更状态</span></span><br><span class="line">            state.<span class="property">count</span> += <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>:&#123;</span><br><span class="line">        addCountAction (context) &#123;</span><br><span class="line">            context.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p><code>action</code> 函数接受一个与 <code>store</code> 实例具有相同方法和属性的 <code>context</code> 对象，因此你可以调用 <code>context.commit</code> 提交一个 <code>mutation</code>，或者通过 <code>context.state</code> 和 <code>context.getters</code> 来获取 <code>state</code> 和 <code>getters</code>。</p>
<p>实践中，我们会经常用到 ES2015 的参数解构来简化代码（特别是我们需要调用 <code>commit</code> 很多次的时候）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">//参数解构</span></span><br><span class="line">    addCountAction (&#123;commit&#125;) &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>分发 Action</strong></p>
<p>1.<code>actions</code> 通过 <code>store.dispatch</code> 方法触发。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            add () &#123;</span></span><br><span class="line"><span class="language-javascript">                store.<span class="title function_">dispatch</span>(<span class="string">&#x27;addCountAction&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>actions</code> 支持以载荷形式分发:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>:&#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">            state.<span class="property">count</span> += payload.<span class="property">amount</span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>:&#123;</span><br><span class="line">        addCountAction (context , payload) &#123;</span><br><span class="line">            context.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>,payload)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            add () &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">// 以载荷形式分发</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                store.<span class="title function_">dispatch</span>(<span class="string">&#x27;addCountAction&#x27;</span>, &#123;<span class="attr">amount</span>: <span class="number">10</span>&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>actions</code> 支持以对象形式分发:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    add () &#123;</span><br><span class="line">        <span class="comment">// 以对象形式分发</span></span><br><span class="line">        store.<span class="title function_">dispatch</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;addCountAction&#x27;</span>,</span><br><span class="line">            <span class="attr">amount</span>: <span class="number">5</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>action</code> 可以执行任意的同步和异步操作</p>
<p>我们可以在 <code>action</code> 内部执行异步操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>:&#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state</span>) &#123;</span><br><span class="line">            <span class="comment">// 变更状态</span></span><br><span class="line">            state.<span class="property">count</span> += <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>:&#123;</span><br><span class="line">        addCountAction (context) &#123;</span><br><span class="line">            <span class="comment">//在执行累加的时候，会等待两秒才执行</span></span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                context.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">            &#125;, <span class="number">2000</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p>来看一个更加实际的购物车示例，涉及到<strong>调用异步 API</strong> 和<strong>分发多重 mutation</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    checkout (&#123; commit, state &#125;, products) &#123;</span><br><span class="line">        <span class="comment">// 把当前购物车的物品备份起来</span></span><br><span class="line">        <span class="keyword">const</span> savedCartItems = [...state.<span class="property">cart</span>.<span class="property">added</span>]</span><br><span class="line">        <span class="comment">// 发出结账请求，然后乐观地清空购物车</span></span><br><span class="line">        <span class="title function_">commit</span>(types.<span class="property">CHECKOUT_REQUEST</span>)</span><br><span class="line">        <span class="comment">// 购物 API 接受一个成功回调和一个失败回调</span></span><br><span class="line">        shop.<span class="title function_">buyProducts</span>(</span><br><span class="line">            products,</span><br><span class="line">            <span class="comment">// 成功操作</span></span><br><span class="line">            <span class="function">() =&gt;</span> <span class="title function_">commit</span>(types.<span class="property">CHECKOUT_SUCCESS</span>),</span><br><span class="line">            <span class="comment">// 失败操作</span></span><br><span class="line">            <span class="function">() =&gt;</span> <span class="title function_">commit</span>(types.<span class="property">CHECKOUT_FAILURE</span>, savedCartItems)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意我们正在进行一系列的异步操作，并且通过提交 <code>mutation</code> 来记录 <code>action</code> 产生的状态变更。</p>
<h4 id="mapActions"><a href="#mapActions" class="headerlink" title="mapActions"></a>mapActions</h4><p>2.通过 <code>mapActions</code> 辅助函数分发。</p>
<p>创建组件方法分发 <code>action</code>。</p>
<ul>
<li>你在组件中使用 <code>this.$store.dispatch(&#39;xxx&#39;)</code> 分发 <code>action</code></li>
<li>或者使用 <code>mapActions</code> 辅助函数将组件的 <code>methods</code> 映射为 <code>store.dispatch</code> 调用（需要先在根节点注入 <code>store</code> ）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCountAction&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapActions &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapActions</span>([</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;addCountAction&#x27;</span>, </span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 将 `this.addCountAction()` 映射为 `this.$store.dispatch(&#x27;addCountAction&#x27;)`</span></span></span><br><span class="line"><span class="language-javascript">            ])</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>mapActions</code> 也支持传入参数（载荷）：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    ...<span class="title function_">mapActions</span>([</span><br><span class="line">        <span class="string">&#x27;addCountAction&#x27;</span> </span><br><span class="line">        <span class="comment">// 将 `this.addCountAction(amount)` 映射为 </span></span><br><span class="line">        <span class="comment">//`this.$store.dispatch(&#x27;addCountAction&#x27;, amount)`</span></span><br><span class="line">    ]),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>mapActions</code> 也支持传递一个对象：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    ...<span class="title function_">mapActions</span>(&#123;</span><br><span class="line">        <span class="attr">addCount</span>: <span class="string">&#x27;addCountAction&#x27;</span>,</span><br><span class="line">        <span class="comment">// 将 `this.addCount()` 映射为 `this.$store.dispatch(&#x27;addCountAction&#x27;)`</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>组合 Action</strong></p>
<p><code>action</code> 通常是异步的，那么如何知道 <code>action</code> 什么时候结束呢？更重要的是，我们如何才能组合多个 <code>action</code>，以处理更加复杂的异步流程？</p>
<p>首先，你需要明白 <code>store.dispatch</code> 可以处理被触发的 <code>action</code> 的处理函数返回的 <code>Promise</code>，并且 <code>store.dispatch</code> 仍旧返回 <code>Promise</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    actionA (&#123; commit &#125;) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">commit</span>(<span class="string">&#x27;someMutation&#x27;</span>)</span><br><span class="line">                <span class="title function_">resolve</span>()</span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在你可以在组件中使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="title function_">dispatch</span>(<span class="string">&#x27;actionA&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在另外一个 <code>action</code> 中也可以：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    actionB (&#123; dispatch, commit &#125;) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">dispatch</span>(<span class="string">&#x27;actionA&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&#x27;someOtherMutation&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，如果我们利用 <code>async / await</code>，我们可以如下组合 <code>action</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设 getData() 和 getOtherData() 返回的是 Promise</span></span><br><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> actionA (&#123; commit &#125;) &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;gotData&#x27;</span>, <span class="keyword">await</span> <span class="title function_">getData</span>())</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> actionB (&#123; dispatch, commit &#125;) &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">dispatch</span>(<span class="string">&#x27;actionA&#x27;</span>) <span class="comment">// 等待 actionA 完成</span></span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;gotOtherData&#x27;</span>, <span class="keyword">await</span> <span class="title function_">getOtherData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一个 <code>store.dispatch</code> 在不同模块中可以触发多个 <code>action</code> 函数。在这种情况下，只有当所有触发函数完成后，返回的 <code>Promise</code> 才会执行。</p>
</blockquote>
<h3 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h3><p>由于使用单一状态树，应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，<code>store</code> 对象就有可能变得相当臃肿。</p>
<p>为了解决以上问题，<code>Vuex</code> 允许我们将 <code>store</code> 分割成模块（module）。每个模块拥有自己的 <code>state</code>、<code>mutation</code>、<code>action</code>、<code>getter</code>、甚至是嵌套子模块——从上至下进行同样方式的分割：</p>
<p>1.在 <code>store</code> 文件夹下新建 <code>modules</code> 文件夹，并在下面新建 <code>moduleA.js</code> 和 <code>moduleB.js</code> 文件用来存放 <code>vuex</code> 的 <code>modules</code> 模块。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">├── components             # 组件文件夹</span><br><span class="line">    └── myButton </span><br><span class="line">        └── myButton.vue   # myButton组件</span><br><span class="line">├── pages</span><br><span class="line">    └── index </span><br><span class="line">        └── index.vue      # index页面</span><br><span class="line">├── static</span><br><span class="line">├── store</span><br><span class="line">    ├── index.js          # 我们组装模块并导出 store 的地方</span><br><span class="line">    └── modules           # 模块文件夹</span><br><span class="line">        ├── moduleA.js    # 模块moduleA</span><br><span class="line">        └── moduleB.js    # 模块moduleB</span><br><span class="line">├── App.vue</span><br><span class="line">├── main.js</span><br><span class="line">├── manifest.json</span><br><span class="line">├── pages.json</span><br><span class="line">└── uni.scss</span><br></pre></td></tr></table></figure>

<p>2.在 <code>main.js</code> 文件中引入 <code>store</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：main.<span class="property">js</span> --&gt;</span><br><span class="line">    <span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$store</span> = store</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把 store 对象提供给 “store” 选项，这可以把 store 的实例注入所有的子组件</span></span><br><span class="line">    <span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">        store,</span><br><span class="line">        ...<span class="title class_">App</span></span><br><span class="line">    &#125;)</span><br><span class="line">    app.$mount()</span><br></pre></td></tr></table></figure>

<p>3.在项目根目录下，新建 <code>store</code> 文件夹，并在下面新建 <code>index.js</code> 文件，作为模块入口，引入各子模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line">    <span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> moduleA <span class="keyword">from</span> <span class="string">&#x27;@/store/modules/moduleA&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> moduleB <span class="keyword">from</span> <span class="string">&#x27;@/store/modules/moduleB&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">        <span class="attr">modules</span>:&#123;</span><br><span class="line">            moduleA,moduleB</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>4.子模块 <code>moduleA</code> 页面内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 子模块moduleA路径：store/modules/moduleA.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>:<span class="string">&quot;我是moduleA模块下state.text的值&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123; </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.子模块 <code>moduleB</code> 页面内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 子模块moduleB路径：store/modules/moduleB.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="number">1608820295</span><span class="comment">//初始时间戳</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="title function_">timeString</span>(<span class="params">state</span>) &#123;<span class="comment">//时间戳转换后的时间</span></span><br><span class="line">            <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(state.<span class="property">timestamp</span>);</span><br><span class="line">            <span class="keyword">var</span> year = date.<span class="title function_">getFullYear</span>();</span><br><span class="line">            <span class="keyword">var</span> mon  = date.<span class="title function_">getMonth</span>()+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">var</span> day  = date.<span class="title function_">getDate</span>();</span><br><span class="line">            <span class="keyword">var</span> hours = date.<span class="title function_">getHours</span>();</span><br><span class="line">            <span class="keyword">var</span> minu = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">            <span class="keyword">var</span> sec = date.<span class="title function_">getSeconds</span>();</span><br><span class="line">            <span class="keyword">var</span> trMon = mon&lt;<span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span>+mon : mon</span><br><span class="line">            <span class="keyword">var</span> trDay = day&lt;<span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span>+day : day</span><br><span class="line">            <span class="keyword">return</span> year+<span class="string">&#x27;-&#x27;</span>+trMon+<span class="string">&#x27;-&#x27;</span>+trDay+<span class="string">&quot; &quot;</span>+hours+<span class="string">&quot;:&quot;</span>+minu+<span class="string">&quot;:&quot;</span>+sec;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="title function_">updateTime</span>(<span class="params">state</span>)&#123;<span class="comment">//更新当前时间戳</span></span><br><span class="line">            state.<span class="property">timestamp</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.在页面中引用组件 myButton ，并通过 <code>mapState</code> 读取 <code>state</code> 中的初始数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;text&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>时间戳：&#123;&#123;timestamp&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>当前时间:&#123;&#123;timeString&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">myButton</span>&gt;</span><span class="tag">&lt;/<span class="name">myButton</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;mapState,mapGetters&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span> </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapState</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">text</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">moduleA</span>.<span class="property">text</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">timestamp</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">moduleB</span>.<span class="property">timestamp</span></span></span><br><span class="line"><span class="language-javascript">            &#125;),</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapGetters</span>([</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;timeString&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            ])</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>7.在组件 <code>myButton</code>中，通过 <code>mutations</code> 操作刷新当前时间。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 组件路径：components/myButton/myButton.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;updateTime&quot;</span>&gt;</span>刷新当前时间<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;mapMutations&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapMutations</span>([<span class="string">&#x27;updateTime&#x27;</span>])</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>vue是单向数据流，子组件不能直接修改父组件的数据，而通过vuex状态管理实现：把组件的共享状态抽取出来，以一个全局单例模式管理。在这种模式下，我们的组件树构成了一个巨大的“视图”，不管在树的哪个位置，任何组件都能获取状态或者触发行为！</p>
<h1 id="API条件编译"><a href="#API条件编译" class="headerlink" title="API条件编译"></a>API条件编译</h1><p>当我们在使用某些api的时候，有些api是只在某一平台才能存在，如<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/ui/menuButton?id=getmenubuttonboundingclientrect">getMenuButtonBoundingClientRect()</a><br><img src="http://doc.bufanui.com/uploads/a411524237/images/m_f2ab02ca36dafc5a15a66c5e2b890bda_r.png" alt="null"><br>那么我们在使用的时候就不能直接使用，该api的使用在h5平台及app平台会直接报错。</p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>在小程序平台获取胶囊按钮的宽度及高度。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意 下面的// 也包含在内</span></span><br><span class="line"><span class="comment">// #ifdef MP-WEIXIN</span></span><br><span class="line"><span class="keyword">var</span> val = uni.<span class="title function_">getMenuButtonBoundingClientRect</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(val.<span class="property">width</span>,val.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// #endif</span></span><br></pre></td></tr></table></figure>

<h1 id="组件的条件编译"><a href="#组件的条件编译" class="headerlink" title="组件的条件编译"></a>组件的条件编译</h1><h3 id="需求-1"><a href="#需求-1" class="headerlink" title="需求:"></a>需求:</h3><p>进入到<strong>h5页面</strong> 页面展示内容为 <strong>你好，h5</strong><br>进入到<strong>小程序页面</strong>，页面展示内容为 <strong>你好 小程序</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- #ifdef <span class="variable constant_">H5</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    你好，h5</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;!-- #endif --&gt;</span><br><span class="line">&lt;!-- #ifdef <span class="variable constant_">MP</span>-<span class="variable constant_">WEIXIN</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    仅在小程序平台展示</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;!-- #endif --&gt;</span><br></pre></td></tr></table></figure>

<h1 id="样式的条件编译"><a href="#样式的条件编译" class="headerlink" title="样式的条件编译"></a>样式的条件编译</h1><h3 id="需求-2"><a href="#需求-2" class="headerlink" title="需求:"></a>需求:</h3><p>在<strong>h5端</strong>文字颜色为<strong>红色</strong><br>在<strong>小程序端</strong>文字颜色为<strong>蓝色</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;view <span class="keyword">class</span>=<span class="string">&quot;app&quot;</span>&gt; </span><br><span class="line">    在h5端颜色为红色</span><br><span class="line">    在小程序端样式为绿色</span><br><span class="line">&lt;/view&gt;</span><br><span class="line"></span><br><span class="line">.<span class="property">app</span>&#123;</span><br><span class="line">    <span class="comment">/* #ifdef H5 */</span></span><br><span class="line">    <span class="attr">color</span>: red;</span><br><span class="line">    <span class="comment">/* #endif */</span></span><br><span class="line">    <span class="comment">/* #ifdef MP-WEIXIN */</span></span><br><span class="line">    <span class="attr">color</span>: green;</span><br><span class="line">    <span class="comment">/* #endif */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="pages-json-的条件编译"><a href="#pages-json-的条件编译" class="headerlink" title="pages.json 的条件编译"></a>pages.json 的条件编译</h1><p>下面的页面，只有运行至 App 时才会编译进去。<br><img src="http://doc.bufanui.com/uploads/a411524237/images/m_af922828621c3355f2c501a0def0cd64_r.png" alt="null"><br>不同平台下的特有功能，以及小程序平台的分包，都可以通过 pages.json 的条件编译来更好地实现。这样，就不会在其它平台产生多余的资源，进而减小包体积。</p>
<h1 id="编译到-H5-平台时的特定样式"><a href="#编译到-H5-平台时的特定样式" class="headerlink" title="编译到 H5 平台时的特定样式"></a>编译到 H5 平台时的特定样式</h1><h3 id="编译到H5平台的特定处理编译到H5平台的特定处理"><a href="#编译到H5平台的特定处理编译到H5平台的特定处理" class="headerlink" title="编译到H5平台的特定处理编译到H5平台的特定处理"></a>编译到H5平台的特定处理编译到H5平台的特定处理</h3><p>找到项目当中的page.json文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">            <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;uni-app&quot;</span>,</span><br><span class="line">                <span class="comment">// 编译到h5平台时去掉页面标题</span></span><br><span class="line">                <span class="string">&quot;h5&quot;</span>:&#123;</span><br><span class="line">                    <span class="string">&quot;titleNView&quot;</span>:<span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>保存即可发现在H5平台标题已经消失，该配置仅仅只针对h5端生效。</p>
<h1 id="自定义导航栏"><a href="#自定义导航栏" class="headerlink" title="自定义导航栏"></a>自定义导航栏</h1><h3 id="导航栏"><a href="#导航栏" class="headerlink" title="导航栏"></a>导航栏</h3><p><img src="http://doc.bufanui.com/uploads/a411524237/images/m_be2d71ad36461ea805635005b3b7eaa6_r.png" alt="null"><br>图中红框部分就是导航栏 默认不能被修改<br>如需修改的话 需要找到对应的路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">            <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;uni-app&quot;</span>,</span><br><span class="line">                <span class="comment">// 自定义导航栏</span></span><br><span class="line">                <span class="string">&quot;navigationStyle&quot;</span>:<span class="string">&quot;custom&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>加上去之后 可以发现 现在可以在手机端可以全屏编辑<br><img src="http://doc.bufanui.com/uploads/a411524237/images/m_72c54be14a0fe7771620dedb730fe4c8_r.png" alt="null"></p>
<h3 id="自定义导航栏使用注意"><a href="#自定义导航栏使用注意" class="headerlink" title="自定义导航栏使用注意"></a>自定义导航栏使用注意</h3><p>当navigationStyle设为custom或titleNView设为false时，原生导航栏不显示，此时要注意几个问题：</p>
<ul>
<li><p>非H5端，手机顶部状态栏区域会被页面内容覆盖。这是因为窗体是沉浸式的原因，即全屏可写内容。uni-app提供了状态栏高度的css变量</p>
<p>–status-bar-height</p>
<p>，如果需要把状态栏的位置从前景部分让出来，可写一个占位div，高度设为css变量。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;status_bar&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 这里是状态栏 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span>&gt;</span> 状态栏下的文字 <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.status_bar</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="built_in">var</span>(--status-bar-height);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果原生导航栏不能满足需求，推荐使用uni ui的<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?id=52">自定义导航栏NavBar</a>。这个前端导航栏自动处理了状态栏高度占位问题。</p>
</li>
<li><p>前端导航栏搭配原生下拉刷新时，会有问题，包括</p>
<ul>
<li>微信小程序下iOS需要拉更长才能看到下拉刷新的三个点，而Android是从屏幕顶部下拉，无法从导航栏下方下拉。如果一定要从前端导航栏下拉，小程序下只能放弃原生下拉刷新，纯前端模拟，参考<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?id=343">mescroll插件</a>，但这样很容易产生性能问题。目前小程序平台自身没有提供更好的方案</li>
<li>App和H5下，原生下拉刷新提供了<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-pullToRefresh">circle样式</a>，可以指定offset偏移量（pages.json的app-plus下配置），自定义下拉圈出现的位置。在hello uni-app的扩展组件中有示例。</li>
</ul>
</li>
<li><p>非H5端，前端导航盖不住原生组件。如果页面有video、map、textarea(仅小程序)等</p>
<p>原生组件</p>
<p>，滚动时会覆盖住导航栏</p>
<ul>
<li>如果是小程序下，可以使用cover-view来做导航栏，避免覆盖问题</li>
<li>如果是App下，建议使用<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-titleNView">titleNView</a>或<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-subNVues">subNVue</a>，体验更好</li>
</ul>
</li>
<li><p>前端组件在渲染速度上不如原生导航栏，原生导航可以在动画期间渲染，保证动画期间不白屏，但使用前端导航栏，在新窗体进入的动画期间可能会整页白屏，越低端的手机越明显。</p>
</li>
<li><p>以上讨论的是前端自定义导航栏，但在App侧，原生导航栏也提供了比小程序导航更丰富的自定义性</p>
<ul>
<li>titleNView：给原生导航栏提供更多配置，包括自定义按钮、滚动渐变效果、搜索框等，详见<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-titleNView">titleNView</a></li>
<li>subNView：使用nvue原生渲染，所有布局自己开发，具备一切自定义灵活度。详见<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-subNVues">subNVue</a></li>
</ul>
</li>
<li><p>页面禁用原生导航栏后，想要改变状态栏的前景字体样式，仍可设置页面的 navigationBarTextStyle 属性（只能设置为 black或white）。如果想单独设置状态栏颜色，App端可使用<a target="_blank" rel="noopener" href="http://www.html5plus.org/doc/zh_cn/navigator.html#plus.navigator.setStatusBarStyle">plus.navigator.setStatusBarStyle</a>设置。注意部分低端Android手机（4.4）自身不支持设置状态栏前景色。</p>
</li>
</ul>
<p>鉴于以上问题，在原生导航能解决业务需求的情况下，尽量使用原生导航。甚至有时需要牺牲一些不是很重要的需求。在App和H5下，uni-app提供了灵活的处理方案：<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-titleNView">titleNView</a>、<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-subNVues">subNVue</a>、或整页使用nvue。但在小程序下，因为其自身的限制，没有太好的方案。有必要的话，也可以用条件编译分端处理。</p>
<h1 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h1><h3 id="onPullDownRefresh"><a href="#onPullDownRefresh" class="headerlink" title="onPullDownRefresh"></a>onPullDownRefresh</h3><p>在 js 中定义 onPullDownRefresh 处理函数（和onLoad等生命周期函数同级），监听该页面用户下拉刷新事件。</p>
<ul>
<li>需要在 <code>pages.json</code> 里，找到的当前页面的pages节点，并在 <code>style</code> 选项中开启 <code>enablePullDownRefresh</code>。</li>
<li>当处理完数据刷新后，<code>uni.stopPullDownRefresh</code> 可以停止当前页面的下拉刷新。</li>
</ul>
<h3 id="uni-startPullDownRefresh-OBJECT"><a href="#uni-startPullDownRefresh-OBJECT" class="headerlink" title="uni.startPullDownRefresh(OBJECT)"></a>uni.startPullDownRefresh(OBJECT)</h3><p>开始下拉刷新，调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。</p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>success 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">errMsg</td>
<td align="left">String</td>
<td align="left">接口调用结果</td>
</tr>
</tbody></table>
<h3 id="uni-stopPullDownRefresh"><a href="#uni-stopPullDownRefresh" class="headerlink" title="uni.stopPullDownRefresh()"></a>uni.stopPullDownRefresh()</h3><p>停止当前页面下拉刷新。</p>
<p><strong>示例</strong></p>
<p>pages.json</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;pages&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">            <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;uni-app&quot;</span>,</span><br><span class="line">                <span class="string">&quot;enablePullDownRefresh&quot;</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;globalStyle&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;navigationBarTextStyle&quot;</span>: <span class="string">&quot;white&quot;</span>,</span><br><span class="line">        <span class="string">&quot;navigationBarBackgroundColor&quot;</span>: <span class="string">&quot;#0faeff&quot;</span>,</span><br><span class="line">        <span class="string">&quot;backgroundColor&quot;</span>: <span class="string">&quot;#fbf9fe&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 仅做示例，实际开发中延时根据需求来使用。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;uni-app&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start pulldown&#x27;</span>);</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">        uni.<span class="title function_">startPullDownRefresh</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onPullDownRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;refresh&#x27;</span>);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            uni.<span class="title function_">stopPullDownRefresh</span>();</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<ul>
<li>支付宝小程序<code>startPullDownRefresh</code>在开发者工具里会提示<code>暂未开放，请勿使用</code></li>
<li>支付宝小程序<code>startPullDownRefresh</code>请使用真机调试（非真机预览）</li>
<li>后续支付宝小程序开发工具更新可能会有所修改</li>
</ul>
<h1 id="上拉加载"><a href="#上拉加载" class="headerlink" title="上拉加载"></a>上拉加载</h1><h3 id="onReachBottom"><a href="#onReachBottom" class="headerlink" title="onReachBottom"></a>onReachBottom</h3><p>页面滚动到底部的事件（不是scroll-view滚到底），常用于下拉下一页数据。</p>
<p>onReachBottom使用注意 可在pages.json里定义具体页面底部的触发距离onReachBottomDistance，比如设为50，那么滚动页面到距离底部50px时，就会触发onReachBottom事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">            <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;uni-app&quot;</span>,</span><br><span class="line">                <span class="comment">// 页面上拉触底事件触发时距页面底部距离，单位只支持px</span></span><br><span class="line">                <span class="string">&quot;onReachBottomDistance&quot;</span>:<span class="number">100</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;find&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;per&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;item in num&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;&#123; item &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">num</span>:<span class="number">20</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">onReachBottom</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;页面滚动到底部&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="property">num</span>+=<span class="number">10</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,<span class="number">2000</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.find</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.per</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">height</span>: <span class="number">40px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">background</span>: <span class="number">#ccc</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">margin</span>: <span class="number">10px</span> auto;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//项目里的代码</span></span><br><span class="line">	<span class="attr">methods</span>: &#123;</span><br><span class="line">		<span class="keyword">async</span> <span class="title function_">getListData</span>(<span class="params"></span>)&#123;</span><br><span class="line">				<span class="keyword">const</span>&#123;<span class="attr">data</span>:res&#125; =<span class="keyword">await</span> <span class="title function_">findProductList</span>(<span class="variable language_">this</span>.<span class="property">start</span>,<span class="variable language_">this</span>.<span class="property">limit</span>,<span class="variable language_">this</span>.<span class="property">obj</span>)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">start</span>++</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>,<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">start</span>)</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;12323&quot;</span>,res)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">total</span>=res.<span class="property">data</span>.<span class="property">total</span></span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">goodsList</span>.<span class="title function_">push</span>(...res.<span class="property">data</span>.<span class="property">rows</span>);</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;数组&quot;</span>,<span class="variable language_">this</span>.<span class="property">goodsList</span>)</span><br><span class="line">				uni.<span class="title function_">stopPullDownRefresh</span>()</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			<span class="title function_">changeTab</span>(<span class="params">val</span>) &#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">current</span> = val;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">goodsList</span>=[];</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">start</span>=<span class="number">1</span></span><br><span class="line">				<span class="keyword">var</span> item = <span class="variable language_">this</span>.<span class="property">tabList</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">ele, index</span>) =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">return</span> index == val</span><br><span class="line">				&#125;)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">tabList</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">ele,index</span>)&#123;</span><br><span class="line">					<span class="keyword">if</span>(val==index)&#123;</span><br><span class="line">						</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span>&#123;</span><br><span class="line">						ele.<span class="property">iconStatues</span>=<span class="string">&quot;default&quot;</span> </span><br><span class="line">					&#125;</span><br><span class="line">					</span><br><span class="line">				&#125;)</span><br><span class="line">				<span class="keyword">if</span> (item.<span class="property">iconStatues</span> == <span class="string">&#x27;default&#x27;</span>) &#123;</span><br><span class="line">					item.<span class="property">iconStatues</span> = <span class="string">&#x27;up&#x27;</span></span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">isDesc</span>=<span class="number">1</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">iconStatues</span> == <span class="string">&#x27;up&#x27;</span>)</span><br><span class="line"></span><br><span class="line">				&#123;</span><br><span class="line">					item.<span class="property">iconStatues</span> = <span class="string">&#x27;down&#x27;</span></span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">isDesc</span>=<span class="number">0</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">				&#123;</span><br><span class="line">                     item.<span class="property">iconStatues</span> = <span class="string">&#x27;up&#x27;</span></span><br><span class="line">					 <span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">isDesc</span>=<span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(val==<span class="number">1</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">sortBy</span>=<span class="string">&quot;sale&quot;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(val==<span class="number">2</span>)&#123;</span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">sortBy</span>=<span class="string">&quot;price&quot;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="title function_">getListData</span>()</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">components</span>:&#123;</span><br><span class="line">			<span class="title class_">Good</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">			<span class="comment">// console.log(&quot;32423&quot;,options)</span></span><br><span class="line">			<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">categoryId</span>=options.<span class="property">id</span></span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">getListData</span>()</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">onReachBottom</span>(<span class="params"></span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">goodsList</span>.<span class="property">length</span>&lt;<span class="variable language_">this</span>.<span class="property">total</span>)&#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="title function_">getListData</span>()</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">onPullDownRefresh</span>(<span class="params"></span>)&#123;</span><br><span class="line">			<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">start</span>=<span class="number">1</span>;</span><br><span class="line">			<span class="variable language_">this</span>.<span class="property">goodsList</span>=[]</span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">getListData</span>()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="uni页面间跳转"><a href="#uni页面间跳转" class="headerlink" title="uni页面间跳转"></a>uni页面间跳转</h1><h1 id="navigateto"><a href="#navigateto" class="headerlink" title="navigateto"></a>navigateto</h1><h4 id="uni-navigateTo-OBJECT"><a href="#uni-navigateTo-OBJECT" class="headerlink" title="uni.navigateTo(OBJECT)"></a>uni.navigateTo(OBJECT)</h4><p>触发入栈操作<br>保留当前页面，跳转到应用内的某个页面，使用<code>uni.navigateBack</code>可以返回到原页面。</p>
<p><strong>OBJECT参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">默认值</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left"></td>
<td align="left">需要跳转的应用内非 tabBar 的页面的路径 , 路径后可以带参数。参数与路径之间使用?分隔，参数键与参数值用&#x3D;相连，不同参数用&amp;分隔；如 ‘path?key&#x3D;value&amp;key2&#x3D;value2’，path为下一个页面的路径，下一个页面的onLoad函数可得到传递的参数</td>
<td align="left">:-</td>
</tr>
<tr>
<td align="left">animationType</td>
<td align="left">String</td>
<td align="left">否</td>
<td align="left">pop-in</td>
<td align="left">窗口显示的动画效果，详见：<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/router?id=animation">窗口动画</a></td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">animationDuration</td>
<td align="left">Number</td>
<td align="left">否</td>
<td align="left">300</td>
<td align="left">窗口动画持续时间，单位为 ms</td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">events</td>
<td align="left">Object</td>
<td align="left">否</td>
<td align="left"></td>
<td align="left">页面间通信接口，用于监听被打开页面发送到当前页面的数据。2.8.9+ 开始支持。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left"></td>
<td align="left">接口调用成功的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left"></td>
<td align="left">接口调用失败的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left"></td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>object.success 回调函数</strong></p>
<p><strong>参数</strong></p>
<p><strong>Object res</strong></p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">eventChannel</td>
<td align="left"><a target="_blank" rel="noopener" href="http://doc.bufanui.com/docs/a411524237/api/router?id=event-channel">EventChannel</a></td>
<td align="left">和被打开页面进行通信</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在起始页面跳转到test.vue页面并传递参数</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;test?id=1&amp;name=uniapp&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 在test.vue页面接受参数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">option</span>) &#123; <span class="comment">//option为object类型，会序列化上个页面传递的参数</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(option.<span class="property">id</span>); <span class="comment">//打印出上个页面传递的参数。</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(option.<span class="property">name</span>); <span class="comment">//打印出上个页面传递的参数。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="redirectto"><a href="#redirectto" class="headerlink" title="redirectto"></a>redirectto</h1><h4 id="uni-redirectTo-OBJECT"><a href="#uni-redirectTo-OBJECT" class="headerlink" title="uni.redirectTo(OBJECT)"></a>uni.redirectTo(OBJECT)</h4><p>当前页面出栈 跳转之后的页面入栈<br>关闭当前页面，跳转到应用内的某个页面。(适用于登录后跳转到别的页面)</p>
<p><strong>OBJECT参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">需要跳转的应用内非 tabBar 的页面的路径，路径后可以带参数。参数与路径之间使用?分隔，参数键与参数值用&#x3D;相连，不同参数用&amp;分隔；如 ‘path?key&#x3D;value&amp;key2&#x3D;value2’</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">redirectTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;test?id=1&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li>跳转到 tabBar 页面只能使用 switchTab 跳转</li>
</ul>
<h1 id="relaunch"><a href="#relaunch" class="headerlink" title="relaunch"></a>relaunch</h1><h4 id="uni-reLaunch-OBJECT"><a href="#uni-reLaunch-OBJECT" class="headerlink" title="uni.reLaunch(OBJECT)"></a>uni.reLaunch(OBJECT)</h4><p>页面全部出栈，只留下新的页面<br>关闭所有页面，打开到应用内的某个页面。</p>
<p><strong>OBJECT参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">需要跳转的应用内页面路径 , 路径后可以带参数。参数与路径之间使用?分隔，参数键与参数值用&#x3D;相连，不同参数用&amp;分隔；如 ‘path?key&#x3D;value&amp;key2&#x3D;value2’，如果跳转的页面路径是 tabBar 页面则不能带参数</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;test?id=1&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">option</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(option.<span class="property">id</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Tips：</p>
<ul>
<li>H5端调用<code>uni.reLaunch</code>之后之前页面栈会销毁，但是无法清空浏览器之前的历史记录，此时<code>navigateBack</code>不能返回，如果存在历史记录的话点击浏览器的返回按钮或者调用<code>history.back()</code>仍然可以导航到浏览器的其他历史记录。</li>
</ul>
<h1 id="switchTab"><a href="#switchTab" class="headerlink" title="switchTab"></a>switchTab</h1><h4 id="uni-switchTab-OBJECT"><a href="#uni-switchTab-OBJECT" class="headerlink" title="uni.switchTab(OBJECT)"></a>uni.switchTab(OBJECT)</h4><p>跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面。</p>
<p><strong>OBJECT参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">需要跳转的 tabBar 页面的路径（需在 pages.json 的 tabBar 字段定义的页面），路径后不能带参数</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<p>pages.json</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tabBar&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;list&quot;</span>: [&#123;</span><br><span class="line">      <span class="string">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">      <span class="string">&quot;text&quot;</span>: <span class="string">&quot;首页&quot;</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      <span class="string">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/other/other&quot;</span>,</span><br><span class="line">      <span class="string">&quot;text&quot;</span>: <span class="string">&quot;其他&quot;</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>other.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="navigateBack"><a href="#navigateBack" class="headerlink" title="navigateBack"></a>navigateBack</h1><h4 id="uni-navigateBack-OBJECT"><a href="#uni-navigateBack-OBJECT" class="headerlink" title="uni.navigateBack(OBJECT)"></a>uni.navigateBack(OBJECT)</h4><p>关闭当前页面，返回上一页面或多级页面。可通过 <code>getCurrentPages()</code> 获取当前的页面栈，决定需要返回几层。</p>
<p><strong>OBJECT参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">默认值</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">delta</td>
<td align="left">Number</td>
<td align="left">否</td>
<td align="left">1</td>
<td align="left">返回的页面数，如果 delta 大于现有页面数，则返回到首页。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">animationType</td>
<td align="left">String</td>
<td align="left">否</td>
<td align="left">pop-out</td>
<td align="left">窗口关闭的动画效果，详见：<a target="_blank" rel="noopener" href="http://doc.bufanui.com/docs/a411524237/api/router?id=animation">窗口动画</a></td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">animationDuration</td>
<td align="left">Number</td>
<td align="left">否</td>
<td align="left">300</td>
<td align="left">窗口关闭动画的持续时间，单位为 ms</td>
<td align="left">App</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：调用 navigateTo 跳转时，调用该方法的页面会被加入堆栈，而 redirectTo 方法则不会。见下方示例代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处是A页面</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;B?id=1&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处是B页面</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;C?id=1&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在C页面内 navigateBack，将返回A页面</span></span><br><span class="line">uni.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">    <span class="attr">delta</span>: <span class="number">2</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="组件跳转"><a href="#组件跳转" class="headerlink" title="组件跳转"></a>组件跳转</h1><h4 id="navigator"><a href="#navigator" class="headerlink" title="navigator"></a>navigator</h4><p>页面跳转。</p>
<p>该组件类似HTML中的&#96;&#96;组件，但只能跳转本地页面。目标页面必须在pages.json中注册。</p>
<p>该组件的功能有API方式，另见：<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/router?id=navigateto">https://uniapp.dcloud.io/api/router?id=navigateto</a></p>
<p><strong>属性说明</strong></p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">类型</th>
<th align="left">默认值</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left"></td>
<td align="left">应用内的跳转链接，值为相对路径或绝对路径，如：”..&#x2F;first&#x2F;first”，”&#x2F;pages&#x2F;first&#x2F;first”，注意不能加 <code>.vue</code> 后缀</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">open-type</td>
<td align="left">String</td>
<td align="left">navigate</td>
<td align="left">跳转方式</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">delta</td>
<td align="left">Number</td>
<td align="left"></td>
<td align="left">当 open-type 为 ‘navigateBack’ 时有效，表示回退的层数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">animation-type</td>
<td align="left">String</td>
<td align="left">pop-in&#x2F;out</td>
<td align="left">当 open-type 为 navigate、navigateBack 时有效，窗口的显示&#x2F;关闭动画效果，详见：<a target="_blank" rel="noopener" href="http://doc.bufanui.com/docs/a411524237/api/router?id=animation">窗口动画</a></td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">animation-duration</td>
<td align="left">Number</td>
<td align="left">300</td>
<td align="left">当 open-type 为 navigate、navigateBack 时有效，窗口显示&#x2F;关闭动画的持续时间。</td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">hover-class</td>
<td align="left">String</td>
<td align="left">navigator-hover</td>
<td align="left">指定点击时的样式类，当hover-class&#x3D;”none”时，没有点击态效果</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">hover-stop-propagation</td>
<td align="left">Boolean</td>
<td align="left">false</td>
<td align="left">指定是否阻止本节点的祖先节点出现点击态</td>
<td align="left">微信小程序</td>
</tr>
<tr>
<td align="left">hover-start-time</td>
<td align="left">Number</td>
<td align="left">50</td>
<td align="left">按住后多久出现点击态，单位毫秒</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">hover-stay-time</td>
<td align="left">Number</td>
<td align="left">600</td>
<td align="left">手指松开后点击态保留时间，单位毫秒</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">target</td>
<td align="left">String</td>
<td align="left">self</td>
<td align="left">在哪个小程序目标上发生跳转，默认当前小程序，值域self&#x2F;miniProgram</td>
<td align="left">微信2.0.7+、百度2.5.2+、QQ</td>
</tr>
</tbody></table>
<p><strong>open-type 有效值</strong></p>
<table>
<thead>
<tr>
<th align="left">值</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">navigate</td>
<td align="left">对应 uni.navigateTo 的功能</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">redirect</td>
<td align="left">对应 uni.redirectTo 的功能</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">switchTab</td>
<td align="left">对应 uni.switchTab 的功能</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">reLaunch</td>
<td align="left">对应 uni.reLaunch 的功能</td>
<td align="left">字节跳动小程序不支持</td>
</tr>
<tr>
<td align="left">navigateBack</td>
<td align="left">对应 uni.navigateBack 的功能</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">exit</td>
<td align="left">退出小程序，target&#x3D;”miniProgram”时生效</td>
<td align="left">微信2.1.0+、百度2.5.2+、QQ1.4.7+</td>
</tr>
</tbody></table>
<p><strong>注意</strong></p>
<ul>
<li>跳转tabbar页面，必须设置open-type&#x3D;”switchTab”</li>
<li>navigator-hover 默认为 {background-color: rgba(0, 0, 0, 0.1); opacity: 0.7;}, &#96;&#96; 的子节点背景色应为透明色。</li>
<li>app-nvue 平台只有纯nvue项目（render为native）才支持 &#96;&#96;。非render为native的情况下，nvue暂不支持navigator组件，请使用API跳转。</li>
<li>app下退出应用，Android平台可以使用<a target="_blank" rel="noopener" href="https://www.html5plus.org/doc/zh_cn/runtime.html#plus.runtime.quit">plus.runtime.quit</a>。iOS没有退出应用的概念。</li>
<li>如果想实现web外链跳转，可参考<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?id=1182">uLink组件</a></li>
</ul>
<p><strong>示例</strong> <a target="_blank" rel="noopener" href="https://hellouniapp.dcloud.net.cn/pages/component/navigator/navigator">查看示例</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-body&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn-area&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;navigate/navigate?title=navigate&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;navigator-hover&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>&gt;</span>跳转到新页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;redirect/redirect?title=redirect&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;redirect&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;other-navigator-hover&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>&gt;</span>在当前页打开<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;/pages/tabBar/extUI/extUI&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;switchTab&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;other-navigator-hover&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>&gt;</span>跳转tab页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">// navigate.vue页面接受参数</span><br><span class="line">export default &#123;</span><br><span class="line">    onLoad: function (option) &#123; //option为object类型，会序列化上个页面传递的参数</span><br><span class="line">        console.log(option.id); //打印出上个页面传递的参数。</span><br><span class="line">        console.log(option.name); //打印出上个页面传递的参数。</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>url有长度限制，太长的字符串会传递失败，可使用<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/frame/communication">窗体通信</a>、<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35021">全局变量</a>，或<code>encodeURIComponent</code>等多种方式解决，如下为<code>encodeURIComponent</code>示例。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigator</span> <span class="attr">:url</span>=<span class="string">&quot;&#x27;/pages/navigate/navigate?item=&#x27;+ encodeURIComponent(JSON.stringify(item))&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">// navigate.vue页面接受参数</span><br><span class="line">onLoad: function (option) &#123;</span><br><span class="line">    const item = JSON.parse(decodeURIComponent(option.item));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="本地选取资源"><a href="#本地选取资源" class="headerlink" title="本地选取资源"></a>本地选取资源</h1><h3 id="uni-chooseImage-OBJECT"><a href="#uni-chooseImage-OBJECT" class="headerlink" title="uni.chooseImage(OBJECT)"></a>uni.chooseImage(OBJECT)</h3><p>从本地相册选择图片或使用相机拍照。</p>
<p>App端如需要更丰富的相机拍照API（如直接调用前置摄像头），参考<a target="_blank" rel="noopener" href="https://www.html5plus.org/doc/zh_cn/camera.html">plus.camera</a></p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">count</td>
<td align="left">Number</td>
<td align="left">否</td>
<td align="left">最多可以选择的图片张数，默认9</td>
<td align="left">见下方说明</td>
</tr>
<tr>
<td align="left">sizeType</td>
<td align="left">Array<String></td>
<td align="left">否</td>
<td align="left">original 原图，compressed 压缩图，默认二者都有</td>
<td align="left">App、微信小程序、支付宝小程序、百度小程序</td>
</tr>
<tr>
<td align="left">extension</td>
<td align="left">Array<String></td>
<td align="left">否</td>
<td align="left">根据文件拓展名过滤，每一项都不能是空字符串。默认不过滤。</td>
<td align="left">H5(HBuilder X2.9.9+)</td>
</tr>
<tr>
<td align="left">sourceType</td>
<td align="left">Array<String></td>
<td align="left">否</td>
<td align="left">album 从相册选图，camera 使用相机，默认二者都有。如需直接开相机或直接选相册，请只使用一个选项</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">是</td>
<td align="left">成功则返回图片的本地文件路径列表 tempFilePaths</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
<td align="left">小程序、App</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>Tips</strong></p>
<ul>
<li>count 值在 H5 平台的表现，基于浏览器本身的规范。目前测试的结果来看，只能限制单选&#x2F;多选，并不能限制数量。并且，在实际的手机浏览器很少有能够支持多选的。</li>
<li>sourceType 在H5端对应<code>input</code>的<code>capture</code>属性，设置为<code>[&#39;album&#39;]</code>无效，依然可以使用相机。</li>
<li>可以通过用户授权API来判断用户是否给应用授予相册或摄像头的访问权限<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/other/authorize">https://uniapp.dcloud.io/api/other/authorize</a></li>
<li>App端如需选择非媒体文件，可在插件市场搜索<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/search?q=%E6%96%87%E4%BB%B6%E9%80%89%E6%8B%A9">文件选择</a>，其中Android端可以使用Native.js，无需原生插件，而iOS端需要原生插件。</li>
</ul>
<p><strong>注：文件的临时路径，在应用本次启动期间可以正常使用，如需持久保存，需在主动调用 <a target="_blank" rel="noopener" href="http://doc.bufanui.com/docs/a411524237/api/file/file?id=savefile">uni.saveFile</a>，在应用下次启动时才能访问得到。</strong></p>
<p><strong>success 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">tempFilePaths</td>
<td align="left">Array<String></td>
<td align="left">图片的本地文件路径列表</td>
</tr>
<tr>
<td align="left">tempFiles</td>
<td align="left">Array<Object>、Array<File></td>
<td align="left">图片的本地文件列表，每一项是一个 File 对象</td>
</tr>
</tbody></table>
<p><strong>File 对象结构如下</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">path</td>
<td align="left">String</td>
<td align="left">本地文件路径</td>
</tr>
<tr>
<td align="left">size</td>
<td align="left">Number</td>
<td align="left">本地文件大小，单位：B</td>
</tr>
<tr>
<td align="left">name</td>
<td align="left">String</td>
<td align="left">包含扩展名的文件名称，仅H5支持</td>
</tr>
<tr>
<td align="left">type</td>
<td align="left">String</td>
<td align="left">文件类型，仅H5支持</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">6</span>, <span class="comment">//默认9</span></span><br><span class="line">    <span class="attr">sizeType</span>: [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>], <span class="comment">//可以指定是原图还是压缩图，默认二者都有</span></span><br><span class="line">    <span class="attr">sourceType</span>: [<span class="string">&#x27;album&#x27;</span>], <span class="comment">//从相册选择</span></span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">tempFilePaths</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="uni-previewImage-OBJECT-unipreviewimageobject"><a href="#uni-previewImage-OBJECT-unipreviewimageobject" class="headerlink" title="uni.previewImage(OBJECT) @unipreviewimageobject"></a>uni.previewImage(OBJECT) <a target="_blank" rel="noopener" href="https://github.com/unipreviewimageobject">@unipreviewimageobject</a></h3><p>预览图片。</p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">current</td>
<td align="left">String&#x2F;Number</td>
<td align="left">详见下方说明</td>
<td align="left">详见下方说明</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">urls</td>
<td align="left">Array<String></td>
<td align="left">是</td>
<td align="left">需要预览的图片链接列表</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">indicator</td>
<td align="left">String</td>
<td align="left">否</td>
<td align="left">图片指示器样式，可取值：”default” - 底部圆点指示器； “number” - 顶部数字指示器； “none” - 不显示指示器。</td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">loop</td>
<td align="left">Boolean</td>
<td align="left">否</td>
<td align="left">是否可循环预览，默认值为 false</td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">longPressActions</td>
<td align="left">Object</td>
<td align="left">否</td>
<td align="left">长按图片显示操作菜单，如不填默认为<strong>保存相册</strong></td>
<td align="left">App 1.9.5+</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>current 参数说明</strong></p>
<blockquote>
<p>1.9.5+ 支持传图片在 urls 中的索引值</p>
</blockquote>
<p>current 为当前显示图片的链接&#x2F;索引值，不填或填写的值无效则为 urls 的第一张。<strong>App平台在 1.9.5至1.9.8之间，current为必填。不填会报错</strong></p>
<p>注意，当 urls 中有重复的图片链接时：</p>
<ul>
<li>传链接，预览结果始终显示该链接在 urls 中第一次出现的位置。</li>
<li>传索引值，在微信&#x2F;百度&#x2F;字节跳动小程序平台，会过滤掉传入的 urls 中该索引值之前与其对应图片链接重复的值。其它平台会保留原始的 urls 不会做去重处理。</li>
</ul>
<p>举例说明：</p>
<p>一组图片 <code>[A, B1, C, B2, D]</code>，其中 B1 与 B2 的图片链接是一样的。</p>
<ul>
<li>传 B2 的链接，预览的结果是 B1，前一张是 A，下一张是 C。</li>
<li>传 B2 的索引值 3，预览的结果是 B2，前一张是 C，下一张是 D。此时在微信&#x2F;百度&#x2F;字节跳动小程序平台，最终传入的 urls 是 <code>[A, C, B2, D]</code>，过滤掉了与 B2 重复的 B1。</li>
</ul>
<p><strong>longPressActions 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">itemList</td>
<td align="left">Array<String></td>
<td align="left">是</td>
<td align="left">按钮的文字数组</td>
</tr>
<tr>
<td align="left">itemColor</td>
<td align="left">String</td>
<td align="left">否</td>
<td align="left">按钮的文字颜色，字符串格式，默认为”#000000”</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数，详见返回参数说明</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>success 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">index</td>
<td align="left">Number</td>
<td align="left">用户长按图片的索引值</td>
</tr>
<tr>
<td align="left">tapIndex</td>
<td align="left">Number</td>
<td align="left">用户点击按钮列表的索引值</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从相册选择6张图</span></span><br><span class="line">uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="attr">sizeType</span>: [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>],</span><br><span class="line">    <span class="attr">sourceType</span>: [<span class="string">&#x27;album&#x27;</span>],</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="comment">// 预览图片</span></span><br><span class="line">        uni.<span class="title function_">previewImage</span>(&#123;</span><br><span class="line">            <span class="attr">urls</span>: res.<span class="property">tempFilePaths</span>,</span><br><span class="line">            <span class="attr">longPressActions</span>: &#123;</span><br><span class="line">                <span class="attr">itemList</span>: [<span class="string">&#x27;发送给朋友&#x27;</span>, <span class="string">&#x27;保存图片&#x27;</span>, <span class="string">&#x27;收藏&#x27;</span>],</span><br><span class="line">                <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;选中了第&#x27;</span> + (data.<span class="property">tapIndex</span> + <span class="number">1</span>) + <span class="string">&#x27;个按钮,第&#x27;</span> + (data.<span class="property">index</span> + <span class="number">1</span>) + <span class="string">&#x27;张图片&#x27;</span>);</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">errMsg</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>TIPS</strong></p>
<ul>
<li>在非H5端，previewImage是原生实现的，界面自定义灵活度较低。</li>
<li>插件市场有前端实现的previewImage，性能低于原生实现，但界面可随意定义；插件市场也有适于App端的previewImage原生插件，提供了更多功能。</li>
</ul>
<h1 id="上传资源"><a href="#上传资源" class="headerlink" title="上传资源"></a>上传资源</h1><h3 id="uni-uploadFile-OBJECT"><a href="#uni-uploadFile-OBJECT" class="headerlink" title="uni.uploadFile(OBJECT)"></a>uni.uploadFile(OBJECT)</h3><p>将本地资源上传到开发者服务器，客户端发起一个 <code>POST</code> 请求，其中 <code>content-type</code> 为 <code>multipart/form-data</code>。<br>如页面通过 <a target="_blank" rel="noopener" href="http://doc.bufanui.com/docs/a411524237/api/media/image?id=chooseimage">uni.chooseImage</a> 等接口获取到一个本地资源的临时文件路径后，可通过此接口将本地资源上传到指定服务器。另外选择和上传非图像、视频文件参考：<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35547%E3%80%82">https://ask.dcloud.net.cn/article/35547。</a></p>
<blockquote>
<p>在各个小程序平台运行时，网络相关的 API 在使用前需要配置域名白名单。</p>
</blockquote>
<p><strong>推荐开发者使用更好的API<code>uniCloud.uploadFile</code>，uniCloud提供了免费CDN和更好的易用性，包括安全的cdn直传。详见：<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/uniCloud/storage?id=uploadfile">https://uniapp.dcloud.io/uniCloud/storage?id=uploadfile</a></strong></p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">开发者服务器 url</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">files</td>
<td align="left">Array</td>
<td align="left">否</td>
<td align="left">需要上传的文件列表。<strong>使用 files 时，filePath 和 name 不生效。</strong></td>
<td align="left">App、H5（ 2.6.15+）</td>
</tr>
<tr>
<td align="left">fileType</td>
<td align="left">String</td>
<td align="left">见平台差异说明</td>
<td align="left">文件类型，image&#x2F;video&#x2F;audio</td>
<td align="left">仅支付宝小程序，且必填。</td>
</tr>
<tr>
<td align="left">file</td>
<td align="left">File</td>
<td align="left">否</td>
<td align="left">要上传的文件对象。</td>
<td align="left">仅H5（2.6.15+）支持</td>
</tr>
<tr>
<td align="left">filePath</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">要上传文件资源的路径。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">name</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">文件对应的 key , 开发者在服务器端通过这个 key 可以获取到文件二进制内容</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">header</td>
<td align="left">Object</td>
<td align="left">否</td>
<td align="left">HTTP 请求 Header, header 中不能设置 Referer。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">timeout</td>
<td align="left">Number</td>
<td align="left">否</td>
<td align="left">超时时间，单位 ms</td>
<td align="left">H5(HBuilderX 2.9.9+)、APP(HBuilderX 2.9.9+)</td>
</tr>
<tr>
<td align="left">formData</td>
<td align="left">Object</td>
<td align="left">否</td>
<td align="left">HTTP 请求中其他额外的 form data</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>注意</strong>：</p>
<ul>
<li>App支持多文件上传，微信小程序只支持单文件上传，传多个文件需要反复调用本API。所以跨端的写法就是循环调用本API。</li>
<li>hello uni-app中的客服反馈，支持多图上传。<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/">uni-app插件市场</a>中也有多个封装的组件。</li>
<li>App平台选择和上传非图像、视频文件，参考<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35547">https://ask.dcloud.net.cn/article/35547</a></li>
<li>网络请求的 <code>超时时间</code> 可以统一在 <code>manifest.json</code> 中配置 <a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/manifest?id=networktimeout">networkTimeout</a>。</li>
<li>支付宝小程序开发工具上传文件返回的http状态码为字符串形式，支付宝小程序真机返回的状态码为数字形式</li>
</ul>
<p><strong>files参数说明</strong></p>
<p>files 参数是一个 file 对象的数组，file 对象的结构如下：</p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">name</td>
<td align="left">String</td>
<td align="left">否</td>
<td align="left">multipart 提交时，表单的项目名，默认为 file</td>
</tr>
<tr>
<td align="left">file</td>
<td align="left">File</td>
<td align="left">否</td>
<td align="left">要上传的文件对象，仅H5（2.6.15+）支持</td>
</tr>
<tr>
<td align="left">uri</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">文件的本地地址</td>
</tr>
</tbody></table>
<p>Tip:</p>
<ul>
<li>如果 <code>name</code> 不填或填的值相同，可能导致服务端读取文件时只能读取到一个文件。</li>
</ul>
<p><strong>success 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">data</td>
<td align="left">String</td>
<td align="left">开发者服务器返回的数据</td>
</tr>
<tr>
<td align="left">statusCode</td>
<td align="left">Number</td>
<td align="left">开发者服务器返回的 HTTP 状态码</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">chooseImageRes</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> tempFilePaths = chooseImageRes.<span class="property">tempFilePaths</span>;</span><br><span class="line">        uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;https://www.example.com/upload&#x27;</span>, <span class="comment">//仅为示例，非真实的接口地址</span></span><br><span class="line">            <span class="attr">filePath</span>: tempFilePaths[<span class="number">0</span>],</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">            <span class="attr">formData</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;test&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">uploadFileRes</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(uploadFileRes.<span class="property">data</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>返回值</strong></p>
<p>如果希望返回一个 <code>uploadTask</code> 对象，需要至少传入 success &#x2F; fail &#x2F; complete 参数中的一个。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uploadTask = uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://www.example.com/upload&#x27;</span>, <span class="comment">//仅为示例，并非真实接口地址。</span></span><br><span class="line">    <span class="attr">complete</span>: <span class="function">()=&gt;</span> &#123;&#125;</span><br><span class="line">&#125;);</span><br><span class="line">uploadTask.<span class="title function_">abort</span>();</span><br></pre></td></tr></table></figure>

<p>如果没有传入 success &#x2F; fail &#x2F; complete 参数，则会返回封装后的 Promise 对象：<a target="_blank" rel="noopener" href="http://doc.bufanui.com/api/README?id=promise-%E5%B0%81%E8%A3%85">Promise 封装</a></p>
<p>通过 <code>uploadTask</code>，可监听上传进度变化事件，以及取消上传任务。</p>
<p><strong>uploadTask 对象的方法列表</strong></p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">abort</td>
<td align="left"></td>
<td align="left">中断上传任务</td>
</tr>
<tr>
<td align="left">onProgressUpdate</td>
<td align="left">callback</td>
<td align="left">监听上传进度变化</td>
</tr>
<tr>
<td align="left">onHeadersReceived</td>
<td align="left">callback</td>
<td align="left">监听 HTTP Response Header 事件。会比请求完成事件更早,仅<code>微信小程序平台</code>支持，<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/UploadTask.onHeadersReceived.html">规范详情</a></td>
</tr>
<tr>
<td align="left">offProgressUpdate</td>
<td align="left">callback</td>
<td align="left">取消监听上传进度变化事件，仅<code>微信小程序平台</code>支持，<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/UploadTask.offProgressUpdate.html">规范详情</a></td>
</tr>
<tr>
<td align="left">offHeadersReceived</td>
<td align="left">callback</td>
<td align="left">取消监听 HTTP Response Header 事件，仅<code>微信小程序平台</code>支持，<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/UploadTask.offHeadersReceived.html">规范详情</a></td>
</tr>
</tbody></table>
<p><strong>onProgressUpdate 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">progress</td>
<td align="left">Number</td>
<td align="left">上传进度百分比</td>
</tr>
<tr>
<td align="left">totalBytesSent</td>
<td align="left">Number</td>
<td align="left">已经上传的数据长度，单位 Bytes</td>
</tr>
<tr>
<td align="left">totalBytesExpectedToSend</td>
<td align="left">Number</td>
<td align="left">预期需要上传的数据总长度，单位 Bytes</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">chooseImageRes</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> tempFilePaths = chooseImageRes.<span class="property">tempFilePaths</span>;</span><br><span class="line">        <span class="keyword">const</span> uploadTask = uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;https://www.example.com/upload&#x27;</span>, <span class="comment">//仅为示例，非真实的接口地址</span></span><br><span class="line">            <span class="attr">filePath</span>: tempFilePaths[<span class="number">0</span>],</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">            <span class="attr">formData</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;test&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">uploadFileRes</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(uploadFileRes.<span class="property">data</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        uploadTask.<span class="title function_">onProgressUpdate</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;上传进度&#x27;</span> + res.<span class="property">progress</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;已经上传的数据长度&#x27;</span> + res.<span class="property">totalBytesSent</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;预期需要上传的数据总长度&#x27;</span> + res.<span class="property">totalBytesExpectedToSend</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 测试条件，取消上传任务。</span></span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">progress</span> &gt; <span class="number">50</span>) &#123;</span><br><span class="line">                uploadTask.<span class="title function_">abort</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//项目中的实例代码</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">			<span class="comment">//提交退款</span></span><br><span class="line">			<span class="title function_">upload</span>(<span class="params"></span>) &#123;</span><br><span class="line">				<span class="keyword">var</span> _this=<span class="variable language_">this</span></span><br><span class="line">				<span class="keyword">var</span> arr = []</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">imgList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">ele</span> =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">var</span> pro = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, rejected</span>) =&gt;</span> &#123;</span><br><span class="line">						uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">							<span class="attr">url</span>: baserUrl + <span class="string">&quot;/lejuClient/orderReturn/uploadImg&quot;</span>,</span><br><span class="line">							<span class="attr">filePath</span>: ele,</span><br><span class="line">							<span class="attr">name</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">							<span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">								<span class="title function_">resolve</span>(res)</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;)</span><br><span class="line">					&#125;)</span><br><span class="line">					arr.<span class="title function_">push</span>(pro)</span><br><span class="line">				&#125;)</span><br><span class="line">				<span class="title class_">Promise</span>.<span class="title function_">all</span>(arr).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;上传成功&quot;</span>, res)</span><br><span class="line">					res.<span class="title function_">forEach</span>(<span class="function"><span class="params">ele</span>=&gt;</span>&#123;</span><br><span class="line">						ele.<span class="property">data</span>=<span class="title class_">JSON</span>.<span class="title function_">parse</span>(ele.<span class="property">data</span>)</span><br><span class="line">					&#125;)</span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">imgss</span>=res.<span class="title function_">map</span>(<span class="function"><span class="params">ele</span>=&gt;</span>ele.<span class="property">data</span>.<span class="property">data</span>.<span class="property">fileUrl</span>)</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;imgs&quot;</span>,imgss)</span><br><span class="line">				&#125;)</span><br><span class="line">				<span class="keyword">var</span> obj=&#123;</span><br><span class="line">					<span class="string">&quot;companyAddressId&quot;</span>: <span class="string">&quot;1380488405939507202&quot;</span>,</span><br><span class="line">					<span class="string">&quot;count&quot;</span>: <span class="variable language_">this</span>.<span class="property">goodsItem</span>.<span class="property">productQuantity</span>,</span><br><span class="line">					<span class="string">&quot;description&quot;</span>: <span class="variable language_">this</span>.<span class="property">questionDes</span>,</span><br><span class="line">					<span class="string">&quot;orderId&quot;</span>: <span class="variable language_">this</span>.<span class="property">goodsItem</span>.<span class="property">orderId</span>,</span><br><span class="line">					<span class="string">&quot;orderItemId&quot;</span>: <span class="variable language_">this</span>.<span class="property">goodsItem</span>.<span class="property">id</span>,</span><br><span class="line">					<span class="string">&quot;proofPics&quot;</span>:<span class="variable language_">this</span>.<span class="property">imgss</span>.<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>) ,</span><br><span class="line">					<span class="string">&quot;reason&quot;</span>: <span class="variable language_">this</span>.<span class="property">reason</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="title function_">addOrderReturnApply</span>(obj).<span class="title function_">then</span>(<span class="function"><span class="params">returnRes</span>=&gt;</span>&#123;</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;退货&quot;</span>,returnRes)</span><br><span class="line">					uni.<span class="title function_">redirectTo</span>(&#123;</span><br><span class="line">						<span class="attr">url</span>: <span class="string">`/pages/my/orders/orders?type=4`</span></span><br><span class="line">					&#125;);</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="title function_">cancelImg</span>(<span class="params">index</span>) &#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">imgList</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="title function_">upimg</span>(<span class="params"></span>) &#123;</span><br><span class="line">				<span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">				uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">					<span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">						<span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">						<span class="keyword">var</span> imgs = res.<span class="property">tempFilePaths</span>;</span><br><span class="line">						<span class="comment">// _this.imgList=res.tempFilePaths;</span></span><br><span class="line">						<span class="keyword">if</span> (imgs &gt;= <span class="number">4</span>) &#123;</span><br><span class="line">							uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">								<span class="attr">title</span>: <span class="string">&quot;一次最多只能选取3张&quot;</span></span><br><span class="line">							&#125;)</span><br><span class="line">							<span class="keyword">return</span></span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">if</span> (_this.<span class="property">imgList</span>.<span class="property">length</span> + imgs.<span class="property">length</span> &gt;= <span class="number">4</span>) &#123;</span><br><span class="line">							uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">								<span class="attr">title</span>: <span class="string">&quot;总共最多只能选取3张&quot;</span></span><br><span class="line">							&#125;)</span><br><span class="line">							<span class="keyword">return</span></span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">var</span> img = res.<span class="property">tempFilePaths</span>.<span class="title function_">find</span>(<span class="function"><span class="params">ele</span> =&gt;</span> ele.<span class="property">size</span> / <span class="number">1024</span> / <span class="number">1024</span> &gt; <span class="number">1</span>);</span><br><span class="line">						<span class="keyword">if</span> (img) &#123;</span><br><span class="line">							uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">								<span class="attr">title</span>: <span class="string">&quot;选取得图片尺寸大于1m，请重新上传&quot;</span></span><br><span class="line">							&#125;)</span><br><span class="line">							<span class="keyword">return</span></span><br><span class="line">						&#125;;</span><br><span class="line">						_this.<span class="property">imgList</span>.<span class="title function_">push</span>(...res.<span class="property">tempFilePaths</span>)</span><br><span class="line"></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="订单-x2F-退单筛选数据"><a href="#订单-x2F-退单筛选数据" class="headerlink" title="订单&#x2F;退单筛选数据"></a>订单&#x2F;退单筛选数据</h1><pre><code>computed: &#123;
        list() &#123;
            if (this.current == 4) &#123;
                return this.ordresReturn
            &#125;
            return this.returnList.filter(ele =&gt; &#123;
                if (this.current == 3) &#123;
                    return ele.order.status == 3 || ele.order.status == 4
                &#125;
                return ele.order.status == this.current
            &#125;)
        &#125;
    &#125;,
    
    filters: &#123;
            orderProcessText(process) &#123;
                var text = &#39;等待处理&#39;;
                switch (JSON.stringify(process)) &#123;
                    case &#39;0&#39;:
                        text = &#39;等待处理&#39;;
                        break;
                    case &#39;1&#39;:
                        text = &#39;确认退货,等待用户发货&#39;;
                        break;
                    case &#39;2&#39;:
                        text = &#39;已退款&#39;;
                        break;
                    case &#39;3&#39;:
                        text = &#39;已拒绝&#39;;
                        break;
                    case &#39;9&#39;:
                        text = &#39;拒绝退货&#39;;
                        break;

                    default:
                        break;
                &#125;
                return text;
            &#125;,
</code></pre>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-uni笔记" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/21/uni%E7%AC%94%E8%AE%B0/" class="article-date">
  	<time datetime="2022-08-21T08:38:05.082Z" itemprop="datePublished">2022-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ajax请求封装"><a href="#ajax请求封装" class="headerlink" title="ajax请求封装"></a>ajax请求封装</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">mport baseUrl <span class="keyword">from</span> <span class="string">&quot;./baseUrl&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>)&#123;</span><br><span class="line">	uni.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line">		<span class="attr">title</span>:<span class="string">&quot;加载中&quot;</span></span><br><span class="line">	&#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,rejected</span>)=&gt;</span>&#123;</span><br><span class="line">        uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:baseUrl+config.<span class="property">url</span>,</span><br><span class="line">            <span class="attr">method</span>:config.<span class="property">method</span>,</span><br><span class="line">            <span class="attr">data</span>:config.<span class="property">data</span>,</span><br><span class="line">			<span class="attr">header</span>:&#123;</span><br><span class="line">				<span class="string">&quot;token&quot;</span>:uni.<span class="title function_">getStorageSync</span>(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">            <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(res)</span><br><span class="line">            &#125;,</span><br><span class="line">           <span class="title function_">fail</span>(<span class="params">err</span>)&#123;</span><br><span class="line">            <span class="title function_">rejected</span>(err)</span><br><span class="line">           &#125;,</span><br><span class="line">		   <span class="title function_">complete</span>(<span class="params"></span>) &#123;</span><br><span class="line">		   	uni.<span class="title function_">hideLoading</span>()</span><br><span class="line">		   &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&quot;@/api/request.js&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateMemberInfo</span>(<span class="params">data</span>)&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">		<span class="attr">url</span>:<span class="string">`/lejuClient/member/updateMemberInfo`</span>,</span><br><span class="line">		<span class="attr">method</span>:<span class="string">&quot;POST&quot;</span>,</span><br><span class="line">		data</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">&quot;https://leju.bufan.cloud&quot;</span>;</span><br></pre></td></tr></table></figure>



<h1 id="发送请求显示加载框"><a href="#发送请求显示加载框" class="headerlink" title="发送请求显示加载框"></a>发送请求显示加载框</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">baseUrl</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">&quot;https://leju.bufan.cloud&quot;</span>;</span><br><span class="line">request</span><br><span class="line"><span class="comment">// import &#123; resolve &#125; from &quot;path&quot;</span></span><br><span class="line"><span class="keyword">import</span> baseUrl <span class="keyword">from</span> <span class="string">&quot;./baseUrl&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>)&#123;</span><br><span class="line">	uni.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line">		<span class="attr">title</span>:<span class="string">&quot;加载中&quot;</span></span><br><span class="line">	&#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,rejected</span>)=&gt;</span>&#123;</span><br><span class="line">        uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:baseUrl+config.<span class="property">url</span>,</span><br><span class="line">            <span class="attr">method</span>:config.<span class="property">method</span>,</span><br><span class="line">            <span class="attr">data</span>:config.<span class="property">data</span>,</span><br><span class="line">            <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(res)</span><br><span class="line">            &#125;,</span><br><span class="line">           <span class="title function_">fail</span>(<span class="params">err</span>)&#123;</span><br><span class="line">            <span class="title function_">rejected</span>(err)</span><br><span class="line">           &#125;,</span><br><span class="line">		   <span class="title function_">complete</span>(<span class="params"></span>) &#123;</span><br><span class="line">		   	uni.<span class="title function_">hideLoading</span>()</span><br><span class="line">		   &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></table></figure>

<h1 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h1><p><a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/ui/pulldown?id=onpulldownrefresh">https://uniapp.dcloud.io/api/ui/pulldown?id=onpulldownrefresh</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">onPullDownRefresh</span><br><span class="line">在 js 中定义 onPullDownRefresh 处理函数（和onLoad等生命周期函数同级），监听该页面用户下拉刷新事件。</span><br><span class="line"></span><br><span class="line">需要在 pages.<span class="property">json</span> 里，找到的当前页面的pages节点，并在 style 选项中开启 enablePullDownRefresh。</span><br><span class="line">当处理完数据刷新后，uni.<span class="property">stopPullDownRefresh</span> 可以停止当前页面的下拉刷新。</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210425201352758.png" alt="image-20210425201352758"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210425201529280.png" alt="image-20210425201529280"></p>
<h2 id="触底触发加载数据"><a href="#触底触发加载数据" class="headerlink" title="触底触发加载数据"></a>触底触发加载数据</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">		<span class="comment">// console.log(&quot;32423&quot;,options)</span></span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">categoryId</span>=options.<span class="property">id</span></span><br><span class="line">		<span class="variable language_">this</span>.<span class="title function_">getListData</span>()</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="title function_">onReachBottom</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">goodsList</span>.<span class="property">length</span>&lt;<span class="variable language_">this</span>.<span class="property">total</span>)&#123;</span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">getListData</span>()</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="页面传参"><a href="#页面传参" class="headerlink" title="页面传参"></a>页面传参</h1><h2 id="路由传参"><a href="#路由传参" class="headerlink" title="路由传参"></a>路由传参</h2><p>适用场景:<br>适合于简单的页面传参，传递的参数比较少，如传递的比较多，推荐适用globalData、本地缓存、vuex。</p>
<p>A页面向B页面传递参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;  </span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;test/test?id=1&amp;name=张三&#x27;</span>  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>B页面接收A页面传递的参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;  </span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">option</span>) &#123; <span class="comment">//option为object类型，会序列化上个页面传递的参数  </span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(option.<span class="property">id</span>); <span class="comment">//打印出上个页面传递的参数。  </span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(option.<span class="property">name</span>); <span class="comment">//打印出上个页面传递的参数。  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="globalData"><a href="#globalData" class="headerlink" title="globalData"></a>globalData</h2><p>小程序有globalData，这是一种简单的全局变量机制。这套机制在uni-app里也可以使用，并且全端通用。</p>
<p>以下是 App.vue 中定义globalData的相关配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;  </span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;  </span><br><span class="line">        <span class="attr">globalData</span>: &#123;  </span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;text&#x27;</span>  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>js中操作globalData的方式如下： <code>getApp().globalData.text = &#39;test&#39;</code></p>
<h2 id="本地缓存"><a href="#本地缓存" class="headerlink" title="本地缓存"></a>本地缓存</h2><p>uni是一个跨平台的框架，可以编译运行到小程序、H5、APP等。<br>单纯的localstorage在uni中只能在H5端使用，如需在不同平台都能使用，得使用官方推荐得API。</p>
<h4 id="uni-setStorage-OBJECT"><a href="#uni-setStorage-OBJECT" class="headerlink" title="uni.setStorage(OBJECT)"></a>uni.setStorage(OBJECT)</h4><p>将数据存储在本地缓存中指定的 key 中，会覆盖掉原来该 key 对应的内容，这是一个异步接口。</p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">key</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">本地缓存中的指定的 key</td>
</tr>
<tr>
<td align="left">data</td>
<td align="left">Any</td>
<td align="left">是</td>
<td align="left">需要存储的内容，只支持原生类型、及能够通过 JSON.stringify 序列化的对象</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">setStorage</span>(&#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;storage_key&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;success&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="uni-setStorageSync-KEY-DATA"><a href="#uni-setStorageSync-KEY-DATA" class="headerlink" title="uni.setStorageSync(KEY,DATA)"></a>uni.setStorageSync(KEY,DATA)</h4><p>将 data 存储在本地缓存中指定的 key 中，会覆盖掉原来该 key 对应的内容，这是一个同步接口。</p>
<p><strong>参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">key</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">本地缓存中的指定的 key</td>
</tr>
<tr>
<td align="left">data</td>
<td align="left">Any</td>
<td align="left">是</td>
<td align="left">需要存储的内容，只支持原生类型、及能够通过 JSON.stringify 序列化的对象</td>
</tr>
</tbody></table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;storage_key&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="uni-getStorage-OBJECT"><a href="#uni-getStorage-OBJECT" class="headerlink" title="uni.getStorage(OBJECT)"></a>uni.getStorage(OBJECT)</h4><p>从本地缓存中异步获取指定 key 对应的内容。</p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">key</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">本地缓存中的指定的 key</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">是</td>
<td align="left">接口调用的回调函数，res &#x3D; {data: key对应的内容}</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>success 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">data</td>
<td align="left">Any</td>
<td align="left">key 对应的内容</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">getStorage</span>(&#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;storage_key&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="uni-getStorageSync-KEY"><a href="#uni-getStorageSync-KEY" class="headerlink" title="uni.getStorageSync(KEY)"></a>uni.getStorageSync(KEY)</h4><p>从本地缓存中同步获取指定 key 对应的内容。</p>
<p><strong>参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">key</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">本地缓存中的指定的 key</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> value = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;storage_key&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="uni-getStorageInfo-OBJECT"><a href="#uni-getStorageInfo-OBJECT" class="headerlink" title="uni.getStorageInfo(OBJECT)"></a>uni.getStorageInfo(OBJECT)</h4><p>异步获取当前 storage 的相关信息。</p>
<p><strong>平台差异说明</strong></p>
<table>
<thead>
<tr>
<th align="center">App</th>
<th align="center">H5</th>
<th align="center">微信小程序</th>
<th align="center">支付宝小程序</th>
<th align="center">百度小程序</th>
</tr>
</thead>
<tbody><tr>
<td align="center">HBuilderX 2.0.3+</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
</tbody></table>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">是</td>
<td align="left">接口调用的回调函数，详见返回参数说明</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>success 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">keys</td>
<td align="left">Array＜String＞</td>
<td align="left">当前 storage 中所有的 key</td>
</tr>
<tr>
<td align="left">currentSize</td>
<td align="left">Number</td>
<td align="left">当前占用的空间大小, 单位：kb</td>
</tr>
<tr>
<td align="left">limitSize</td>
<td align="left">Number</td>
<td align="left">限制的空间大小, 单位：kb</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">getStorageInfo</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">keys</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">currentSize</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">limitSize</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="uni-getStorageInfoSync"><a href="#uni-getStorageInfoSync" class="headerlink" title="uni.getStorageInfoSync()"></a>uni.getStorageInfoSync()</h4><p>同步获取当前 storage 的相关信息。</p>
<p><strong>平台差异说明</strong></p>
<table>
<thead>
<tr>
<th align="center">App</th>
<th align="center">H5</th>
<th align="center">微信小程序</th>
<th align="center">支付宝小程序</th>
<th align="center">百度小程序</th>
</tr>
</thead>
<tbody><tr>
<td align="center">HBuilderX 2.0.3+</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = uni.<span class="title function_">getStorageInfoSync</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">keys</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">currentSize</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">limitSize</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="uni-removeStorage-OBJECT"><a href="#uni-removeStorage-OBJECT" class="headerlink" title="uni.removeStorage(OBJECT)"></a>uni.removeStorage(OBJECT)</h4><p>从本地缓存中异步移除指定 key。</p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">key</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">本地缓存中的指定的 key</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">是</td>
<td align="left">接口调用的回调函数</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">removeStorage</span>(&#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;storage_key&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;success&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="uni-removeStorageSync-KEY"><a href="#uni-removeStorageSync-KEY" class="headerlink" title="uni.removeStorageSync(KEY)"></a>uni.removeStorageSync(KEY)</h4><p>从本地缓存中同步移除指定 key。</p>
<p><strong>参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">key</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">本地缓存中的指定的 key</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    uni.<span class="title function_">removeStorageSync</span>(<span class="string">&#x27;storage_key&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="uni-clearStorage"><a href="#uni-clearStorage" class="headerlink" title="uni.clearStorage()"></a>uni.clearStorage()</h4><p>清理本地数据缓存。</p>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">clearStorage</span>();</span><br></pre></td></tr></table></figure>

<h4 id="uni-clearStorageSync"><a href="#uni-clearStorageSync" class="headerlink" title="uni.clearStorageSync()"></a>uni.clearStorageSync()</h4><p>同步清理本地数据缓存。</p>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    uni.<span class="title function_">clearStorageSync</span>();</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<p>uni-app的Storage在不同端的实现不同：</p>
<ul>
<li>H5端为localStorage，浏览器限制5M大小，是缓存概念，可能会被清理</li>
<li>App端为原生的plus.storage，无大小限制，不是缓存，是持久化的</li>
<li>各个小程序端为其自带的storage api，数据存储生命周期跟小程序本身一致，即除用户主动删除或超过一定时间被自动清理，否则数据都一直可用。</li>
<li>微信小程序单个 key 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB。</li>
<li>支付宝小程序单条数据转换成字符串后，字符串长度最大200*1024。同一个支付宝用户，同一个小程序缓存总上限为10MB。</li>
<li>百度、字节跳动小程序文档未说明大小限制</li>
</ul>
<p>除此之外，其他数据存储方案：</p>
<ul>
<li>H5端还支持websql、indexedDB、sessionStorage</li>
<li>App端还支持<a target="_blank" rel="noopener" href="https://www.html5plus.org/doc/zh_cn/sqlite.html">SQLite</a>、<a target="_blank" rel="noopener" href="https://www.html5plus.org/doc/zh_cn/io.html">IO文件</a>等本地存储方案。</li>
</ul>
<p>从HBuilderX2.6.6+起，App-Android平台对本地storage数据存储进行了性能优化，它的具体优化方式和升级注意事项，详见：<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/37071">https://ask.dcloud.net.cn/article/37071</a></p>
<h2 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line">在uni中使用<span class="attr">vuex</span>:</span><br><span class="line">在 uni-app 项目根目录下，新建 store 目录，在此目录下新建 index.<span class="property">js</span> 文件。在 index.<span class="property">js</span> 文件配置如下：</span><br><span class="line"><span class="comment">// 页面路径：store/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);<span class="comment">//vue的插件机制</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Vuex.Store 构造器选项</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>:&#123;<span class="comment">//存放状态</span></span><br><span class="line">        <span class="string">&quot;username&quot;</span>:<span class="string">&quot;foo&quot;</span></span><br><span class="line">        <span class="string">&quot;age&quot;</span>:<span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br><span class="line">在 main.<span class="property">js</span> 中导入文件。</span><br><span class="line">&lt;!-- 页面路径：main.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$store</span> = store</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 store 对象提供给 “store” 选项，这可以把 store 的实例注入所有的子组件</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    store,</span><br><span class="line">    ...<span class="title class_">App</span></span><br><span class="line">&#125;)</span><br><span class="line">app.$mount()</span><br><span class="line">获取state</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>通过属性访问，需要在根节点注入 store 。</span><br><span class="line"></span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span>;<span class="comment">//需要引入store</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">username</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> store.<span class="property">state</span>.<span class="property">username</span> </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="number">2.</span>在组件中使用，通过 <span class="variable language_">this</span>.<span class="property">$store</span> 访问到 state 里的数据。</span><br><span class="line"></span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">username</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">username</span> </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">mapState</span><br><span class="line"><span class="number">3.</span>通过 mapState 辅助函数获取。</span><br><span class="line"></span><br><span class="line">当一个组件需要获取多个状态的时候，将这些状态都声明为计算属性会有些重复和冗余。</span><br><span class="line">为了解决这个问题，我们可以使用 mapState 辅助函数 帮助我们生成计算属性，让你少按几次键：</span><br><span class="line"></span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: <span class="title function_">mapState</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// 从state中拿到数据 箭头函数可使代码更简练</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">username</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">username</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">age</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">age</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;) </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">当映射的计算属性的名称与 state 的子节点名称相同时，我们也可以给 mapState 传一个字符串数组。</span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: <span class="title function_">mapState</span>([</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&#x27;username&#x27;</span>,<span class="comment">//映射 this.username 为 store.state.username</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="string">&#x27;age&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        ])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">为了能够使用 <span class="variable language_">this</span> 获取组件自己的data数据，必须使用常规函数。</span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">firstName</span>:<span class="string">&quot;Li&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            ...<span class="title function_">mapState</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">username</span>: <span class="keyword">function</span> (<span class="params">state</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="string">&#x27; &#x27;</span> +  state.<span class="property">username</span> </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">age</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">age</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		find  &#123;&#123; age &#125;&#125;</span></span><br><span class="line"><span class="language-xml">		</span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span> @<span class="attr">tap</span>=<span class="string">&quot;updateAge(30)&quot;</span>&gt;</span>修改年龄<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="keyword">import</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		mapState,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		mapMutations,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		mapActions,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		mapGetters</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	&#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">computed</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			...<span class="title function_">mapState</span>([<span class="string">&quot;age&quot;</span>]) <span class="comment">// this.$store.state.age</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">methods</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			...<span class="title function_">mapMutations</span>([<span class="string">&quot;updateAge&quot;</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="CSS全局变量"><a href="#CSS全局变量" class="headerlink" title="CSS全局变量"></a>CSS全局变量</h1><p>uni-app 提供内置 CSS 变量</p>
<table>
<thead>
<tr>
<th align="left">CSS变量</th>
<th align="left">描述</th>
<th align="left">App</th>
<th align="left">小程序</th>
<th align="left">H5</th>
</tr>
</thead>
<tbody><tr>
<td align="left">–status-bar-height</td>
<td align="left">系统状态栏高度</td>
<td align="left"><a target="_blank" rel="noopener" href="http://www.html5plus.org/doc/zh_cn/navigator.html#plus.navigator.getStatusbarHeight">系统状态栏高度</a>、nvue注意见下</td>
<td align="left">25px</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">–window-top</td>
<td align="left">内容区域距离顶部的距离</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">NavigationBar 的高度</td>
</tr>
<tr>
<td align="left">–window-bottom</td>
<td align="left">内容区域距离底部的距离</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">TabBar 的高度</td>
</tr>
</tbody></table>
<p><strong>注意：</strong></p>
<ul>
<li><code>var(--status-bar-height)</code> 此变量在微信小程序环境为固定 <code>25px</code>，在 App 里为手机实际状态栏高度。</li>
<li>当设置 <code>&quot;navigationStyle&quot;:&quot;custom&quot;</code> 取消原生导航栏后，由于窗体为沉浸式，占据了状态栏位置。此时可以使用一个高度为 <code>var(--status-bar-height)</code> 的 view 放在页面顶部，避免页面内容出现在状态栏。</li>
<li>由于在H5端，不存在原生导航栏和tabbar，也是前端div模拟。如果设置了一个固定位置的居底view，在小程序和App端是在tabbar上方，但在H5端会与tabbar重叠。此时可使用<code>--window-bottom</code>，不管在哪个端，都是固定在tabbar上方。</li>
<li>目前 nvue 在App端，还不支持 <code>--status-bar-height</code>变量，替代方案是在页面onLoad时通过uni.getSystemInfoSync().statusBarHeight获取状态栏高度，然后通过style绑定方式给占位view设定高度。下方提供了示例代码</li>
</ul>
<p><strong>代码块</strong></p>
<p>快速书写css变量的方法是：在css中敲hei，在候选助手中即可看到3个css变量。（HBuilderX 1.9.6以上支持）</p>
<p>示例1 - 普通页面使用css变量：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- HBuilderX 2.6.3+ 新增 page-meta, 详情：https://uniapp.dcloud.io/component/page-meta --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">page-meta</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigation-bar</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">page-meta</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;status_bar&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 这里是状态栏 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span> 状态栏下的文字 <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.status_bar</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="built_in">var</span>(--status-bar-height);</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toTop&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 这里可以放一个向上箭头，它距离底部tabbar上浮10px--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.toTop</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">bottom</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--window-bottom) + <span class="number">10px</span>)</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="固定值"><a href="#固定值" class="headerlink" title="固定值"></a>固定值</h3><p><code>uni-app</code> 中以下组件的高度是固定的，不可修改：</p>
<table>
<thead>
<tr>
<th align="left">组件</th>
<th align="left">描述</th>
<th align="left">App</th>
<th align="left">H5</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NavigationBar</td>
<td align="left">导航栏</td>
<td align="left">44px</td>
<td align="left">44px</td>
</tr>
<tr>
<td align="left">TabBar</td>
<td align="left">底部选项卡</td>
<td align="left">HBuilderX 2.3.4之前为56px，2.3.4起和H5调为一致，统一为 50px。但可以自主更改高度）</td>
<td align="left">50px</td>
</tr>
</tbody></table>
<p>各小程序平台，包括同小程序平台的iOS和Android的高度也不一样。</p>
<h1 id="去除H5导航栏和自定义导航栏"><a href="#去除H5导航栏和自定义导航栏" class="headerlink" title="去除H5导航栏和自定义导航栏"></a>去除H5导航栏和自定义导航栏</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;pages&quot;</span>: [ <span class="comment">//pages数组中第一项表示应用启动页，参考：https://uniapp.dcloud.io/collocation/pages</span></span><br><span class="line">		&#123;</span><br><span class="line">		    <span class="string">&quot;path&quot;</span> : <span class="string">&quot;pages/home/home&quot;</span>,</span><br><span class="line">		    <span class="string">&quot;style&quot;</span> :                                                                                    </span><br><span class="line">		    &#123;</span><br><span class="line">		        <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">		        <span class="string">&quot;enablePullDownRefresh&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">				<span class="string">&quot;navigationStyle&quot;</span>:<span class="string">&quot;custom&quot;</span></span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">				<span class="comment">// &quot;h5&quot;:&#123;</span></span><br><span class="line">				<span class="comment">// 	// 去掉编译到h5平台的页面标题</span></span><br><span class="line">				<span class="comment">// 	&quot;titleNView&quot;:false</span></span><br><span class="line">				<span class="comment">// &#125;</span></span><br><span class="line">		    &#125;</span><br><span class="line">加了代码后内容不会贴顶</span><br><span class="line">            	 padding-<span class="attr">top</span>: <span class="title function_">var</span>(--status-bar-height);</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210425203636364.png" alt="image-20210425203636364"></p>
<h1 id="设置页面导航栏标题"><a href="#设置页面导航栏标题" class="headerlink" title="设置页面导航栏标题"></a>设置页面导航栏标题</h1><h3 id="uni-setNavigationBarTitle-OBJECT"><a href="#uni-setNavigationBarTitle-OBJECT" class="headerlink" title="uni.setNavigationBarTitle(OBJECT)"></a><a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/ui/navigationbar?id=setnavigationbartitle">uni.setNavigationBarTitle(OBJECT)</a></h3><h1 id="富文本组件"><a href="#富文本组件" class="headerlink" title="富文本组件"></a>富文本组件</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;mp-html :tag-style=<span class="string">&quot;imgHtml&quot;</span> :content=<span class="string">&quot;product.detailMobileHtml&quot;</span> /&gt;</span><br><span class="line">          <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		<span class="attr">indicatorDots</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">autoplay</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">interval</span>: <span class="number">2000</span>,</span><br><span class="line">		<span class="attr">duration</span>: <span class="number">500</span>,</span><br><span class="line">		<span class="comment">//轮播图数据</span></span><br><span class="line">		<span class="attr">bannerList</span>: [],</span><br><span class="line">		<span class="comment">//商品数据</span></span><br><span class="line">		<span class="attr">product</span>: &#123;&#125;,</span><br><span class="line">		<span class="attr">imgHtml</span>:&#123;</span><br><span class="line">			<span class="attr">img</span>:<span class="string">&quot;width:90%;height:auto;margin: 0 auto;display:block&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="H5端去除标题"><a href="#H5端去除标题" class="headerlink" title="H5端去除标题"></a>H5端去除标题</h1><p>pages.json里面写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&quot;globalStyle&quot;</span>: &#123;</span><br><span class="line">	<span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;乐居&quot;</span>,</span><br><span class="line">	<span class="string">&quot;enablePullDownRefresh&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="string">&quot;navigationBarBackgroundColor&quot;</span>: <span class="string">&quot;#354e44&quot;</span>,</span><br><span class="line">	<span class="string">&quot;navigationBarTextStyle&quot;</span>: <span class="string">&quot;white&quot;</span>,</span><br><span class="line">	<span class="string">&quot;h5&quot;</span>:&#123;</span><br><span class="line">		<span class="string">&quot;titleNView&quot;</span>:<span class="literal">false</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-promise解决图片异步加载" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/21/promise%E8%A7%A3%E5%86%B3%E5%9B%BE%E7%89%87%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD/" class="article-date">
  	<time datetime="2022-08-21T08:36:06.044Z" itemprop="datePublished">2022-08-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="promise解决图片异步加载"><a href="#promise解决图片异步加载" class="headerlink" title="promise解决图片异步加载"></a>promise解决图片异步加载</h1><p>解决多张图片异步加载</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Create</span>(<span class="params">url</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">             <span class="keyword">let</span> oimg = <span class="keyword">new</span> <span class="title class_">Image</span>();<span class="comment">//创建img标签</span></span><br><span class="line">             oimg.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                 <span class="title function_">resolve</span>(oimg)</span><br><span class="line">             &#125;</span><br><span class="line">             oimg.<span class="property">onerror</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                 <span class="title function_">reject</span>(<span class="string">`&#x27;<span class="subst">$&#123;oimg&#125;</span>&#x27; is not find`</span>)</span><br><span class="line">             &#125;</span><br><span class="line">             oimg.<span class="property">src</span> = url</span><br><span class="line">         &#125;)</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">let</span> imglist = [<span class="string">&#x27;./img/1.jpg&#x27;</span>, <span class="string">&#x27;./img/2.jpg&#x27;</span>, <span class="string">&#x27;./img/3.jpg&#x27;</span>, <span class="string">&#x27;./img/4.jpg&#x27;</span>];</span><br><span class="line">     <span class="title class_">Promise</span>.<span class="title function_">all</span>(imglist).<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">         result.<span class="title function_">forEach</span>(<span class="function"><span class="params">imgsrc</span> =&gt;</span> &#123;</span><br><span class="line">             <span class="title class_">Create</span>(imgsrc).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                 <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(res)</span><br><span class="line">             &#125;)</span><br><span class="line">         &#125;)</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(result)<span class="comment">// [&quot;./img/1.jpg&quot;, &quot;./img/2.jpg&quot;, &quot;./img/3.jpg&quot;, &quot;./img/4.jpg&quot;]</span></span><br><span class="line">     &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(error)<span class="comment">// 失败了，打出 &#x27;失败&#x27;</span></span><br><span class="line">     &#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">解决一张图片异步加载</span><br><span class="line"></span><br><span class="line">     <span class="keyword">function</span> <span class="title function_">Create</span>(<span class="params">url</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> oimg = <span class="keyword">new</span> <span class="title class_">Image</span>();<span class="comment">//创建img标签</span></span><br><span class="line">                oimg.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(oimg)</span><br><span class="line">                &#125;</span><br><span class="line">                oimg.<span class="property">onerror</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(<span class="string">`&#x27;<span class="subst">$&#123;oimg&#125;</span>&#x27; is not find`</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                oimg.<span class="property">src</span> = url</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="title class_">Create</span>(<span class="string">&#x27;./img/1.jpg&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(res)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2022 John Doe
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
</body>
</html>