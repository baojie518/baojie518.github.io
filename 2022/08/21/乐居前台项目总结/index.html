<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="发送请求显示加载框1234567891011121314151617181920212223242526mport baseUrl from &quot;.&#x2F;baseUrl&quot;function request(config)&amp;#123;	uni.showLoading(&amp;#123;		title:&quot;加载中&quot;	&amp;#125;)    return new Promise((">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2022/08/21/%E4%B9%90%E5%B1%85%E5%89%8D%E5%8F%B0%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="发送请求显示加载框1234567891011121314151617181920212223242526mport baseUrl from &quot;.&#x2F;baseUrl&quot;function request(config)&amp;#123;	uni.showLoading(&amp;#123;		title:&quot;加载中&quot;	&amp;#125;)    return new Promise((">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://doc.bufanui.com/uploads/a411524237/images/m_f2ab02ca36dafc5a15a66c5e2b890bda_r.png">
<meta property="og:image" content="http://doc.bufanui.com/uploads/a411524237/images/m_af922828621c3355f2c501a0def0cd64_r.png">
<meta property="og:image" content="http://doc.bufanui.com/uploads/a411524237/images/m_be2d71ad36461ea805635005b3b7eaa6_r.png">
<meta property="og:image" content="http://doc.bufanui.com/uploads/a411524237/images/m_72c54be14a0fe7771620dedb730fe4c8_r.png">
<meta property="article:published_time" content="2022-08-21T08:38:43.233Z">
<meta property="article:modified_time" content="2021-05-05T07:54:50.094Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://doc.bufanui.com/uploads/a411524237/images/m_f2ab02ca36dafc5a15a66c5e2b890bda_r.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-乐居前台项目总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/08/21/%E4%B9%90%E5%B1%85%E5%89%8D%E5%8F%B0%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2022-08-21T08:38:43.233Z" itemprop="datePublished">2022-08-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="发送请求显示加载框"><a href="#发送请求显示加载框" class="headerlink" title="发送请求显示加载框"></a>发送请求显示加载框</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mport baseUrl <span class="keyword">from</span> <span class="string">&quot;./baseUrl&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>)&#123;</span><br><span class="line">	uni.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line">		<span class="attr">title</span>:<span class="string">&quot;加载中&quot;</span></span><br><span class="line">	&#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,rejected</span>)=&gt;</span>&#123;</span><br><span class="line">        uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:baseUrl+config.<span class="property">url</span>,</span><br><span class="line">            <span class="attr">method</span>:config.<span class="property">method</span>,</span><br><span class="line">            <span class="attr">data</span>:config.<span class="property">data</span>,</span><br><span class="line">			<span class="attr">header</span>:&#123;</span><br><span class="line">				<span class="string">&quot;token&quot;</span>:uni.<span class="title function_">getStorageSync</span>(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">            <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(res)</span><br><span class="line">            &#125;,</span><br><span class="line">           <span class="title function_">fail</span>(<span class="params">err</span>)&#123;</span><br><span class="line">            <span class="title function_">rejected</span>(err)</span><br><span class="line">           &#125;,</span><br><span class="line">		   <span class="title function_">complete</span>(<span class="params"></span>) &#123;</span><br><span class="line">		   	uni.<span class="title function_">hideLoading</span>()</span><br><span class="line">		   &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></table></figure>

<h1 id="本地的商品收藏"><a href="#本地的商品收藏" class="headerlink" title="本地的商品收藏"></a>本地的商品收藏</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">collect</span>(<span class="params">item</span>) &#123;</span><br><span class="line">			<span class="keyword">var</span> ids = uni.<span class="title function_">getStorageSync</span>(<span class="string">&quot;ids&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span> (ids == <span class="literal">undefined</span> || ids == <span class="literal">null</span> || ids == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">				uni.<span class="title function_">setStorageSync</span>(<span class="string">&quot;ids&quot;</span>, [item])</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">papersList</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span>	ele.<span class="property">id</span> == item.<span class="property">id</span></span><br><span class="line">				&#125;).<span class="property">collect</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (ids.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">				ids.<span class="title function_">push</span>(item)</span><br><span class="line">				uni.<span class="title function_">setStorageSync</span>(<span class="string">&quot;ids&quot;</span>, ids)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">papersList</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span>	ele.<span class="property">id</span> == item.<span class="property">id</span></span><br><span class="line">				&#125;).<span class="property">collect</span> = <span class="literal">true</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">var</span> arc = ids.<span class="title function_">find</span>(<span class="function"><span class="params">ele</span> =&gt;</span> ele.<span class="property">id</span> == item.<span class="property">id</span>);</span><br><span class="line">				<span class="keyword">if</span> (arc) &#123;</span><br><span class="line">					<span class="keyword">var</span> index = ids.<span class="title function_">findIndex</span>(<span class="function"><span class="params">ele</span> =&gt;</span> ele.<span class="property">id</span> == item.<span class="property">id</span>)</span><br><span class="line">					ids.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">					uni.<span class="title function_">setStorageSync</span>(<span class="string">&quot;ids&quot;</span>, ids)</span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">papersList</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">					<span class="keyword">return</span>	ele.<span class="property">id</span> == item.<span class="property">id</span></span><br><span class="line">					&#125;).<span class="property">collect</span> = <span class="literal">false</span></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					ids.<span class="title function_">push</span>(item);</span><br><span class="line">					uni.<span class="title function_">setStorageSync</span>(<span class="string">&quot;ids&quot;</span>, ids)</span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">papersList</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">					<span class="keyword">return</span>	ele.<span class="property">id</span> == item.<span class="property">id</span></span><br><span class="line">					&#125;).<span class="property">collect</span> = <span class="literal">true</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="全局css变量"><a href="#全局css变量" class="headerlink" title="全局css变量"></a>全局css变量</h1><p>uni-app 提供内置 CSS 变量</p>
<table>
<thead>
<tr>
<th align="left">CSS变量</th>
<th align="left">描述</th>
<th align="left">App</th>
<th align="left">小程序</th>
<th align="left">H5</th>
</tr>
</thead>
<tbody><tr>
<td align="left">–status-bar-height</td>
<td align="left">系统状态栏高度</td>
<td align="left"><a target="_blank" rel="noopener" href="http://www.html5plus.org/doc/zh_cn/navigator.html#plus.navigator.getStatusbarHeight">系统状态栏高度</a>、nvue注意见下</td>
<td align="left">25px</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">–window-top</td>
<td align="left">内容区域距离顶部的距离</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">NavigationBar 的高度</td>
</tr>
<tr>
<td align="left">–window-bottom</td>
<td align="left">内容区域距离底部的距离</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">TabBar 的高度</td>
</tr>
</tbody></table>
<p><strong>注意：</strong></p>
<ul>
<li><code>var(--status-bar-height)</code> 此变量在微信小程序环境为固定 <code>25px</code>，在 App 里为手机实际状态栏高度。</li>
<li>当设置 <code>&quot;navigationStyle&quot;:&quot;custom&quot;</code> 取消原生导航栏后，由于窗体为沉浸式，占据了状态栏位置。此时可以使用一个高度为 <code>var(--status-bar-height)</code> 的 view 放在页面顶部，避免页面内容出现在状态栏。</li>
<li>由于在H5端，不存在原生导航栏和tabbar，也是前端div模拟。如果设置了一个固定位置的居底view，在小程序和App端是在tabbar上方，但在H5端会与tabbar重叠。此时可使用<code>--window-bottom</code>，不管在哪个端，都是固定在tabbar上方。</li>
<li>目前 nvue 在App端，还不支持 <code>--status-bar-height</code>变量，替代方案是在页面onLoad时通过uni.getSystemInfoSync().statusBarHeight获取状态栏高度，然后通过style绑定方式给占位view设定高度。下方提供了示例代码</li>
</ul>
<p><strong>代码块</strong></p>
<p>快速书写css变量的方法是：在css中敲hei，在候选助手中即可看到3个css变量。（HBuilderX 1.9.6以上支持）</p>
<p>示例1 - 普通页面使用css变量：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- HBuilderX 2.6.3+ 新增 page-meta, 详情：https://uniapp.dcloud.io/component/page-meta --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">page-meta</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigation-bar</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">page-meta</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;status_bar&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 这里是状态栏 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span> 状态栏下的文字 <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.status_bar</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="built_in">var</span>(--status-bar-height);</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toTop&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 这里可以放一个向上箭头，它距离底部tabbar上浮10px--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.toTop</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">bottom</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--window-bottom) + <span class="number">10px</span>)</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="固定值"><a href="#固定值" class="headerlink" title="固定值"></a>固定值</h3><p><code>uni-app</code> 中以下组件的高度是固定的，不可修改：</p>
<table>
<thead>
<tr>
<th align="left">组件</th>
<th align="left">描述</th>
<th align="left">App</th>
<th align="left">H5</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NavigationBar</td>
<td align="left">导航栏</td>
<td align="left">44px</td>
<td align="left">44px</td>
</tr>
<tr>
<td align="left">TabBar</td>
<td align="left">底部选项卡</td>
<td align="left">HBuilderX 2.3.4之前为56px，2.3.4起和H5调为一致，统一为 50px。但可以自主更改高度）</td>
<td align="left">50px</td>
</tr>
</tbody></table>
<p>各小程序平台，包括同小程序平台的iOS和Android的高度也不一样。</p>
<h1 id="globalData"><a href="#globalData" class="headerlink" title="globalData"></a>globalData</h1><p>小程序有globalData，这是一种简单的全局变量机制。这套机制在uni-app里也可以使用，并且全端通用。</p>
<p>以下是 App.vue 中定义globalData的相关配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;  </span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;  </span><br><span class="line">        <span class="attr">globalData</span>: &#123;  </span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;text&#x27;</span>  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>js中操作globalData的方式如下： <code>getApp().globalData.text = &#39;test&#39;</code></p>
<h1 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h1><p>uni-app 内置了 <strong>Vuex</strong> 。<br>使用 Vuex 需要遵守的规则：</p>
<ul>
<li>应用层级的状态应该集中到单个 store 对象中。</li>
<li>提交 mutation 是更改状态的唯一方法，并且这个过程是同步的。</li>
<li>异步逻辑都应该封装到 action 里面。</li>
</ul>
<h2 id="在uni中使用vuex"><a href="#在uni中使用vuex" class="headerlink" title="在uni中使用vuex:"></a>在uni中使用vuex:</h2><ul>
<li>在 uni-app 项目根目录下，新建 store 目录，在此目录下新建 index.js 文件。在 index.js 文件配置如下：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 页面路径：store/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);<span class="comment">//vue的插件机制</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Vuex.Store 构造器选项</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>:&#123;<span class="comment">//存放状态</span></span><br><span class="line">        <span class="string">&quot;username&quot;</span>:<span class="string">&quot;foo&quot;</span></span><br><span class="line">        <span class="string">&quot;age&quot;</span>:<span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<ul>
<li>在 main.js 中导入文件。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：main.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$store</span> = store</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 store 对象提供给 “store” 选项，这可以把 store 的实例注入所有的子组件</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    store,</span><br><span class="line">    ...<span class="title class_">App</span></span><br><span class="line">&#125;)</span><br><span class="line">app.$mount()</span><br></pre></td></tr></table></figure>

<p><strong>获取state</strong></p>
<p>1.通过属性访问，需要在根节点注入 <code>store</code> 。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span>;<span class="comment">//需要引入store</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">username</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> store.<span class="property">state</span>.<span class="property">username</span> </span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.在组件中使用，通过 <code>this.$store</code> 访问到 <code>state</code> 里的数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">username</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">username</span> </span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="mapState"><a href="#mapState" class="headerlink" title="mapState"></a>mapState</h4><p>3.通过 <code>mapState</code> 辅助函数获取。</p>
<p>当一个组件需要获取多个状态的时候，将这些状态都声明为计算属性会有些重复和冗余。<br>为了解决这个问题，我们可以使用 <strong>mapState 辅助函数</strong> 帮助我们生成计算属性，让你少按几次键：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: <span class="title function_">mapState</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 从state中拿到数据 箭头函数可使代码更简练</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">username</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">username</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">age</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;) </span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>当映射的计算属性的名称与 <code>state</code> 的子节点名称相同时，我们也可以给 <code>mapState</code> 传一个字符串数组。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: <span class="title function_">mapState</span>([</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;username&#x27;</span>,<span class="comment">//映射 this.username 为 store.state.username</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;age&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        ])</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>为了能够使用 <code>this</code> 获取组件自己的data数据，必须使用常规函数。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">firstName</span>:<span class="string">&quot;Li&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,    </span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapState</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>: <span class="keyword">function</span> (<span class="params">state</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="string">&#x27; &#x27;</span> +  state.<span class="property">username</span> </span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">age</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">age</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用对象展开运算符</li>
</ul>
<p><code>mapState</code> 函数返回的是一个对象。使用对象展开运算符将多个对象合并为一个，以使我们可以将最终对象传给 <code>computed</code> 属性。极大地简化写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>用户名：&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapState</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//使用对象展开运算符将此对象混入到外部对象中</span></span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapState</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">username</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">age</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">age</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a>Getter</h3><p>可以认为是 <code>store</code> 的计算属性，对 <code>state</code> 的加工，是派生出来的数据。</p>
<ul>
<li>就像 <code>computed</code> 计算属性一样，<code>getter</code> 返回的值会根据它的依赖被缓存起来，且只有当它的依赖值发生改变才会被重新计算。</li>
<li>可以在多组件中共享 <code>getter</code> 函数，这样做还可以提高运行效率。</li>
</ul>
<p>在 <code>uni-app</code> 项目根目录下，<code>store</code> 目录 <code>index.js</code> 文件下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">todos</span>: [&#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;我是内容一&#x27;</span>,</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;我是内容二&#x27;</span>,</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="attr">doneTodos</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">done</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p>在 <code>store</code> 上注册 <code>getter</code>，<code>getter</code> 方法接受以下参数：</p>
<ul>
<li>state, 如果在模块中定义则为模块的局部状态</li>
<li>getters, 等同于 store.getters</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">todos</span>: [&#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;我是内容一&#x27;</span>,</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;我是内容二&#x27;</span>,</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="attr">doneTodos</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">done</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">doneTodosCount</span>: <span class="function">(<span class="params">state, getters</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//state ：可以访问数据</span></span><br><span class="line">            <span class="comment">//getters：访问其他函数，等同于 store.getters</span></span><br><span class="line">            <span class="keyword">return</span> getters.<span class="property">doneTodos</span>.<span class="property">length</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">getTodoById</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.<span class="property">todos</span>.<span class="title function_">find</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">id</span> === id)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p><strong>获取getters</strong></p>
<p>1.通过属性访问，<code>Getter</code> 会暴露为 <code>store.getters</code> 对象，你可以以属性的形式访问这些值。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in todos&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.id&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.text&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.done&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span><span class="comment">//需要引入store</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">todos</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> store.<span class="property">getters</span>.<span class="property">doneTodos</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意，<code>getter</code> 在通过属性访问时是作为 <code>Vue</code> 的响应式系统的一部分缓存其中的。</p>
<p>2.通过 <code>this.$store</code> 访问。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in todos&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.id&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.text&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item.done&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">todos</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>.<span class="property">doneTodos</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.通过方法访问。</p>
<p>你也可以通过让 <code>getter</code> 返回一个函数，来实现给 <code>getter</code> 传参。在你对 <code>store</code> 里的数组进行查询时非常有用。</p>
<p>注意，<code>getter</code> 在通过方法访问时，每次都会去进行调用，而不会缓存结果。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in todos&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">todos</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>.<span class="title function_">getTodoById</span>(<span class="number">2</span>) </span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="mapGetters"><a href="#mapGetters" class="headerlink" title="mapGetters"></a>mapGetters</h4><p>4.通过 <code>mapGetters</code> 辅助函数访问。</p>
<p><code>mapGetters</code> 辅助函数仅仅是将 <code>store</code> 中的 <code>getter</code> 映射到局部计算属性：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;doneTodosCount&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;mapGetters&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span> <span class="comment">//引入mapGetters</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 使用对象展开运算符将 getter 混入 computed 对象中</span></span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapGetters</span>([</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;doneTodos&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;doneTodosCount&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// ...</span></span></span><br><span class="line"><span class="language-javascript">            ])</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你想将一个 <code>getter</code> 属性另取一个名字，使用对象形式：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;doneCount&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;mapGetters&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span> <span class="comment">//引入mapGetters</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapGetters</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 把 `this.doneCount` 映射为 `this.$store.getters.doneTodosCount`</span></span></span><br><span class="line"><span class="language-javascript">              <span class="attr">doneCount</span>: <span class="string">&#x27;doneTodosCount&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Mutation"><a href="#Mutation" class="headerlink" title="Mutation"></a>Mutation</h3><p><strong>Vuex中store数据改变的唯一方法就是mutation</strong></p>
<p>通俗的理解，<code>mutations</code> 里面装着改变数据的方法集合，处理数据逻辑的方法全部放在 <code>mutations</code> 里，使数据和视图分离。</p>
<p>Vuex 中的 <code>mutation</code> 非常类似于事件：每个 <code>mutation</code> 都有一个字符串的 事件类型 (type) 和 一个 回调函数 (handler)。这个回调函数就是我们实际进行状态更改的地方，并且它会接受 <code>state</code> 作为第一个参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state</span>) &#123;</span><br><span class="line">            <span class="comment">// 变更状态</span></span><br><span class="line">            state.<span class="property">count</span> += <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p>你不能直接调用一个 mutation handler。这个选项更像是事件注册：“当触发一个类型为 add 的 <code>mutation</code> 时，调用此函数”，要唤醒一个 mutation handler，你需要以相应的 type 调用 <code>store.commit</code> 方法。</p>
<p><strong>注意</strong>：<code>store.commit</code> 调用 <code>mutation</code>（需要在根节点注入 store）。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span>    </span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addCount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            store.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>传入参数</strong></p>
<p>你可以向 <code>store.commit</code> 传入额外的参数，即 <code>mutation</code> 的 载荷（payload）：</p>
<p>还是以累加器的例子来实现 <code>mutation</code> 函数的传参，来动态定义累加的数量。</p>
<ul>
<li>在 <code>mutation</code> 传参（载荷）可以传递一个参数。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state, n</span>) &#123;</span><br><span class="line">            state.<span class="property">count</span> += n</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">addCount</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                store.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>, <span class="number">5</span>)<span class="comment">//每次累加 5</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>在 <code>mutation</code> 传参（载荷）可以也可以传递一个对象。让我们修改上面累加器的例子：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">            state.<span class="property">count</span> += payload.<span class="property">amount</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            addCount () &#123;<span class="comment">//把载荷和type分开提交</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                store.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>, &#123; <span class="attr">amount</span>: <span class="number">10</span> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><strong>提交方式</strong></p>
<p>1.对象风格的提交方式</p>
<p>我们修改组件中 <code>store.commit</code> 提交方式：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addCount</span>(<span class="params"></span>) &#123;<span class="comment">//整个对象都作为载荷传给 mutation 函数</span></span></span><br><span class="line"><span class="language-javascript">                store.<span class="title function_">commit</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&#x27;add&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">amount</span>: <span class="number">6</span></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当使用对象风格的提交方式，整个对象都作为载荷传给 mutation 函数，因此 handler 保持不变：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">add</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">        state.<span class="property">count</span> += payload.<span class="property">amount</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="mapMutations"><a href="#mapMutations" class="headerlink" title="mapMutations"></a>mapMutations</h4><p>2.通过 <code>mapMutations</code> 辅助函数提交。</p>
<p>创建组件方法提交 <code>mutation</code>。</p>
<p>使用 <code>mapMutations</code> 辅助函数将组件中的 <code>methods</code> 映射为 <code>store.commit</code> 调用（需要在根节点注入 <code>store</code>）。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span><span class="comment">//引入mapMutations</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapMutations</span>([<span class="string">&#x27;add&#x27;</span>])<span class="comment">//对象展开运算符直接拿到add</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 页面路径：store/index.js --&gt;</span></span><br><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import Vuex from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"></span><br><span class="line">const store = new Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        add(state) &#123;</span><br><span class="line">            // 变更状态</span><br><span class="line">            state.count += 2</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">export default store</span><br></pre></td></tr></table></figure>

<p><strong>遵守规则</strong></p>
<p>既然 <code>Vuex</code> 的 <code>store</code> 中的状态是响应式的，那么当我们变更状态时，监视状态的 <code>Vue</code> 组件也会自动更新。这也意味着 <code>Vuex</code> 中的 <code>mutation</code> 也需要与使用 <code>Vue</code> 一样遵守一些注意事项：</p>
<ul>
<li>最好提前在你的 <code>store</code> 中初始化好所有所需属性。</li>
<li>当需要在对象上添加新属性时，你应该<ul>
<li>使用 <code>Vue.set(obj, &#39;newProp&#39;, 123)</code>, 或者</li>
<li>以新对象替换老对象。例如，利用对象展开运算符我们可以这样写：</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">state.<span class="property">obj</span> = &#123; ...state.<span class="property">obj</span>, <span class="attr">newProp</span>: <span class="number">123</span> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>Mutation 必须是同步函数</strong></p>
<p>一条重要的原则就是要记住** mutation 必须是同步函数**</p>
<p>我们要通过提交 <code>mutation</code> 的方式来改变状态数据，是因为我们想要更明确地追踪到状态的变化。如果是类似下面这样异步的话：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    someMutation (state) &#123;</span><br><span class="line">        api.<span class="title function_">callAsyncMethod</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">count</span>++</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们就不知道什么时候状态会发生改变，所以也就无法追踪了，这与 <code>mutation</code> 的设计初心相悖，所以强制规定它必须是同步函数。</p>
<h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><p><code>action</code> 类似于 <code>mutation</code> ，不同在于：</p>
<ul>
<li>action 提交的是 <code>mutation</code>，通过 <code>mutation</code> 来改变 <code>state</code> ，而不是直接变更状态。</li>
<li>action 可以包含任意异步操作。</li>
</ul>
<p>让我们来注册一个简单的 <code>action</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>:&#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state</span>) &#123;</span><br><span class="line">            <span class="comment">// 变更状态</span></span><br><span class="line">            state.<span class="property">count</span> += <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>:&#123;</span><br><span class="line">        addCountAction (context) &#123;</span><br><span class="line">            context.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p><code>action</code> 函数接受一个与 <code>store</code> 实例具有相同方法和属性的 <code>context</code> 对象，因此你可以调用 <code>context.commit</code> 提交一个 <code>mutation</code>，或者通过 <code>context.state</code> 和 <code>context.getters</code> 来获取 <code>state</code> 和 <code>getters</code>。</p>
<p>实践中，我们会经常用到 ES2015 的参数解构来简化代码（特别是我们需要调用 <code>commit</code> 很多次的时候）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">//参数解构</span></span><br><span class="line">    addCountAction (&#123;commit&#125;) &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>分发 Action</strong></p>
<p>1.<code>actions</code> 通过 <code>store.dispatch</code> 方法触发。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            add () &#123;</span></span><br><span class="line"><span class="language-javascript">                store.<span class="title function_">dispatch</span>(<span class="string">&#x27;addCountAction&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>actions</code> 支持以载荷形式分发:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>:&#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">            state.<span class="property">count</span> += payload.<span class="property">amount</span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>:&#123;</span><br><span class="line">        addCountAction (context , payload) &#123;</span><br><span class="line">            context.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>,payload)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br><span class="line">&lt;!-- 页面路径：pages/index/index.<span class="property">vue</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store/index.js&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            add () &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">// 以载荷形式分发</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                store.<span class="title function_">dispatch</span>(<span class="string">&#x27;addCountAction&#x27;</span>, &#123;<span class="attr">amount</span>: <span class="number">10</span>&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>actions</code> 支持以对象形式分发:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    add () &#123;</span><br><span class="line">        <span class="comment">// 以对象形式分发</span></span><br><span class="line">        store.<span class="title function_">dispatch</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;addCountAction&#x27;</span>,</span><br><span class="line">            <span class="attr">amount</span>: <span class="number">5</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>action</code> 可以执行任意的同步和异步操作</p>
<p>我们可以在 <code>action</code> 内部执行异步操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>:&#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state</span>) &#123;</span><br><span class="line">            <span class="comment">// 变更状态</span></span><br><span class="line">            state.<span class="property">count</span> += <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>:&#123;</span><br><span class="line">        addCountAction (context) &#123;</span><br><span class="line">            <span class="comment">//在执行累加的时候，会等待两秒才执行</span></span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                context.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">            &#125;, <span class="number">2000</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<p>来看一个更加实际的购物车示例，涉及到<strong>调用异步 API</strong> 和<strong>分发多重 mutation</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    checkout (&#123; commit, state &#125;, products) &#123;</span><br><span class="line">        <span class="comment">// 把当前购物车的物品备份起来</span></span><br><span class="line">        <span class="keyword">const</span> savedCartItems = [...state.<span class="property">cart</span>.<span class="property">added</span>]</span><br><span class="line">        <span class="comment">// 发出结账请求，然后乐观地清空购物车</span></span><br><span class="line">        <span class="title function_">commit</span>(types.<span class="property">CHECKOUT_REQUEST</span>)</span><br><span class="line">        <span class="comment">// 购物 API 接受一个成功回调和一个失败回调</span></span><br><span class="line">        shop.<span class="title function_">buyProducts</span>(</span><br><span class="line">            products,</span><br><span class="line">            <span class="comment">// 成功操作</span></span><br><span class="line">            <span class="function">() =&gt;</span> <span class="title function_">commit</span>(types.<span class="property">CHECKOUT_SUCCESS</span>),</span><br><span class="line">            <span class="comment">// 失败操作</span></span><br><span class="line">            <span class="function">() =&gt;</span> <span class="title function_">commit</span>(types.<span class="property">CHECKOUT_FAILURE</span>, savedCartItems)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意我们正在进行一系列的异步操作，并且通过提交 <code>mutation</code> 来记录 <code>action</code> 产生的状态变更。</p>
<h4 id="mapActions"><a href="#mapActions" class="headerlink" title="mapActions"></a>mapActions</h4><p>2.通过 <code>mapActions</code> 辅助函数分发。</p>
<p>创建组件方法分发 <code>action</code>。</p>
<ul>
<li>你在组件中使用 <code>this.$store.dispatch(&#39;xxx&#39;)</code> 分发 <code>action</code></li>
<li>或者使用 <code>mapActions</code> 辅助函数将组件的 <code>methods</code> 映射为 <code>store.dispatch</code> 调用（需要先在根节点注入 <code>store</code> ）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>数量：&#123;&#123;count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCountAction&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; mapActions &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapActions</span>([</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;addCountAction&#x27;</span>, </span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 将 `this.addCountAction()` 映射为 `this.$store.dispatch(&#x27;addCountAction&#x27;)`</span></span></span><br><span class="line"><span class="language-javascript">            ])</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>mapActions</code> 也支持传入参数（载荷）：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    ...<span class="title function_">mapActions</span>([</span><br><span class="line">        <span class="string">&#x27;addCountAction&#x27;</span> </span><br><span class="line">        <span class="comment">// 将 `this.addCountAction(amount)` 映射为 </span></span><br><span class="line">        <span class="comment">//`this.$store.dispatch(&#x27;addCountAction&#x27;, amount)`</span></span><br><span class="line">    ]),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>mapActions</code> 也支持传递一个对象：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    ...<span class="title function_">mapActions</span>(&#123;</span><br><span class="line">        <span class="attr">addCount</span>: <span class="string">&#x27;addCountAction&#x27;</span>,</span><br><span class="line">        <span class="comment">// 将 `this.addCount()` 映射为 `this.$store.dispatch(&#x27;addCountAction&#x27;)`</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>组合 Action</strong></p>
<p><code>action</code> 通常是异步的，那么如何知道 <code>action</code> 什么时候结束呢？更重要的是，我们如何才能组合多个 <code>action</code>，以处理更加复杂的异步流程？</p>
<p>首先，你需要明白 <code>store.dispatch</code> 可以处理被触发的 <code>action</code> 的处理函数返回的 <code>Promise</code>，并且 <code>store.dispatch</code> 仍旧返回 <code>Promise</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    actionA (&#123; commit &#125;) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">commit</span>(<span class="string">&#x27;someMutation&#x27;</span>)</span><br><span class="line">                <span class="title function_">resolve</span>()</span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在你可以在组件中使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="title function_">dispatch</span>(<span class="string">&#x27;actionA&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在另外一个 <code>action</code> 中也可以：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    actionB (&#123; dispatch, commit &#125;) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">dispatch</span>(<span class="string">&#x27;actionA&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&#x27;someOtherMutation&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，如果我们利用 <code>async / await</code>，我们可以如下组合 <code>action</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设 getData() 和 getOtherData() 返回的是 Promise</span></span><br><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> actionA (&#123; commit &#125;) &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;gotData&#x27;</span>, <span class="keyword">await</span> <span class="title function_">getData</span>())</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> actionB (&#123; dispatch, commit &#125;) &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">dispatch</span>(<span class="string">&#x27;actionA&#x27;</span>) <span class="comment">// 等待 actionA 完成</span></span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;gotOtherData&#x27;</span>, <span class="keyword">await</span> <span class="title function_">getOtherData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一个 <code>store.dispatch</code> 在不同模块中可以触发多个 <code>action</code> 函数。在这种情况下，只有当所有触发函数完成后，返回的 <code>Promise</code> 才会执行。</p>
</blockquote>
<h3 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h3><p>由于使用单一状态树，应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，<code>store</code> 对象就有可能变得相当臃肿。</p>
<p>为了解决以上问题，<code>Vuex</code> 允许我们将 <code>store</code> 分割成模块（module）。每个模块拥有自己的 <code>state</code>、<code>mutation</code>、<code>action</code>、<code>getter</code>、甚至是嵌套子模块——从上至下进行同样方式的分割：</p>
<p>1.在 <code>store</code> 文件夹下新建 <code>modules</code> 文件夹，并在下面新建 <code>moduleA.js</code> 和 <code>moduleB.js</code> 文件用来存放 <code>vuex</code> 的 <code>modules</code> 模块。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">├── components             # 组件文件夹</span><br><span class="line">    └── myButton </span><br><span class="line">        └── myButton.vue   # myButton组件</span><br><span class="line">├── pages</span><br><span class="line">    └── index </span><br><span class="line">        └── index.vue      # index页面</span><br><span class="line">├── static</span><br><span class="line">├── store</span><br><span class="line">    ├── index.js          # 我们组装模块并导出 store 的地方</span><br><span class="line">    └── modules           # 模块文件夹</span><br><span class="line">        ├── moduleA.js    # 模块moduleA</span><br><span class="line">        └── moduleB.js    # 模块moduleB</span><br><span class="line">├── App.vue</span><br><span class="line">├── main.js</span><br><span class="line">├── manifest.json</span><br><span class="line">├── pages.json</span><br><span class="line">└── uni.scss</span><br></pre></td></tr></table></figure>

<p>2.在 <code>main.js</code> 文件中引入 <code>store</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：main.<span class="property">js</span> --&gt;</span><br><span class="line">    <span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$store</span> = store</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把 store 对象提供给 “store” 选项，这可以把 store 的实例注入所有的子组件</span></span><br><span class="line">    <span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">        store,</span><br><span class="line">        ...<span class="title class_">App</span></span><br><span class="line">    &#125;)</span><br><span class="line">    app.$mount()</span><br></pre></td></tr></table></figure>

<p>3.在项目根目录下，新建 <code>store</code> 文件夹，并在下面新建 <code>index.js</code> 文件，作为模块入口，引入各子模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面路径：store/index.<span class="property">js</span> --&gt;</span><br><span class="line">    <span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> moduleA <span class="keyword">from</span> <span class="string">&#x27;@/store/modules/moduleA&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> moduleB <span class="keyword">from</span> <span class="string">&#x27;@/store/modules/moduleB&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">        <span class="attr">modules</span>:&#123;</span><br><span class="line">            moduleA,moduleB</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>4.子模块 <code>moduleA</code> 页面内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 子模块moduleA路径：store/modules/moduleA.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>:<span class="string">&quot;我是moduleA模块下state.text的值&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123; </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.子模块 <code>moduleB</code> 页面内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 子模块moduleB路径：store/modules/moduleB.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="number">1608820295</span><span class="comment">//初始时间戳</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="title function_">timeString</span>(<span class="params">state</span>) &#123;<span class="comment">//时间戳转换后的时间</span></span><br><span class="line">            <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(state.<span class="property">timestamp</span>);</span><br><span class="line">            <span class="keyword">var</span> year = date.<span class="title function_">getFullYear</span>();</span><br><span class="line">            <span class="keyword">var</span> mon  = date.<span class="title function_">getMonth</span>()+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">var</span> day  = date.<span class="title function_">getDate</span>();</span><br><span class="line">            <span class="keyword">var</span> hours = date.<span class="title function_">getHours</span>();</span><br><span class="line">            <span class="keyword">var</span> minu = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">            <span class="keyword">var</span> sec = date.<span class="title function_">getSeconds</span>();</span><br><span class="line">            <span class="keyword">var</span> trMon = mon&lt;<span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span>+mon : mon</span><br><span class="line">            <span class="keyword">var</span> trDay = day&lt;<span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span>+day : day</span><br><span class="line">            <span class="keyword">return</span> year+<span class="string">&#x27;-&#x27;</span>+trMon+<span class="string">&#x27;-&#x27;</span>+trDay+<span class="string">&quot; &quot;</span>+hours+<span class="string">&quot;:&quot;</span>+minu+<span class="string">&quot;:&quot;</span>+sec;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="title function_">updateTime</span>(<span class="params">state</span>)&#123;<span class="comment">//更新当前时间戳</span></span><br><span class="line">            state.<span class="property">timestamp</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.在页面中引用组件 myButton ，并通过 <code>mapState</code> 读取 <code>state</code> 中的初始数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面路径：pages/index/index.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;text&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>时间戳：&#123;&#123;timestamp&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>当前时间:&#123;&#123;timeString&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">myButton</span>&gt;</span><span class="tag">&lt;/<span class="name">myButton</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;mapState,mapGetters&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span> </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapState</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">text</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">moduleA</span>.<span class="property">text</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">timestamp</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">moduleB</span>.<span class="property">timestamp</span></span></span><br><span class="line"><span class="language-javascript">            &#125;),</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapGetters</span>([</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;timeString&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            ])</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>7.在组件 <code>myButton</code>中，通过 <code>mutations</code> 操作刷新当前时间。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 组件路径：components/myButton/myButton.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;updateTime&quot;</span>&gt;</span>刷新当前时间<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;mapMutations&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            ...<span class="title function_">mapMutations</span>([<span class="string">&#x27;updateTime&#x27;</span>])</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>vue是单向数据流，子组件不能直接修改父组件的数据，而通过vuex状态管理实现：把组件的共享状态抽取出来，以一个全局单例模式管理。在这种模式下，我们的组件树构成了一个巨大的“视图”，不管在树的哪个位置，任何组件都能获取状态或者触发行为！</p>
<h1 id="API条件编译"><a href="#API条件编译" class="headerlink" title="API条件编译"></a>API条件编译</h1><p>当我们在使用某些api的时候，有些api是只在某一平台才能存在，如<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/ui/menuButton?id=getmenubuttonboundingclientrect">getMenuButtonBoundingClientRect()</a><br><img src="http://doc.bufanui.com/uploads/a411524237/images/m_f2ab02ca36dafc5a15a66c5e2b890bda_r.png" alt="null"><br>那么我们在使用的时候就不能直接使用，该api的使用在h5平台及app平台会直接报错。</p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>在小程序平台获取胶囊按钮的宽度及高度。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意 下面的// 也包含在内</span></span><br><span class="line"><span class="comment">// #ifdef MP-WEIXIN</span></span><br><span class="line"><span class="keyword">var</span> val = uni.<span class="title function_">getMenuButtonBoundingClientRect</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(val.<span class="property">width</span>,val.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// #endif</span></span><br></pre></td></tr></table></figure>

<h1 id="组件的条件编译"><a href="#组件的条件编译" class="headerlink" title="组件的条件编译"></a>组件的条件编译</h1><h3 id="需求-1"><a href="#需求-1" class="headerlink" title="需求:"></a>需求:</h3><p>进入到<strong>h5页面</strong> 页面展示内容为 <strong>你好，h5</strong><br>进入到<strong>小程序页面</strong>，页面展示内容为 <strong>你好 小程序</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- #ifdef <span class="variable constant_">H5</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    你好，h5</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;!-- #endif --&gt;</span><br><span class="line">&lt;!-- #ifdef <span class="variable constant_">MP</span>-<span class="variable constant_">WEIXIN</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    仅在小程序平台展示</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;!-- #endif --&gt;</span><br></pre></td></tr></table></figure>

<h1 id="样式的条件编译"><a href="#样式的条件编译" class="headerlink" title="样式的条件编译"></a>样式的条件编译</h1><h3 id="需求-2"><a href="#需求-2" class="headerlink" title="需求:"></a>需求:</h3><p>在<strong>h5端</strong>文字颜色为<strong>红色</strong><br>在<strong>小程序端</strong>文字颜色为<strong>蓝色</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;view <span class="keyword">class</span>=<span class="string">&quot;app&quot;</span>&gt; </span><br><span class="line">    在h5端颜色为红色</span><br><span class="line">    在小程序端样式为绿色</span><br><span class="line">&lt;/view&gt;</span><br><span class="line"></span><br><span class="line">.<span class="property">app</span>&#123;</span><br><span class="line">    <span class="comment">/* #ifdef H5 */</span></span><br><span class="line">    <span class="attr">color</span>: red;</span><br><span class="line">    <span class="comment">/* #endif */</span></span><br><span class="line">    <span class="comment">/* #ifdef MP-WEIXIN */</span></span><br><span class="line">    <span class="attr">color</span>: green;</span><br><span class="line">    <span class="comment">/* #endif */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="pages-json-的条件编译"><a href="#pages-json-的条件编译" class="headerlink" title="pages.json 的条件编译"></a>pages.json 的条件编译</h1><p>下面的页面，只有运行至 App 时才会编译进去。<br><img src="http://doc.bufanui.com/uploads/a411524237/images/m_af922828621c3355f2c501a0def0cd64_r.png" alt="null"><br>不同平台下的特有功能，以及小程序平台的分包，都可以通过 pages.json 的条件编译来更好地实现。这样，就不会在其它平台产生多余的资源，进而减小包体积。</p>
<h1 id="编译到-H5-平台时的特定样式"><a href="#编译到-H5-平台时的特定样式" class="headerlink" title="编译到 H5 平台时的特定样式"></a>编译到 H5 平台时的特定样式</h1><h3 id="编译到H5平台的特定处理编译到H5平台的特定处理"><a href="#编译到H5平台的特定处理编译到H5平台的特定处理" class="headerlink" title="编译到H5平台的特定处理编译到H5平台的特定处理"></a>编译到H5平台的特定处理编译到H5平台的特定处理</h3><p>找到项目当中的page.json文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">            <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;uni-app&quot;</span>,</span><br><span class="line">                <span class="comment">// 编译到h5平台时去掉页面标题</span></span><br><span class="line">                <span class="string">&quot;h5&quot;</span>:&#123;</span><br><span class="line">                    <span class="string">&quot;titleNView&quot;</span>:<span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>保存即可发现在H5平台标题已经消失，该配置仅仅只针对h5端生效。</p>
<h1 id="自定义导航栏"><a href="#自定义导航栏" class="headerlink" title="自定义导航栏"></a>自定义导航栏</h1><h3 id="导航栏"><a href="#导航栏" class="headerlink" title="导航栏"></a>导航栏</h3><p><img src="http://doc.bufanui.com/uploads/a411524237/images/m_be2d71ad36461ea805635005b3b7eaa6_r.png" alt="null"><br>图中红框部分就是导航栏 默认不能被修改<br>如需修改的话 需要找到对应的路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">            <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;uni-app&quot;</span>,</span><br><span class="line">                <span class="comment">// 自定义导航栏</span></span><br><span class="line">                <span class="string">&quot;navigationStyle&quot;</span>:<span class="string">&quot;custom&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>加上去之后 可以发现 现在可以在手机端可以全屏编辑<br><img src="http://doc.bufanui.com/uploads/a411524237/images/m_72c54be14a0fe7771620dedb730fe4c8_r.png" alt="null"></p>
<h3 id="自定义导航栏使用注意"><a href="#自定义导航栏使用注意" class="headerlink" title="自定义导航栏使用注意"></a>自定义导航栏使用注意</h3><p>当navigationStyle设为custom或titleNView设为false时，原生导航栏不显示，此时要注意几个问题：</p>
<ul>
<li><p>非H5端，手机顶部状态栏区域会被页面内容覆盖。这是因为窗体是沉浸式的原因，即全屏可写内容。uni-app提供了状态栏高度的css变量</p>
<p>–status-bar-height</p>
<p>，如果需要把状态栏的位置从前景部分让出来，可写一个占位div，高度设为css变量。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;status_bar&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 这里是状态栏 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span>&gt;</span> 状态栏下的文字 <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.status_bar</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="built_in">var</span>(--status-bar-height);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果原生导航栏不能满足需求，推荐使用uni ui的<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?id=52">自定义导航栏NavBar</a>。这个前端导航栏自动处理了状态栏高度占位问题。</p>
</li>
<li><p>前端导航栏搭配原生下拉刷新时，会有问题，包括</p>
<ul>
<li>微信小程序下iOS需要拉更长才能看到下拉刷新的三个点，而Android是从屏幕顶部下拉，无法从导航栏下方下拉。如果一定要从前端导航栏下拉，小程序下只能放弃原生下拉刷新，纯前端模拟，参考<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?id=343">mescroll插件</a>，但这样很容易产生性能问题。目前小程序平台自身没有提供更好的方案</li>
<li>App和H5下，原生下拉刷新提供了<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-pullToRefresh">circle样式</a>，可以指定offset偏移量（pages.json的app-plus下配置），自定义下拉圈出现的位置。在hello uni-app的扩展组件中有示例。</li>
</ul>
</li>
<li><p>非H5端，前端导航盖不住原生组件。如果页面有video、map、textarea(仅小程序)等</p>
<p>原生组件</p>
<p>，滚动时会覆盖住导航栏</p>
<ul>
<li>如果是小程序下，可以使用cover-view来做导航栏，避免覆盖问题</li>
<li>如果是App下，建议使用<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-titleNView">titleNView</a>或<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-subNVues">subNVue</a>，体验更好</li>
</ul>
</li>
<li><p>前端组件在渲染速度上不如原生导航栏，原生导航可以在动画期间渲染，保证动画期间不白屏，但使用前端导航栏，在新窗体进入的动画期间可能会整页白屏，越低端的手机越明显。</p>
</li>
<li><p>以上讨论的是前端自定义导航栏，但在App侧，原生导航栏也提供了比小程序导航更丰富的自定义性</p>
<ul>
<li>titleNView：给原生导航栏提供更多配置，包括自定义按钮、滚动渐变效果、搜索框等，详见<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-titleNView">titleNView</a></li>
<li>subNView：使用nvue原生渲染，所有布局自己开发，具备一切自定义灵活度。详见<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-subNVues">subNVue</a></li>
</ul>
</li>
<li><p>页面禁用原生导航栏后，想要改变状态栏的前景字体样式，仍可设置页面的 navigationBarTextStyle 属性（只能设置为 black或white）。如果想单独设置状态栏颜色，App端可使用<a target="_blank" rel="noopener" href="http://www.html5plus.org/doc/zh_cn/navigator.html#plus.navigator.setStatusBarStyle">plus.navigator.setStatusBarStyle</a>设置。注意部分低端Android手机（4.4）自身不支持设置状态栏前景色。</p>
</li>
</ul>
<p>鉴于以上问题，在原生导航能解决业务需求的情况下，尽量使用原生导航。甚至有时需要牺牲一些不是很重要的需求。在App和H5下，uni-app提供了灵活的处理方案：<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-titleNView">titleNView</a>、<a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/pages?id=app-subNVues">subNVue</a>、或整页使用nvue。但在小程序下，因为其自身的限制，没有太好的方案。有必要的话，也可以用条件编译分端处理。</p>
<h1 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h1><h3 id="onPullDownRefresh"><a href="#onPullDownRefresh" class="headerlink" title="onPullDownRefresh"></a>onPullDownRefresh</h3><p>在 js 中定义 onPullDownRefresh 处理函数（和onLoad等生命周期函数同级），监听该页面用户下拉刷新事件。</p>
<ul>
<li>需要在 <code>pages.json</code> 里，找到的当前页面的pages节点，并在 <code>style</code> 选项中开启 <code>enablePullDownRefresh</code>。</li>
<li>当处理完数据刷新后，<code>uni.stopPullDownRefresh</code> 可以停止当前页面的下拉刷新。</li>
</ul>
<h3 id="uni-startPullDownRefresh-OBJECT"><a href="#uni-startPullDownRefresh-OBJECT" class="headerlink" title="uni.startPullDownRefresh(OBJECT)"></a>uni.startPullDownRefresh(OBJECT)</h3><p>开始下拉刷新，调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。</p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>success 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">errMsg</td>
<td align="left">String</td>
<td align="left">接口调用结果</td>
</tr>
</tbody></table>
<h3 id="uni-stopPullDownRefresh"><a href="#uni-stopPullDownRefresh" class="headerlink" title="uni.stopPullDownRefresh()"></a>uni.stopPullDownRefresh()</h3><p>停止当前页面下拉刷新。</p>
<p><strong>示例</strong></p>
<p>pages.json</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;pages&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">            <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;uni-app&quot;</span>,</span><br><span class="line">                <span class="string">&quot;enablePullDownRefresh&quot;</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;globalStyle&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;navigationBarTextStyle&quot;</span>: <span class="string">&quot;white&quot;</span>,</span><br><span class="line">        <span class="string">&quot;navigationBarBackgroundColor&quot;</span>: <span class="string">&quot;#0faeff&quot;</span>,</span><br><span class="line">        <span class="string">&quot;backgroundColor&quot;</span>: <span class="string">&quot;#fbf9fe&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 仅做示例，实际开发中延时根据需求来使用。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;uni-app&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start pulldown&#x27;</span>);</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">        uni.<span class="title function_">startPullDownRefresh</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onPullDownRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;refresh&#x27;</span>);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            uni.<span class="title function_">stopPullDownRefresh</span>();</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<ul>
<li>支付宝小程序<code>startPullDownRefresh</code>在开发者工具里会提示<code>暂未开放，请勿使用</code></li>
<li>支付宝小程序<code>startPullDownRefresh</code>请使用真机调试（非真机预览）</li>
<li>后续支付宝小程序开发工具更新可能会有所修改</li>
</ul>
<h1 id="上拉加载"><a href="#上拉加载" class="headerlink" title="上拉加载"></a>上拉加载</h1><h3 id="onReachBottom"><a href="#onReachBottom" class="headerlink" title="onReachBottom"></a>onReachBottom</h3><p>页面滚动到底部的事件（不是scroll-view滚到底），常用于下拉下一页数据。</p>
<p>onReachBottom使用注意 可在pages.json里定义具体页面底部的触发距离onReachBottomDistance，比如设为50，那么滚动页面到距离底部50px时，就会触发onReachBottom事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">            <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;uni-app&quot;</span>,</span><br><span class="line">                <span class="comment">// 页面上拉触底事件触发时距页面底部距离，单位只支持px</span></span><br><span class="line">                <span class="string">&quot;onReachBottomDistance&quot;</span>:<span class="number">100</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;find&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;per&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;item in num&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;&#123; item &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">num</span>:<span class="number">20</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">onReachBottom</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;页面滚动到底部&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="property">num</span>+=<span class="number">10</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,<span class="number">2000</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.find</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.per</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">height</span>: <span class="number">40px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">background</span>: <span class="number">#ccc</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">margin</span>: <span class="number">10px</span> auto;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//项目里的代码</span></span><br><span class="line">	<span class="attr">methods</span>: &#123;</span><br><span class="line">		<span class="keyword">async</span> <span class="title function_">getListData</span>(<span class="params"></span>)&#123;</span><br><span class="line">				<span class="keyword">const</span>&#123;<span class="attr">data</span>:res&#125; =<span class="keyword">await</span> <span class="title function_">findProductList</span>(<span class="variable language_">this</span>.<span class="property">start</span>,<span class="variable language_">this</span>.<span class="property">limit</span>,<span class="variable language_">this</span>.<span class="property">obj</span>)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">start</span>++</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>,<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">start</span>)</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;12323&quot;</span>,res)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">total</span>=res.<span class="property">data</span>.<span class="property">total</span></span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">goodsList</span>.<span class="title function_">push</span>(...res.<span class="property">data</span>.<span class="property">rows</span>);</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;数组&quot;</span>,<span class="variable language_">this</span>.<span class="property">goodsList</span>)</span><br><span class="line">				uni.<span class="title function_">stopPullDownRefresh</span>()</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			<span class="title function_">changeTab</span>(<span class="params">val</span>) &#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">current</span> = val;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">goodsList</span>=[];</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">start</span>=<span class="number">1</span></span><br><span class="line">				<span class="keyword">var</span> item = <span class="variable language_">this</span>.<span class="property">tabList</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">ele, index</span>) =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">return</span> index == val</span><br><span class="line">				&#125;)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">tabList</span>.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">ele,index</span>)&#123;</span><br><span class="line">					<span class="keyword">if</span>(val==index)&#123;</span><br><span class="line">						</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span>&#123;</span><br><span class="line">						ele.<span class="property">iconStatues</span>=<span class="string">&quot;default&quot;</span> </span><br><span class="line">					&#125;</span><br><span class="line">					</span><br><span class="line">				&#125;)</span><br><span class="line">				<span class="keyword">if</span> (item.<span class="property">iconStatues</span> == <span class="string">&#x27;default&#x27;</span>) &#123;</span><br><span class="line">					item.<span class="property">iconStatues</span> = <span class="string">&#x27;up&#x27;</span></span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">isDesc</span>=<span class="number">1</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">iconStatues</span> == <span class="string">&#x27;up&#x27;</span>)</span><br><span class="line"></span><br><span class="line">				&#123;</span><br><span class="line">					item.<span class="property">iconStatues</span> = <span class="string">&#x27;down&#x27;</span></span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">isDesc</span>=<span class="number">0</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">				&#123;</span><br><span class="line">                     item.<span class="property">iconStatues</span> = <span class="string">&#x27;up&#x27;</span></span><br><span class="line">					 <span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">isDesc</span>=<span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(val==<span class="number">1</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">sortBy</span>=<span class="string">&quot;sale&quot;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(val==<span class="number">2</span>)&#123;</span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">sortBy</span>=<span class="string">&quot;price&quot;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="title function_">getListData</span>()</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">components</span>:&#123;</span><br><span class="line">			<span class="title class_">Good</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">			<span class="comment">// console.log(&quot;32423&quot;,options)</span></span><br><span class="line">			<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">categoryId</span>=options.<span class="property">id</span></span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">getListData</span>()</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">onReachBottom</span>(<span class="params"></span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">goodsList</span>.<span class="property">length</span>&lt;<span class="variable language_">this</span>.<span class="property">total</span>)&#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="title function_">getListData</span>()</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">onPullDownRefresh</span>(<span class="params"></span>)&#123;</span><br><span class="line">			<span class="variable language_">this</span>.<span class="property">obj</span>.<span class="property">start</span>=<span class="number">1</span>;</span><br><span class="line">			<span class="variable language_">this</span>.<span class="property">goodsList</span>=[]</span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">getListData</span>()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="uni页面间跳转"><a href="#uni页面间跳转" class="headerlink" title="uni页面间跳转"></a>uni页面间跳转</h1><h1 id="navigateto"><a href="#navigateto" class="headerlink" title="navigateto"></a>navigateto</h1><h4 id="uni-navigateTo-OBJECT"><a href="#uni-navigateTo-OBJECT" class="headerlink" title="uni.navigateTo(OBJECT)"></a>uni.navigateTo(OBJECT)</h4><p>触发入栈操作<br>保留当前页面，跳转到应用内的某个页面，使用<code>uni.navigateBack</code>可以返回到原页面。</p>
<p><strong>OBJECT参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">默认值</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left"></td>
<td align="left">需要跳转的应用内非 tabBar 的页面的路径 , 路径后可以带参数。参数与路径之间使用?分隔，参数键与参数值用&#x3D;相连，不同参数用&amp;分隔；如 ‘path?key&#x3D;value&amp;key2&#x3D;value2’，path为下一个页面的路径，下一个页面的onLoad函数可得到传递的参数</td>
<td align="left">:-</td>
</tr>
<tr>
<td align="left">animationType</td>
<td align="left">String</td>
<td align="left">否</td>
<td align="left">pop-in</td>
<td align="left">窗口显示的动画效果，详见：<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/router?id=animation">窗口动画</a></td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">animationDuration</td>
<td align="left">Number</td>
<td align="left">否</td>
<td align="left">300</td>
<td align="left">窗口动画持续时间，单位为 ms</td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">events</td>
<td align="left">Object</td>
<td align="left">否</td>
<td align="left"></td>
<td align="left">页面间通信接口，用于监听被打开页面发送到当前页面的数据。2.8.9+ 开始支持。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left"></td>
<td align="left">接口调用成功的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left"></td>
<td align="left">接口调用失败的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left"></td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>object.success 回调函数</strong></p>
<p><strong>参数</strong></p>
<p><strong>Object res</strong></p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">eventChannel</td>
<td align="left"><a target="_blank" rel="noopener" href="http://doc.bufanui.com/docs/a411524237/api/router?id=event-channel">EventChannel</a></td>
<td align="left">和被打开页面进行通信</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在起始页面跳转到test.vue页面并传递参数</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;test?id=1&amp;name=uniapp&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 在test.vue页面接受参数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">option</span>) &#123; <span class="comment">//option为object类型，会序列化上个页面传递的参数</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(option.<span class="property">id</span>); <span class="comment">//打印出上个页面传递的参数。</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(option.<span class="property">name</span>); <span class="comment">//打印出上个页面传递的参数。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="redirectto"><a href="#redirectto" class="headerlink" title="redirectto"></a>redirectto</h1><h4 id="uni-redirectTo-OBJECT"><a href="#uni-redirectTo-OBJECT" class="headerlink" title="uni.redirectTo(OBJECT)"></a>uni.redirectTo(OBJECT)</h4><p>当前页面出栈 跳转之后的页面入栈<br>关闭当前页面，跳转到应用内的某个页面。(适用于登录后跳转到别的页面)</p>
<p><strong>OBJECT参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">需要跳转的应用内非 tabBar 的页面的路径，路径后可以带参数。参数与路径之间使用?分隔，参数键与参数值用&#x3D;相连，不同参数用&amp;分隔；如 ‘path?key&#x3D;value&amp;key2&#x3D;value2’</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">redirectTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;test?id=1&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li>跳转到 tabBar 页面只能使用 switchTab 跳转</li>
</ul>
<h1 id="relaunch"><a href="#relaunch" class="headerlink" title="relaunch"></a>relaunch</h1><h4 id="uni-reLaunch-OBJECT"><a href="#uni-reLaunch-OBJECT" class="headerlink" title="uni.reLaunch(OBJECT)"></a>uni.reLaunch(OBJECT)</h4><p>页面全部出栈，只留下新的页面<br>关闭所有页面，打开到应用内的某个页面。</p>
<p><strong>OBJECT参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">需要跳转的应用内页面路径 , 路径后可以带参数。参数与路径之间使用?分隔，参数键与参数值用&#x3D;相连，不同参数用&amp;分隔；如 ‘path?key&#x3D;value&amp;key2&#x3D;value2’，如果跳转的页面路径是 tabBar 页面则不能带参数</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;test?id=1&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">option</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(option.<span class="property">id</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Tips：</p>
<ul>
<li>H5端调用<code>uni.reLaunch</code>之后之前页面栈会销毁，但是无法清空浏览器之前的历史记录，此时<code>navigateBack</code>不能返回，如果存在历史记录的话点击浏览器的返回按钮或者调用<code>history.back()</code>仍然可以导航到浏览器的其他历史记录。</li>
</ul>
<h1 id="switchTab"><a href="#switchTab" class="headerlink" title="switchTab"></a>switchTab</h1><h4 id="uni-switchTab-OBJECT"><a href="#uni-switchTab-OBJECT" class="headerlink" title="uni.switchTab(OBJECT)"></a>uni.switchTab(OBJECT)</h4><p>跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面。</p>
<p><strong>OBJECT参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">需要跳转的 tabBar 页面的路径（需在 pages.json 的 tabBar 字段定义的页面），路径后不能带参数</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<p>pages.json</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tabBar&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;list&quot;</span>: [&#123;</span><br><span class="line">      <span class="string">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">      <span class="string">&quot;text&quot;</span>: <span class="string">&quot;首页&quot;</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      <span class="string">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/other/other&quot;</span>,</span><br><span class="line">      <span class="string">&quot;text&quot;</span>: <span class="string">&quot;其他&quot;</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>other.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="navigateBack"><a href="#navigateBack" class="headerlink" title="navigateBack"></a>navigateBack</h1><h4 id="uni-navigateBack-OBJECT"><a href="#uni-navigateBack-OBJECT" class="headerlink" title="uni.navigateBack(OBJECT)"></a>uni.navigateBack(OBJECT)</h4><p>关闭当前页面，返回上一页面或多级页面。可通过 <code>getCurrentPages()</code> 获取当前的页面栈，决定需要返回几层。</p>
<p><strong>OBJECT参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">默认值</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">delta</td>
<td align="left">Number</td>
<td align="left">否</td>
<td align="left">1</td>
<td align="left">返回的页面数，如果 delta 大于现有页面数，则返回到首页。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">animationType</td>
<td align="left">String</td>
<td align="left">否</td>
<td align="left">pop-out</td>
<td align="left">窗口关闭的动画效果，详见：<a target="_blank" rel="noopener" href="http://doc.bufanui.com/docs/a411524237/api/router?id=animation">窗口动画</a></td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">animationDuration</td>
<td align="left">Number</td>
<td align="left">否</td>
<td align="left">300</td>
<td align="left">窗口关闭动画的持续时间，单位为 ms</td>
<td align="left">App</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：调用 navigateTo 跳转时，调用该方法的页面会被加入堆栈，而 redirectTo 方法则不会。见下方示例代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处是A页面</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;B?id=1&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处是B页面</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;C?id=1&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在C页面内 navigateBack，将返回A页面</span></span><br><span class="line">uni.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">    <span class="attr">delta</span>: <span class="number">2</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="组件跳转"><a href="#组件跳转" class="headerlink" title="组件跳转"></a>组件跳转</h1><h4 id="navigator"><a href="#navigator" class="headerlink" title="navigator"></a>navigator</h4><p>页面跳转。</p>
<p>该组件类似HTML中的&#96;&#96;组件，但只能跳转本地页面。目标页面必须在pages.json中注册。</p>
<p>该组件的功能有API方式，另见：<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/router?id=navigateto">https://uniapp.dcloud.io/api/router?id=navigateto</a></p>
<p><strong>属性说明</strong></p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">类型</th>
<th align="left">默认值</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left"></td>
<td align="left">应用内的跳转链接，值为相对路径或绝对路径，如：”..&#x2F;first&#x2F;first”，”&#x2F;pages&#x2F;first&#x2F;first”，注意不能加 <code>.vue</code> 后缀</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">open-type</td>
<td align="left">String</td>
<td align="left">navigate</td>
<td align="left">跳转方式</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">delta</td>
<td align="left">Number</td>
<td align="left"></td>
<td align="left">当 open-type 为 ‘navigateBack’ 时有效，表示回退的层数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">animation-type</td>
<td align="left">String</td>
<td align="left">pop-in&#x2F;out</td>
<td align="left">当 open-type 为 navigate、navigateBack 时有效，窗口的显示&#x2F;关闭动画效果，详见：<a target="_blank" rel="noopener" href="http://doc.bufanui.com/docs/a411524237/api/router?id=animation">窗口动画</a></td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">animation-duration</td>
<td align="left">Number</td>
<td align="left">300</td>
<td align="left">当 open-type 为 navigate、navigateBack 时有效，窗口显示&#x2F;关闭动画的持续时间。</td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">hover-class</td>
<td align="left">String</td>
<td align="left">navigator-hover</td>
<td align="left">指定点击时的样式类，当hover-class&#x3D;”none”时，没有点击态效果</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">hover-stop-propagation</td>
<td align="left">Boolean</td>
<td align="left">false</td>
<td align="left">指定是否阻止本节点的祖先节点出现点击态</td>
<td align="left">微信小程序</td>
</tr>
<tr>
<td align="left">hover-start-time</td>
<td align="left">Number</td>
<td align="left">50</td>
<td align="left">按住后多久出现点击态，单位毫秒</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">hover-stay-time</td>
<td align="left">Number</td>
<td align="left">600</td>
<td align="left">手指松开后点击态保留时间，单位毫秒</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">target</td>
<td align="left">String</td>
<td align="left">self</td>
<td align="left">在哪个小程序目标上发生跳转，默认当前小程序，值域self&#x2F;miniProgram</td>
<td align="left">微信2.0.7+、百度2.5.2+、QQ</td>
</tr>
</tbody></table>
<p><strong>open-type 有效值</strong></p>
<table>
<thead>
<tr>
<th align="left">值</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">navigate</td>
<td align="left">对应 uni.navigateTo 的功能</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">redirect</td>
<td align="left">对应 uni.redirectTo 的功能</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">switchTab</td>
<td align="left">对应 uni.switchTab 的功能</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">reLaunch</td>
<td align="left">对应 uni.reLaunch 的功能</td>
<td align="left">字节跳动小程序不支持</td>
</tr>
<tr>
<td align="left">navigateBack</td>
<td align="left">对应 uni.navigateBack 的功能</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">exit</td>
<td align="left">退出小程序，target&#x3D;”miniProgram”时生效</td>
<td align="left">微信2.1.0+、百度2.5.2+、QQ1.4.7+</td>
</tr>
</tbody></table>
<p><strong>注意</strong></p>
<ul>
<li>跳转tabbar页面，必须设置open-type&#x3D;”switchTab”</li>
<li>navigator-hover 默认为 {background-color: rgba(0, 0, 0, 0.1); opacity: 0.7;}, &#96;&#96; 的子节点背景色应为透明色。</li>
<li>app-nvue 平台只有纯nvue项目（render为native）才支持 &#96;&#96;。非render为native的情况下，nvue暂不支持navigator组件，请使用API跳转。</li>
<li>app下退出应用，Android平台可以使用<a target="_blank" rel="noopener" href="https://www.html5plus.org/doc/zh_cn/runtime.html#plus.runtime.quit">plus.runtime.quit</a>。iOS没有退出应用的概念。</li>
<li>如果想实现web外链跳转，可参考<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?id=1182">uLink组件</a></li>
</ul>
<p><strong>示例</strong> <a target="_blank" rel="noopener" href="https://hellouniapp.dcloud.net.cn/pages/component/navigator/navigator">查看示例</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-body&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn-area&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;navigate/navigate?title=navigate&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;navigator-hover&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>&gt;</span>跳转到新页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;redirect/redirect?title=redirect&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;redirect&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;other-navigator-hover&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>&gt;</span>在当前页打开<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;/pages/tabBar/extUI/extUI&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;switchTab&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;other-navigator-hover&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>&gt;</span>跳转tab页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">// navigate.vue页面接受参数</span><br><span class="line">export default &#123;</span><br><span class="line">    onLoad: function (option) &#123; //option为object类型，会序列化上个页面传递的参数</span><br><span class="line">        console.log(option.id); //打印出上个页面传递的参数。</span><br><span class="line">        console.log(option.name); //打印出上个页面传递的参数。</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>url有长度限制，太长的字符串会传递失败，可使用<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/frame/communication">窗体通信</a>、<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35021">全局变量</a>，或<code>encodeURIComponent</code>等多种方式解决，如下为<code>encodeURIComponent</code>示例。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigator</span> <span class="attr">:url</span>=<span class="string">&quot;&#x27;/pages/navigate/navigate?item=&#x27;+ encodeURIComponent(JSON.stringify(item))&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">// navigate.vue页面接受参数</span><br><span class="line">onLoad: function (option) &#123;</span><br><span class="line">    const item = JSON.parse(decodeURIComponent(option.item));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="本地选取资源"><a href="#本地选取资源" class="headerlink" title="本地选取资源"></a>本地选取资源</h1><h3 id="uni-chooseImage-OBJECT"><a href="#uni-chooseImage-OBJECT" class="headerlink" title="uni.chooseImage(OBJECT)"></a>uni.chooseImage(OBJECT)</h3><p>从本地相册选择图片或使用相机拍照。</p>
<p>App端如需要更丰富的相机拍照API（如直接调用前置摄像头），参考<a target="_blank" rel="noopener" href="https://www.html5plus.org/doc/zh_cn/camera.html">plus.camera</a></p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">count</td>
<td align="left">Number</td>
<td align="left">否</td>
<td align="left">最多可以选择的图片张数，默认9</td>
<td align="left">见下方说明</td>
</tr>
<tr>
<td align="left">sizeType</td>
<td align="left">Array<String></td>
<td align="left">否</td>
<td align="left">original 原图，compressed 压缩图，默认二者都有</td>
<td align="left">App、微信小程序、支付宝小程序、百度小程序</td>
</tr>
<tr>
<td align="left">extension</td>
<td align="left">Array<String></td>
<td align="left">否</td>
<td align="left">根据文件拓展名过滤，每一项都不能是空字符串。默认不过滤。</td>
<td align="left">H5(HBuilder X2.9.9+)</td>
</tr>
<tr>
<td align="left">sourceType</td>
<td align="left">Array<String></td>
<td align="left">否</td>
<td align="left">album 从相册选图，camera 使用相机，默认二者都有。如需直接开相机或直接选相册，请只使用一个选项</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">是</td>
<td align="left">成功则返回图片的本地文件路径列表 tempFilePaths</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
<td align="left">小程序、App</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>Tips</strong></p>
<ul>
<li>count 值在 H5 平台的表现，基于浏览器本身的规范。目前测试的结果来看，只能限制单选&#x2F;多选，并不能限制数量。并且，在实际的手机浏览器很少有能够支持多选的。</li>
<li>sourceType 在H5端对应<code>input</code>的<code>capture</code>属性，设置为<code>[&#39;album&#39;]</code>无效，依然可以使用相机。</li>
<li>可以通过用户授权API来判断用户是否给应用授予相册或摄像头的访问权限<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/other/authorize">https://uniapp.dcloud.io/api/other/authorize</a></li>
<li>App端如需选择非媒体文件，可在插件市场搜索<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/search?q=%E6%96%87%E4%BB%B6%E9%80%89%E6%8B%A9">文件选择</a>，其中Android端可以使用Native.js，无需原生插件，而iOS端需要原生插件。</li>
</ul>
<p><strong>注：文件的临时路径，在应用本次启动期间可以正常使用，如需持久保存，需在主动调用 <a target="_blank" rel="noopener" href="http://doc.bufanui.com/docs/a411524237/api/file/file?id=savefile">uni.saveFile</a>，在应用下次启动时才能访问得到。</strong></p>
<p><strong>success 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">tempFilePaths</td>
<td align="left">Array<String></td>
<td align="left">图片的本地文件路径列表</td>
</tr>
<tr>
<td align="left">tempFiles</td>
<td align="left">Array<Object>、Array<File></td>
<td align="left">图片的本地文件列表，每一项是一个 File 对象</td>
</tr>
</tbody></table>
<p><strong>File 对象结构如下</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">path</td>
<td align="left">String</td>
<td align="left">本地文件路径</td>
</tr>
<tr>
<td align="left">size</td>
<td align="left">Number</td>
<td align="left">本地文件大小，单位：B</td>
</tr>
<tr>
<td align="left">name</td>
<td align="left">String</td>
<td align="left">包含扩展名的文件名称，仅H5支持</td>
</tr>
<tr>
<td align="left">type</td>
<td align="left">String</td>
<td align="left">文件类型，仅H5支持</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">6</span>, <span class="comment">//默认9</span></span><br><span class="line">    <span class="attr">sizeType</span>: [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>], <span class="comment">//可以指定是原图还是压缩图，默认二者都有</span></span><br><span class="line">    <span class="attr">sourceType</span>: [<span class="string">&#x27;album&#x27;</span>], <span class="comment">//从相册选择</span></span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">tempFilePaths</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="uni-previewImage-OBJECT-unipreviewimageobject"><a href="#uni-previewImage-OBJECT-unipreviewimageobject" class="headerlink" title="uni.previewImage(OBJECT) @unipreviewimageobject"></a>uni.previewImage(OBJECT) <a target="_blank" rel="noopener" href="https://github.com/unipreviewimageobject">@unipreviewimageobject</a></h3><p>预览图片。</p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">current</td>
<td align="left">String&#x2F;Number</td>
<td align="left">详见下方说明</td>
<td align="left">详见下方说明</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">urls</td>
<td align="left">Array<String></td>
<td align="left">是</td>
<td align="left">需要预览的图片链接列表</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">indicator</td>
<td align="left">String</td>
<td align="left">否</td>
<td align="left">图片指示器样式，可取值：”default” - 底部圆点指示器； “number” - 顶部数字指示器； “none” - 不显示指示器。</td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">loop</td>
<td align="left">Boolean</td>
<td align="left">否</td>
<td align="left">是否可循环预览，默认值为 false</td>
<td align="left">App</td>
</tr>
<tr>
<td align="left">longPressActions</td>
<td align="left">Object</td>
<td align="left">否</td>
<td align="left">长按图片显示操作菜单，如不填默认为<strong>保存相册</strong></td>
<td align="left">App 1.9.5+</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>current 参数说明</strong></p>
<blockquote>
<p>1.9.5+ 支持传图片在 urls 中的索引值</p>
</blockquote>
<p>current 为当前显示图片的链接&#x2F;索引值，不填或填写的值无效则为 urls 的第一张。<strong>App平台在 1.9.5至1.9.8之间，current为必填。不填会报错</strong></p>
<p>注意，当 urls 中有重复的图片链接时：</p>
<ul>
<li>传链接，预览结果始终显示该链接在 urls 中第一次出现的位置。</li>
<li>传索引值，在微信&#x2F;百度&#x2F;字节跳动小程序平台，会过滤掉传入的 urls 中该索引值之前与其对应图片链接重复的值。其它平台会保留原始的 urls 不会做去重处理。</li>
</ul>
<p>举例说明：</p>
<p>一组图片 <code>[A, B1, C, B2, D]</code>，其中 B1 与 B2 的图片链接是一样的。</p>
<ul>
<li>传 B2 的链接，预览的结果是 B1，前一张是 A，下一张是 C。</li>
<li>传 B2 的索引值 3，预览的结果是 B2，前一张是 C，下一张是 D。此时在微信&#x2F;百度&#x2F;字节跳动小程序平台，最终传入的 urls 是 <code>[A, C, B2, D]</code>，过滤掉了与 B2 重复的 B1。</li>
</ul>
<p><strong>longPressActions 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">itemList</td>
<td align="left">Array<String></td>
<td align="left">是</td>
<td align="left">按钮的文字数组</td>
</tr>
<tr>
<td align="left">itemColor</td>
<td align="left">String</td>
<td align="left">否</td>
<td align="left">按钮的文字颜色，字符串格式，默认为”#000000”</td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数，详见返回参数说明</td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
</tr>
</tbody></table>
<p><strong>success 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">index</td>
<td align="left">Number</td>
<td align="left">用户长按图片的索引值</td>
</tr>
<tr>
<td align="left">tapIndex</td>
<td align="left">Number</td>
<td align="left">用户点击按钮列表的索引值</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从相册选择6张图</span></span><br><span class="line">uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="attr">sizeType</span>: [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>],</span><br><span class="line">    <span class="attr">sourceType</span>: [<span class="string">&#x27;album&#x27;</span>],</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="comment">// 预览图片</span></span><br><span class="line">        uni.<span class="title function_">previewImage</span>(&#123;</span><br><span class="line">            <span class="attr">urls</span>: res.<span class="property">tempFilePaths</span>,</span><br><span class="line">            <span class="attr">longPressActions</span>: &#123;</span><br><span class="line">                <span class="attr">itemList</span>: [<span class="string">&#x27;发送给朋友&#x27;</span>, <span class="string">&#x27;保存图片&#x27;</span>, <span class="string">&#x27;收藏&#x27;</span>],</span><br><span class="line">                <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;选中了第&#x27;</span> + (data.<span class="property">tapIndex</span> + <span class="number">1</span>) + <span class="string">&#x27;个按钮,第&#x27;</span> + (data.<span class="property">index</span> + <span class="number">1</span>) + <span class="string">&#x27;张图片&#x27;</span>);</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">errMsg</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>TIPS</strong></p>
<ul>
<li>在非H5端，previewImage是原生实现的，界面自定义灵活度较低。</li>
<li>插件市场有前端实现的previewImage，性能低于原生实现，但界面可随意定义；插件市场也有适于App端的previewImage原生插件，提供了更多功能。</li>
</ul>
<h1 id="上传资源"><a href="#上传资源" class="headerlink" title="上传资源"></a>上传资源</h1><h3 id="uni-uploadFile-OBJECT"><a href="#uni-uploadFile-OBJECT" class="headerlink" title="uni.uploadFile(OBJECT)"></a>uni.uploadFile(OBJECT)</h3><p>将本地资源上传到开发者服务器，客户端发起一个 <code>POST</code> 请求，其中 <code>content-type</code> 为 <code>multipart/form-data</code>。<br>如页面通过 <a target="_blank" rel="noopener" href="http://doc.bufanui.com/docs/a411524237/api/media/image?id=chooseimage">uni.chooseImage</a> 等接口获取到一个本地资源的临时文件路径后，可通过此接口将本地资源上传到指定服务器。另外选择和上传非图像、视频文件参考：<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35547%E3%80%82">https://ask.dcloud.net.cn/article/35547。</a></p>
<blockquote>
<p>在各个小程序平台运行时，网络相关的 API 在使用前需要配置域名白名单。</p>
</blockquote>
<p><strong>推荐开发者使用更好的API<code>uniCloud.uploadFile</code>，uniCloud提供了免费CDN和更好的易用性，包括安全的cdn直传。详见：<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/uniCloud/storage?id=uploadfile">https://uniapp.dcloud.io/uniCloud/storage?id=uploadfile</a></strong></p>
<p><strong>OBJECT 参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
<th align="left">平台差异说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">url</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">开发者服务器 url</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">files</td>
<td align="left">Array</td>
<td align="left">否</td>
<td align="left">需要上传的文件列表。<strong>使用 files 时，filePath 和 name 不生效。</strong></td>
<td align="left">App、H5（ 2.6.15+）</td>
</tr>
<tr>
<td align="left">fileType</td>
<td align="left">String</td>
<td align="left">见平台差异说明</td>
<td align="left">文件类型，image&#x2F;video&#x2F;audio</td>
<td align="left">仅支付宝小程序，且必填。</td>
</tr>
<tr>
<td align="left">file</td>
<td align="left">File</td>
<td align="left">否</td>
<td align="left">要上传的文件对象。</td>
<td align="left">仅H5（2.6.15+）支持</td>
</tr>
<tr>
<td align="left">filePath</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">要上传文件资源的路径。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">name</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">文件对应的 key , 开发者在服务器端通过这个 key 可以获取到文件二进制内容</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">header</td>
<td align="left">Object</td>
<td align="left">否</td>
<td align="left">HTTP 请求 Header, header 中不能设置 Referer。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">timeout</td>
<td align="left">Number</td>
<td align="left">否</td>
<td align="left">超时时间，单位 ms</td>
<td align="left">H5(HBuilderX 2.9.9+)、APP(HBuilderX 2.9.9+)</td>
</tr>
<tr>
<td align="left">formData</td>
<td align="left">Object</td>
<td align="left">否</td>
<td align="left">HTTP 请求中其他额外的 form data</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">success</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用成功的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">fail</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用失败的回调函数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">Function</td>
<td align="left">否</td>
<td align="left">接口调用结束的回调函数（调用成功、失败都会执行）</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>注意</strong>：</p>
<ul>
<li>App支持多文件上传，微信小程序只支持单文件上传，传多个文件需要反复调用本API。所以跨端的写法就是循环调用本API。</li>
<li>hello uni-app中的客服反馈，支持多图上传。<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/">uni-app插件市场</a>中也有多个封装的组件。</li>
<li>App平台选择和上传非图像、视频文件，参考<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35547">https://ask.dcloud.net.cn/article/35547</a></li>
<li>网络请求的 <code>超时时间</code> 可以统一在 <code>manifest.json</code> 中配置 <a target="_blank" rel="noopener" href="http://doc.bufanui.com/collocation/manifest?id=networktimeout">networkTimeout</a>。</li>
<li>支付宝小程序开发工具上传文件返回的http状态码为字符串形式，支付宝小程序真机返回的状态码为数字形式</li>
</ul>
<p><strong>files参数说明</strong></p>
<p>files 参数是一个 file 对象的数组，file 对象的结构如下：</p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">必填</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">name</td>
<td align="left">String</td>
<td align="left">否</td>
<td align="left">multipart 提交时，表单的项目名，默认为 file</td>
</tr>
<tr>
<td align="left">file</td>
<td align="left">File</td>
<td align="left">否</td>
<td align="left">要上传的文件对象，仅H5（2.6.15+）支持</td>
</tr>
<tr>
<td align="left">uri</td>
<td align="left">String</td>
<td align="left">是</td>
<td align="left">文件的本地地址</td>
</tr>
</tbody></table>
<p>Tip:</p>
<ul>
<li>如果 <code>name</code> 不填或填的值相同，可能导致服务端读取文件时只能读取到一个文件。</li>
</ul>
<p><strong>success 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">data</td>
<td align="left">String</td>
<td align="left">开发者服务器返回的数据</td>
</tr>
<tr>
<td align="left">statusCode</td>
<td align="left">Number</td>
<td align="left">开发者服务器返回的 HTTP 状态码</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">chooseImageRes</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> tempFilePaths = chooseImageRes.<span class="property">tempFilePaths</span>;</span><br><span class="line">        uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;https://www.example.com/upload&#x27;</span>, <span class="comment">//仅为示例，非真实的接口地址</span></span><br><span class="line">            <span class="attr">filePath</span>: tempFilePaths[<span class="number">0</span>],</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">            <span class="attr">formData</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;test&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">uploadFileRes</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(uploadFileRes.<span class="property">data</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>返回值</strong></p>
<p>如果希望返回一个 <code>uploadTask</code> 对象，需要至少传入 success &#x2F; fail &#x2F; complete 参数中的一个。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uploadTask = uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://www.example.com/upload&#x27;</span>, <span class="comment">//仅为示例，并非真实接口地址。</span></span><br><span class="line">    <span class="attr">complete</span>: <span class="function">()=&gt;</span> &#123;&#125;</span><br><span class="line">&#125;);</span><br><span class="line">uploadTask.<span class="title function_">abort</span>();</span><br></pre></td></tr></table></figure>

<p>如果没有传入 success &#x2F; fail &#x2F; complete 参数，则会返回封装后的 Promise 对象：<a target="_blank" rel="noopener" href="http://doc.bufanui.com/api/README?id=promise-%E5%B0%81%E8%A3%85">Promise 封装</a></p>
<p>通过 <code>uploadTask</code>，可监听上传进度变化事件，以及取消上传任务。</p>
<p><strong>uploadTask 对象的方法列表</strong></p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">abort</td>
<td align="left"></td>
<td align="left">中断上传任务</td>
</tr>
<tr>
<td align="left">onProgressUpdate</td>
<td align="left">callback</td>
<td align="left">监听上传进度变化</td>
</tr>
<tr>
<td align="left">onHeadersReceived</td>
<td align="left">callback</td>
<td align="left">监听 HTTP Response Header 事件。会比请求完成事件更早,仅<code>微信小程序平台</code>支持，<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/UploadTask.onHeadersReceived.html">规范详情</a></td>
</tr>
<tr>
<td align="left">offProgressUpdate</td>
<td align="left">callback</td>
<td align="left">取消监听上传进度变化事件，仅<code>微信小程序平台</code>支持，<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/UploadTask.offProgressUpdate.html">规范详情</a></td>
</tr>
<tr>
<td align="left">offHeadersReceived</td>
<td align="left">callback</td>
<td align="left">取消监听 HTTP Response Header 事件，仅<code>微信小程序平台</code>支持，<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/UploadTask.offHeadersReceived.html">规范详情</a></td>
</tr>
</tbody></table>
<p><strong>onProgressUpdate 返回参数说明</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">progress</td>
<td align="left">Number</td>
<td align="left">上传进度百分比</td>
</tr>
<tr>
<td align="left">totalBytesSent</td>
<td align="left">Number</td>
<td align="left">已经上传的数据长度，单位 Bytes</td>
</tr>
<tr>
<td align="left">totalBytesExpectedToSend</td>
<td align="left">Number</td>
<td align="left">预期需要上传的数据总长度，单位 Bytes</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">chooseImageRes</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> tempFilePaths = chooseImageRes.<span class="property">tempFilePaths</span>;</span><br><span class="line">        <span class="keyword">const</span> uploadTask = uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;https://www.example.com/upload&#x27;</span>, <span class="comment">//仅为示例，非真实的接口地址</span></span><br><span class="line">            <span class="attr">filePath</span>: tempFilePaths[<span class="number">0</span>],</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">            <span class="attr">formData</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;test&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">uploadFileRes</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(uploadFileRes.<span class="property">data</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        uploadTask.<span class="title function_">onProgressUpdate</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;上传进度&#x27;</span> + res.<span class="property">progress</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;已经上传的数据长度&#x27;</span> + res.<span class="property">totalBytesSent</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;预期需要上传的数据总长度&#x27;</span> + res.<span class="property">totalBytesExpectedToSend</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 测试条件，取消上传任务。</span></span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">progress</span> &gt; <span class="number">50</span>) &#123;</span><br><span class="line">                uploadTask.<span class="title function_">abort</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//项目中的实例代码</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">			<span class="comment">//提交退款</span></span><br><span class="line">			<span class="title function_">upload</span>(<span class="params"></span>) &#123;</span><br><span class="line">				<span class="keyword">var</span> _this=<span class="variable language_">this</span></span><br><span class="line">				<span class="keyword">var</span> arr = []</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">imgList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">ele</span> =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">var</span> pro = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, rejected</span>) =&gt;</span> &#123;</span><br><span class="line">						uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">							<span class="attr">url</span>: baserUrl + <span class="string">&quot;/lejuClient/orderReturn/uploadImg&quot;</span>,</span><br><span class="line">							<span class="attr">filePath</span>: ele,</span><br><span class="line">							<span class="attr">name</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">							<span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">								<span class="title function_">resolve</span>(res)</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;)</span><br><span class="line">					&#125;)</span><br><span class="line">					arr.<span class="title function_">push</span>(pro)</span><br><span class="line">				&#125;)</span><br><span class="line">				<span class="title class_">Promise</span>.<span class="title function_">all</span>(arr).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;上传成功&quot;</span>, res)</span><br><span class="line">					res.<span class="title function_">forEach</span>(<span class="function"><span class="params">ele</span>=&gt;</span>&#123;</span><br><span class="line">						ele.<span class="property">data</span>=<span class="title class_">JSON</span>.<span class="title function_">parse</span>(ele.<span class="property">data</span>)</span><br><span class="line">					&#125;)</span><br><span class="line">					<span class="variable language_">this</span>.<span class="property">imgss</span>=res.<span class="title function_">map</span>(<span class="function"><span class="params">ele</span>=&gt;</span>ele.<span class="property">data</span>.<span class="property">data</span>.<span class="property">fileUrl</span>)</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;imgs&quot;</span>,imgss)</span><br><span class="line">				&#125;)</span><br><span class="line">				<span class="keyword">var</span> obj=&#123;</span><br><span class="line">					<span class="string">&quot;companyAddressId&quot;</span>: <span class="string">&quot;1380488405939507202&quot;</span>,</span><br><span class="line">					<span class="string">&quot;count&quot;</span>: <span class="variable language_">this</span>.<span class="property">goodsItem</span>.<span class="property">productQuantity</span>,</span><br><span class="line">					<span class="string">&quot;description&quot;</span>: <span class="variable language_">this</span>.<span class="property">questionDes</span>,</span><br><span class="line">					<span class="string">&quot;orderId&quot;</span>: <span class="variable language_">this</span>.<span class="property">goodsItem</span>.<span class="property">orderId</span>,</span><br><span class="line">					<span class="string">&quot;orderItemId&quot;</span>: <span class="variable language_">this</span>.<span class="property">goodsItem</span>.<span class="property">id</span>,</span><br><span class="line">					<span class="string">&quot;proofPics&quot;</span>:<span class="variable language_">this</span>.<span class="property">imgss</span>.<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>) ,</span><br><span class="line">					<span class="string">&quot;reason&quot;</span>: <span class="variable language_">this</span>.<span class="property">reason</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="title function_">addOrderReturnApply</span>(obj).<span class="title function_">then</span>(<span class="function"><span class="params">returnRes</span>=&gt;</span>&#123;</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;退货&quot;</span>,returnRes)</span><br><span class="line">					uni.<span class="title function_">redirectTo</span>(&#123;</span><br><span class="line">						<span class="attr">url</span>: <span class="string">`/pages/my/orders/orders?type=4`</span></span><br><span class="line">					&#125;);</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="title function_">cancelImg</span>(<span class="params">index</span>) &#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">imgList</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="title function_">upimg</span>(<span class="params"></span>) &#123;</span><br><span class="line">				<span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">				uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">					<span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">						<span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">						<span class="keyword">var</span> imgs = res.<span class="property">tempFilePaths</span>;</span><br><span class="line">						<span class="comment">// _this.imgList=res.tempFilePaths;</span></span><br><span class="line">						<span class="keyword">if</span> (imgs &gt;= <span class="number">4</span>) &#123;</span><br><span class="line">							uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">								<span class="attr">title</span>: <span class="string">&quot;一次最多只能选取3张&quot;</span></span><br><span class="line">							&#125;)</span><br><span class="line">							<span class="keyword">return</span></span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">if</span> (_this.<span class="property">imgList</span>.<span class="property">length</span> + imgs.<span class="property">length</span> &gt;= <span class="number">4</span>) &#123;</span><br><span class="line">							uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">								<span class="attr">title</span>: <span class="string">&quot;总共最多只能选取3张&quot;</span></span><br><span class="line">							&#125;)</span><br><span class="line">							<span class="keyword">return</span></span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">var</span> img = res.<span class="property">tempFilePaths</span>.<span class="title function_">find</span>(<span class="function"><span class="params">ele</span> =&gt;</span> ele.<span class="property">size</span> / <span class="number">1024</span> / <span class="number">1024</span> &gt; <span class="number">1</span>);</span><br><span class="line">						<span class="keyword">if</span> (img) &#123;</span><br><span class="line">							uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">								<span class="attr">title</span>: <span class="string">&quot;选取得图片尺寸大于1m，请重新上传&quot;</span></span><br><span class="line">							&#125;)</span><br><span class="line">							<span class="keyword">return</span></span><br><span class="line">						&#125;;</span><br><span class="line">						_this.<span class="property">imgList</span>.<span class="title function_">push</span>(...res.<span class="property">tempFilePaths</span>)</span><br><span class="line"></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="订单-x2F-退单筛选数据"><a href="#订单-x2F-退单筛选数据" class="headerlink" title="订单&#x2F;退单筛选数据"></a>订单&#x2F;退单筛选数据</h1><pre><code>computed: &#123;
        list() &#123;
            if (this.current == 4) &#123;
                return this.ordresReturn
            &#125;
            return this.returnList.filter(ele =&gt; &#123;
                if (this.current == 3) &#123;
                    return ele.order.status == 3 || ele.order.status == 4
                &#125;
                return ele.order.status == this.current
            &#125;)
        &#125;
    &#125;,
    
    filters: &#123;
            orderProcessText(process) &#123;
                var text = &#39;等待处理&#39;;
                switch (JSON.stringify(process)) &#123;
                    case &#39;0&#39;:
                        text = &#39;等待处理&#39;;
                        break;
                    case &#39;1&#39;:
                        text = &#39;确认退货,等待用户发货&#39;;
                        break;
                    case &#39;2&#39;:
                        text = &#39;已退款&#39;;
                        break;
                    case &#39;3&#39;:
                        text = &#39;已拒绝&#39;;
                        break;
                    case &#39;9&#39;:
                        text = &#39;拒绝退货&#39;;
                        break;

                    default:
                        break;
                &#125;
                return text;
            &#125;,
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/08/21/%E4%B9%90%E5%B1%85%E5%89%8D%E5%8F%B0%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" data-id="cl734ggt6000bhcuoaaj69dmx" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/08/21/%E4%B9%90%E8%B4%AD%E9%A1%B9%E7%9B%AE%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2022/08/21/uni%E7%AC%94%E8%AE%B0/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/08/21/%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1%E5%92%8C%E7%AE%A1%E7%90%86/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/08/21/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AC%94%E8%AE%B0x/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/08/21/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/08/21/%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E9%81%8D%E5%8E%86/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/08/21/%E6%BD%98%E5%AE%B6%E6%88%90%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E6%A8%A1%E6%9D%BF/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>